<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!-- git web interface version 1.8.3.1, (C) 2005-2006, Kay Sievers <kay.sievers@vrfy.org>, Christian Gierke -->
<!-- git core binaries version 1.8.3.1 -->
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="generator" content="gitweb/1.8.3.1 git/1.8.3.1" />
<meta name="robots" content="index, nofollow" />
<title>annexia.org &gt;&gt; repositories - jonesforth.git/blob - jonesforth.S</title>
<link rel="stylesheet" type="text/css" href="jonesforth.S_files/gitweb.css" />
<link rel="alternate" title="jonesforth.git - history of jonesforth.S - RSS feed" href="http://git.annexia.org/?p=jonesforth.git;a=rss;f=jonesforth.S" type="application/rss+xml" />
<link rel="alternate" title="jonesforth.git - history of jonesforth.S - RSS feed (no merges)" href="http://git.annexia.org/?p=jonesforth.git;a=rss;f=jonesforth.S;opt=--no-merges" type="application/rss+xml" />
<link rel="alternate" title="jonesforth.git - history of jonesforth.S - Atom feed" href="http://git.annexia.org/?p=jonesforth.git;a=atom;f=jonesforth.S" type="application/atom+xml" />
<link rel="alternate" title="jonesforth.git - history of jonesforth.S - Atom feed (no merges)" href="http://git.annexia.org/?p=jonesforth.git;a=atom;f=jonesforth.S;opt=--no-merges" type="application/atom+xml" />
<link rel="shortcut icon" href="http://git.annexia.org/static/git-favicon.png" type="image/png" />
</head>
<body>
<div class="page_header">
<a title="git homepage" href="http://git-scm.com/"><img class="logo" src="jonesforth.S_files/git-logo.png" alt="git" width="72" height="27" /></a><a href="http://git.annexia.org/">git.annexia.org</a> / <a href="http://git.annexia.org/?p=jonesforth.git;a=summary">jonesforth.git</a> / blob
</div>
<form method="get" action="/" enctype="application/x-www-form-urlencoded"><div class="search">
<input name="p" type="hidden" value="jonesforth.git" />
<input name="a" type="hidden" value="search" />
<input name="h" type="hidden" value="HEAD" />
<select name="st">
<option selected="selected" value="commit">commit</option>
<option value="grep">grep</option>
<option value="author">author</option>
<option value="committer">committer</option>
<option value="pickaxe">pickaxe</option>
</select><sup><a href="http://git.annexia.org/?p=jonesforth.git;a=search_help">?</a></sup> search:
<input type="text" name="s" />
<span title="Extended regular expression"><label><input type="checkbox" name="sr" value="1" />re</label></span></div>
</form>
<div class="page_nav">
<a href="http://git.annexia.org/?p=jonesforth.git;a=summary">summary</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=shortlog">shortlog</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=log">log</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=commit;h=HEAD">commit</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=commitdiff;h=HEAD">commitdiff</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=tree;h=98d816ea72cf718510f2d7576c28413d7c46a816;hb=HEAD">tree</a><br />
<a href="http://git.annexia.org/?p=jonesforth.git;a=history;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD">history</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=blob_plain;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD">raw</a> | <a href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;hb=HEAD">HEAD</a><br />
</div>
<div class="header">
<a class="title" href="http://git.annexia.org/?p=jonesforth.git;a=commit;h=HEAD">Version 47</a>
</div>
<div class="page_path"><a title="tree root" href="http://git.annexia.org/?p=jonesforth.git;a=tree;hb=HEAD">[jonesforth.git]</a> / <a title="jonesforth.S" href="http://git.annexia.org/?p=jonesforth.git;a=blob_plain;f=jonesforth.S;hb=HEAD">jonesforth.S</a><br /></div>
<div class="page_body">
<div class="pre"><a id="l1" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1" class="linenr">   1</a> /*      A sometimes minimal FORTH compiler and tutorial for Linux / i386 systems. -*- asm -*-</div>
<div class="pre"><a id="l2" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2" class="linenr">   2</a>         By Richard W.M. Jones &lt;rich@annexia.org&gt; http://annexia.org/forth</div>
<div class="pre"><a id="l3" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l3" class="linenr">   3</a>         This is PUBLIC DOMAIN (see public domain release statement below).</div>
<div class="pre"><a id="l4" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l4" class="linenr">   4</a>         $Id: jonesforth.S,v 1.47 2009-09-11 08:33:13 rich Exp $</div>
<div class="pre"><a id="l5" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l5" class="linenr">   5</a> </div>
<div class="pre"><a id="l6" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l6" class="linenr">   6</a>         gcc -m32 -nostdlib -static -Wl,-Ttext,0 -Wl,--build-id=none -o jonesforth jonesforth.S</div>
<div class="pre"><a id="l7" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l7" class="linenr">   7</a> */</div>
<div class="pre"><a id="l8" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l8" class="linenr">   8</a>         .set JONES_VERSION,47</div>
<div class="pre"><a id="l9" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l9" class="linenr">   9</a> /*</div>
<div class="pre"><a id="l10" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l10" class="linenr">  10</a>         INTRODUCTION ----------------------------------------------------------------------</div>
<div class="pre"><a id="l11" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l11" class="linenr">  11</a> </div>
<div class="pre"><a id="l12" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l12" class="linenr">  12</a>         FORTH is one of those alien languages which most working programmers regard in the same</div>
<div class="pre"><a id="l13" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l13" class="linenr">  13</a>         way as Haskell, LISP, and so on.  Something so strange that they'd rather any thoughts</div>
<div class="pre"><a id="l14" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l14" class="linenr">  14</a>         of it just go away so they can get on with writing this paying code.  But that's wrong</div>
<div class="pre"><a id="l15" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l15" class="linenr">  15</a>         and if you care at all about programming then you should at least understand all these</div>
<div class="pre"><a id="l16" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l16" class="linenr">  16</a>         languages, even if you will never use them.</div>
<div class="pre"><a id="l17" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l17" class="linenr">  17</a> </div>
<div class="pre"><a id="l18" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l18" class="linenr">  18</a>         LISP is the ultimate high-level language, and features from LISP are being added every</div>
<div class="pre"><a id="l19" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l19" class="linenr">  19</a>         decade to the more common languages.  But FORTH is in some ways the ultimate in low level</div>
<div class="pre"><a id="l20" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l20" class="linenr">  20</a>         programming.  Out of the box it lacks features like dynamic memory management and even</div>
<div class="pre"><a id="l21" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l21" class="linenr">  21</a>         strings.  In fact, at its primitive level it lacks even basic concepts like IF-statements</div>
<div class="pre"><a id="l22" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l22" class="linenr">  22</a>         and loops.</div>
<div class="pre"><a id="l23" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l23" class="linenr">  23</a> </div>
<div class="pre"><a id="l24" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l24" class="linenr">  24</a>         Why then would you want to learn FORTH?  There are several very good reasons.  First</div>
<div class="pre"><a id="l25" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l25" class="linenr">  25</a>         and foremost, FORTH is minimal.  You really can write a complete FORTH in, say, 2000</div>
<div class="pre"><a id="l26" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l26" class="linenr">  26</a>         lines of code.  I don't just mean a FORTH program, I mean a complete FORTH operating</div>
<div class="pre"><a id="l27" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l27" class="linenr">  27</a>         system, environment and language.  You could boot such a FORTH on a bare PC and it would</div>
<div class="pre"><a id="l28" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l28" class="linenr">  28</a>         come up with a prompt where you could start doing useful work.  The FORTH you have here</div>
<div class="pre"><a id="l29" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l29" class="linenr">  29</a>         isn't minimal and uses a Linux process as its 'base PC' (both for the purposes of making</div>
<div class="pre"><a id="l30" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l30" class="linenr">  30</a>         it a good tutorial). It's possible to completely understand the system.  Who can say they</div>
<div class="pre"><a id="l31" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l31" class="linenr">  31</a>         completely understand how Linux works, or gcc?</div>
<div class="pre"><a id="l32" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l32" class="linenr">  32</a> </div>
<div class="pre"><a id="l33" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l33" class="linenr">  33</a>         Secondly FORTH has a peculiar bootstrapping property.  By that I mean that after writing</div>
<div class="pre"><a id="l34" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l34" class="linenr">  34</a>         a little bit of assembly to talk to the hardware and implement a few primitives, all the</div>
<div class="pre"><a id="l35" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l35" class="linenr">  35</a>         rest of the language and compiler is written in FORTH itself.  Remember I said before</div>
<div class="pre"><a id="l36" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l36" class="linenr">  36</a>         that FORTH lacked IF-statements and loops?  Well of course it doesn't really because</div>
<div class="pre"><a id="l37" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l37" class="linenr">  37</a>         such a lanuage would be useless, but my point was rather that IF-statements and loops are</div>
<div class="pre"><a id="l38" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l38" class="linenr">  38</a>         written in FORTH itself.</div>
<div class="pre"><a id="l39" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l39" class="linenr">  39</a> </div>
<div class="pre"><a id="l40" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l40" class="linenr">  40</a>         Now of course this is common in other languages as well, and in those languages we call</div>
<div class="pre"><a id="l41" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l41" class="linenr">  41</a>         them 'libraries'.  For example in C, 'printf' is a library function written in C.  But</div>
<div class="pre"><a id="l42" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l42" class="linenr">  42</a>         in FORTH this goes way beyond mere libraries.  Can you imagine writing C's 'if' in C?</div>
<div class="pre"><a id="l43" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l43" class="linenr">  43</a>         And that brings me to my third reason: If you can write 'if' in FORTH, then why restrict</div>
<div class="pre"><a id="l44" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l44" class="linenr">  44</a>         yourself to the usual if/while/for/switch constructs?  You want a construct that iterates</div>
<div class="pre"><a id="l45" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l45" class="linenr">  45</a>         over every other element in a list of numbers?  You can add it to the language.  What</div>
<div class="pre"><a id="l46" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l46" class="linenr">  46</a>         about an operator which pulls in variables directly from a configuration file and makes</div>
<div class="pre"><a id="l47" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l47" class="linenr">  47</a>         them available as FORTH variables?  Or how about adding Makefile-like dependencies to</div>
<div class="pre"><a id="l48" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l48" class="linenr">  48</a>         the language?  No problem in FORTH.  How about modifying the FORTH compiler to allow</div>
<div class="pre"><a id="l49" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l49" class="linenr">  49</a>         complex inlining strategies -- simple.  This concept isn't common in programming languages,</div>
<div class="pre"><a id="l50" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l50" class="linenr">  50</a>         but it has a name (in fact two names): "macros" (by which I mean LISP-style macros, not</div>
<div class="pre"><a id="l51" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l51" class="linenr">  51</a>         the lame C preprocessor) and "domain specific languages" (DSLs).</div>
<div class="pre"><a id="l52" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l52" class="linenr">  52</a> </div>
<div class="pre"><a id="l53" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l53" class="linenr">  53</a>         This tutorial isn't about learning FORTH as the language.  I'll point you to some references</div>
<div class="pre"><a id="l54" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l54" class="linenr">  54</a>         you should read if you're not familiar with using FORTH.  This tutorial is about how to</div>
<div class="pre"><a id="l55" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l55" class="linenr">  55</a>         write FORTH.  In fact, until you understand how FORTH is written, you'll have only a very</div>
<div class="pre"><a id="l56" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l56" class="linenr">  56</a>         superficial understanding of how to use it.</div>
<div class="pre"><a id="l57" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l57" class="linenr">  57</a> </div>
<div class="pre"><a id="l58" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l58" class="linenr">  58</a>         So if you're not familiar with FORTH or want to refresh your memory here are some online</div>
<div class="pre"><a id="l59" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l59" class="linenr">  59</a>         references to read:</div>
<div class="pre"><a id="l60" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l60" class="linenr">  60</a> </div>
<div class="pre"><a id="l61" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l61" class="linenr">  61</a>         http://en.wikipedia.org/wiki/Forth_%28programming_language%29</div>
<div class="pre"><a id="l62" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l62" class="linenr">  62</a> </div>
<div class="pre"><a id="l63" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l63" class="linenr">  63</a>         http://galileo.phys.virginia.edu/classes/551.jvn.fall01/primer.htm</div>
<div class="pre"><a id="l64" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l64" class="linenr">  64</a> </div>
<div class="pre"><a id="l65" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l65" class="linenr">  65</a>         http://wiki.laptop.org/go/Forth_Lessons</div>
<div class="pre"><a id="l66" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l66" class="linenr">  66</a> </div>
<div class="pre"><a id="l67" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l67" class="linenr">  67</a>         http://www.albany.net/~hello/simple.htm</div>
<div class="pre"><a id="l68" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l68" class="linenr">  68</a> </div>
<div class="pre"><a id="l69" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l69" class="linenr">  69</a>         Here is another "Why FORTH?" essay: http://www.jwdt.com/~paysan/why-forth.html</div>
<div class="pre"><a id="l70" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l70" class="linenr">  70</a> </div>
<div class="pre"><a id="l71" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l71" class="linenr">  71</a>         Discussion and criticism of this FORTH here: http://lambda-the-ultimate.org/node/2452</div>
<div class="pre"><a id="l72" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l72" class="linenr">  72</a> </div>
<div class="pre"><a id="l73" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l73" class="linenr">  73</a>         ACKNOWLEDGEMENTS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l74" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l74" class="linenr">  74</a> </div>
<div class="pre"><a id="l75" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l75" class="linenr">  75</a>         This code draws heavily on the design of LINA FORTH (http://home.hccnet.nl/a.w.m.van.der.horst/lina.html)</div>
<div class="pre"><a id="l76" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l76" class="linenr">  76</a>         by Albert van der Horst.  Any similarities in the code are probably not accidental.</div>
<div class="pre"><a id="l77" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l77" class="linenr">  77</a> </div>
<div class="pre"><a id="l78" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l78" class="linenr">  78</a>         Some parts of this FORTH are also based on this IOCCC entry from 1992:</div>
<div class="pre"><a id="l79" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l79" class="linenr">  79</a>         http://ftp.funet.fi/pub/doc/IOCCC/1992/buzzard.2.design.</div>
<div class="pre"><a id="l80" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l80" class="linenr">  80</a>         I was very proud when Sean Barrett, the original author of the IOCCC entry, commented in the LtU thread</div>
<div class="pre"><a id="l81" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l81" class="linenr">  81</a>         http://lambda-the-ultimate.org/node/2452#comment-36818 about this FORTH.</div>
<div class="pre"><a id="l82" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l82" class="linenr">  82</a> </div>
<div class="pre"><a id="l83" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l83" class="linenr">  83</a>         And finally I'd like to acknowledge the (possibly forgotten?) authors of ARTIC FORTH because their</div>
<div class="pre"><a id="l84" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l84" class="linenr">  84</a>         original program which I still have on original cassette tape kept nagging away at me all these years.</div>
<div class="pre"><a id="l85" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l85" class="linenr">  85</a>         http://en.wikipedia.org/wiki/Artic_Software</div>
<div class="pre"><a id="l86" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l86" class="linenr">  86</a> </div>
<div class="pre"><a id="l87" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l87" class="linenr">  87</a>         PUBLIC DOMAIN ----------------------------------------------------------------------</div>
<div class="pre"><a id="l88" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l88" class="linenr">  88</a> </div>
<div class="pre"><a id="l89" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l89" class="linenr">  89</a>         I, the copyright holder of this work, hereby release it into the public domain. This applies worldwide.</div>
<div class="pre"><a id="l90" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l90" class="linenr">  90</a> </div>
<div class="pre"><a id="l91" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l91" class="linenr">  91</a>         In case this is not legally possible, I grant any entity the right to use this work for any purpose,</div>
<div class="pre"><a id="l92" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l92" class="linenr">  92</a>         without any conditions, unless such conditions are required by law.</div>
<div class="pre"><a id="l93" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l93" class="linenr">  93</a> </div>
<div class="pre"><a id="l94" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l94" class="linenr">  94</a>         SETTING UP ----------------------------------------------------------------------</div>
<div class="pre"><a id="l95" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l95" class="linenr">  95</a> </div>
<div class="pre"><a id="l96" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l96" class="linenr">  96</a>         Let's get a few housekeeping things out of the way.  Firstly because I need to draw lots of</div>
<div class="pre"><a id="l97" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l97" class="linenr">  97</a>         ASCII-art diagrams to explain concepts, the best way to look at this is using a window which</div>
<div class="pre"><a id="l98" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l98" class="linenr">  98</a>         uses a fixed width font and is at least this wide:</div>
<div class="pre"><a id="l99" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l99" class="linenr">  99</a> </div>
<div class="pre"><a id="l100" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l100" class="linenr"> 100</a>  &lt;------------------------------------------------------------------------------------------------------------------------&gt;</div>
<div class="pre"><a id="l101" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l101" class="linenr"> 101</a> </div>
<div class="pre"><a id="l102" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l102" class="linenr"> 102</a>         Secondly make sure TABS are set to 8 characters.  The following should be a vertical</div>
<div class="pre"><a id="l103" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l103" class="linenr"> 103</a>         line.  If not, sort out your tabs.</div>
<div class="pre"><a id="l104" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l104" class="linenr"> 104</a> </div>
<div class="pre"><a id="l105" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l105" class="linenr"> 105</a>                 |</div>
<div class="pre"><a id="l106" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l106" class="linenr"> 106</a>                 |</div>
<div class="pre"><a id="l107" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l107" class="linenr"> 107</a>                 |</div>
<div class="pre"><a id="l108" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l108" class="linenr"> 108</a> </div>
<div class="pre"><a id="l109" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l109" class="linenr"> 109</a>         Thirdly I assume that your screen is at least 50 characters high.</div>
<div class="pre"><a id="l110" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l110" class="linenr"> 110</a> </div>
<div class="pre"><a id="l111" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l111" class="linenr"> 111</a>         ASSEMBLING ----------------------------------------------------------------------</div>
<div class="pre"><a id="l112" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l112" class="linenr"> 112</a> </div>
<div class="pre"><a id="l113" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l113" class="linenr"> 113</a>         If you want to actually run this FORTH, rather than just read it, you will need Linux on an</div>
<div class="pre"><a id="l114" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l114" class="linenr"> 114</a>         i386.  Linux because instead of programming directly to the hardware on a bare PC which I</div>
<div class="pre"><a id="l115" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l115" class="linenr"> 115</a>         could have done, I went for a simpler tutorial by assuming that the 'hardware' is a Linux</div>
<div class="pre"><a id="l116" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l116" class="linenr"> 116</a>         process with a few basic system calls (read, write and exit and that's about all).  i386</div>
<div class="pre"><a id="l117" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l117" class="linenr"> 117</a>         is needed because I had to write the assembly for a processor, and i386 is by far the most</div>
<div class="pre"><a id="l118" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l118" class="linenr"> 118</a>         common.  (Of course when I say 'i386', any 32- or 64-bit x86 processor will do.  I'm compiling</div>
<div class="pre"><a id="l119" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l119" class="linenr"> 119</a>         this on a 64 bit AMD Opteron).</div>
<div class="pre"><a id="l120" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l120" class="linenr"> 120</a> </div>
<div class="pre"><a id="l121" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l121" class="linenr"> 121</a>         Again, to assemble this you will need gcc and gas (the GNU assembler).  The commands to</div>
<div class="pre"><a id="l122" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l122" class="linenr"> 122</a>         assemble and run the code (save this file as 'jonesforth.S') are:</div>
<div class="pre"><a id="l123" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l123" class="linenr"> 123</a> </div>
<div class="pre"><a id="l124" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l124" class="linenr"> 124</a>         gcc -m32 -nostdlib -static -Wl,-Ttext,0 -Wl,--build-id=none -o jonesforth jonesforth.S</div>
<div class="pre"><a id="l125" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l125" class="linenr"> 125</a>         cat jonesforth.f - | ./jonesforth</div>
<div class="pre"><a id="l126" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l126" class="linenr"> 126</a> </div>
<div class="pre"><a id="l127" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l127" class="linenr"> 127</a>         If you want to run your own FORTH programs you can do:</div>
<div class="pre"><a id="l128" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l128" class="linenr"> 128</a> </div>
<div class="pre"><a id="l129" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l129" class="linenr"> 129</a>         cat jonesforth.f myprog.f | ./jonesforth</div>
<div class="pre"><a id="l130" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l130" class="linenr"> 130</a> </div>
<div class="pre"><a id="l131" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l131" class="linenr"> 131</a>         If you want to load your own FORTH code and then continue reading user commands, you can do:</div>
<div class="pre"><a id="l132" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l132" class="linenr"> 132</a> </div>
<div class="pre"><a id="l133" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l133" class="linenr"> 133</a>         cat jonesforth.f myfunctions.f - | ./jonesforth</div>
<div class="pre"><a id="l134" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l134" class="linenr"> 134</a> </div>
<div class="pre"><a id="l135" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l135" class="linenr"> 135</a>         ASSEMBLER ----------------------------------------------------------------------</div>
<div class="pre"><a id="l136" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l136" class="linenr"> 136</a> </div>
<div class="pre"><a id="l137" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l137" class="linenr"> 137</a>         (You can just skip to the next section -- you don't need to be able to read assembler to</div>
<div class="pre"><a id="l138" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l138" class="linenr"> 138</a>         follow this tutorial).</div>
<div class="pre"><a id="l139" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l139" class="linenr"> 139</a> </div>
<div class="pre"><a id="l140" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l140" class="linenr"> 140</a>         However if you do want to read the assembly code here are a few notes about gas (the GNU assembler):</div>
<div class="pre"><a id="l141" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l141" class="linenr"> 141</a> </div>
<div class="pre"><a id="l142" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l142" class="linenr"> 142</a>         (1) Register names are prefixed with '%', so %eax is the 32 bit i386 accumulator.  The registers</div>
<div class="pre"><a id="l143" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l143" class="linenr"> 143</a>             available on i386 are: %eax, %ebx, %ecx, %edx, %esi, %edi, %ebp and %esp, and most of them</div>
<div class="pre"><a id="l144" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l144" class="linenr"> 144</a>             have special purposes.</div>
<div class="pre"><a id="l145" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l145" class="linenr"> 145</a> </div>
<div class="pre"><a id="l146" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l146" class="linenr"> 146</a>         (2) Add, mov, etc. take arguments in the form SRC,DEST.  So mov %eax,%ecx moves %eax -&gt; %ecx</div>
<div class="pre"><a id="l147" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l147" class="linenr"> 147</a> </div>
<div class="pre"><a id="l148" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l148" class="linenr"> 148</a>         (3) Constants are prefixed with '$', and you mustn't forget it!  If you forget it then it</div>
<div class="pre"><a id="l149" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l149" class="linenr"> 149</a>             causes a read from memory instead, so:</div>
<div class="pre"><a id="l150" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l150" class="linenr"> 150</a>             mov $2,%eax         moves number 2 into %eax</div>
<div class="pre"><a id="l151" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l151" class="linenr"> 151</a>             mov 2,%eax          reads the 32 bit word from address 2 into %eax (ie. most likely a mistake)</div>
<div class="pre"><a id="l152" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l152" class="linenr"> 152</a> </div>
<div class="pre"><a id="l153" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l153" class="linenr"> 153</a>         (4) gas has a funky syntax for local labels, where '1f' (etc.) means label '1:' "forwards"</div>
<div class="pre"><a id="l154" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l154" class="linenr"> 154</a>             and '1b' (etc.) means label '1:' "backwards".  Notice that these labels might be mistaken</div>
<div class="pre"><a id="l155" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l155" class="linenr"> 155</a>             for hex numbers (eg. you might confuse 1b with $0x1b).</div>
<div class="pre"><a id="l156" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l156" class="linenr"> 156</a> </div>
<div class="pre"><a id="l157" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l157" class="linenr"> 157</a>         (5) 'ja' is "jump if above", 'jb' for "jump if below", 'je' "jump if equal" etc.</div>
<div class="pre"><a id="l158" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l158" class="linenr"> 158</a> </div>
<div class="pre"><a id="l159" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l159" class="linenr"> 159</a>         (6) gas has a reasonably nice .macro syntax, and I use them a lot to make the code shorter and</div>
<div class="pre"><a id="l160" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l160" class="linenr"> 160</a>             less repetitive.</div>
<div class="pre"><a id="l161" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l161" class="linenr"> 161</a> </div>
<div class="pre"><a id="l162" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l162" class="linenr"> 162</a>         For more help reading the assembler, do "info gas" at the Linux prompt.</div>
<div class="pre"><a id="l163" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l163" class="linenr"> 163</a> </div>
<div class="pre"><a id="l164" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l164" class="linenr"> 164</a>         Now the tutorial starts in earnest.</div>
<div class="pre"><a id="l165" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l165" class="linenr"> 165</a> </div>
<div class="pre"><a id="l166" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l166" class="linenr"> 166</a>         THE DICTIONARY ----------------------------------------------------------------------</div>
<div class="pre"><a id="l167" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l167" class="linenr"> 167</a> </div>
<div class="pre"><a id="l168" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l168" class="linenr"> 168</a>         In FORTH as you will know, functions are called "words", and just as in other languages they</div>
<div class="pre"><a id="l169" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l169" class="linenr"> 169</a>         have a name and a definition.  Here are two FORTH words:</div>
<div class="pre"><a id="l170" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l170" class="linenr"> 170</a> </div>
<div class="pre"><a id="l171" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l171" class="linenr"> 171</a>         : DOUBLE DUP + ;                \ name is "DOUBLE", definition is "DUP +"</div>
<div class="pre"><a id="l172" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l172" class="linenr"> 172</a>         : QUADRUPLE DOUBLE DOUBLE ;     \ name is "QUADRUPLE", definition is "DOUBLE DOUBLE"</div>
<div class="pre"><a id="l173" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l173" class="linenr"> 173</a> </div>
<div class="pre"><a id="l174" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l174" class="linenr"> 174</a>         Words, both built-in ones and ones which the programmer defines later, are stored in a dictionary</div>
<div class="pre"><a id="l175" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l175" class="linenr"> 175</a>         which is just a linked list of dictionary entries.</div>
<div class="pre"><a id="l176" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l176" class="linenr"> 176</a> </div>
<div class="pre"><a id="l177" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l177" class="linenr"> 177</a>         &lt;--- DICTIONARY ENTRY (HEADER) -----------------------&gt;</div>
<div class="pre"><a id="l178" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l178" class="linenr"> 178</a>         +------------------------+--------+---------- - - - - +----------- - - - -</div>
<div class="pre"><a id="l179" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l179" class="linenr"> 179</a>         | LINK POINTER           | LENGTH/| NAME              | DEFINITION</div>
<div class="pre"><a id="l180" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l180" class="linenr"> 180</a>         |                        | FLAGS  |                   |</div>
<div class="pre"><a id="l181" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l181" class="linenr"> 181</a>         +--- (4 bytes) ----------+- byte -+- n bytes  - - - - +----------- - - - -</div>
<div class="pre"><a id="l182" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l182" class="linenr"> 182</a> </div>
<div class="pre"><a id="l183" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l183" class="linenr"> 183</a>         I'll come to the definition of the word later.  For now just look at the header.  The first</div>
<div class="pre"><a id="l184" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l184" class="linenr"> 184</a>         4 bytes are the link pointer.  This points back to the previous word in the dictionary, or, for</div>
<div class="pre"><a id="l185" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l185" class="linenr"> 185</a>         the first word in the dictionary it is just a NULL pointer.  Then comes a length/flags byte.</div>
<div class="pre"><a id="l186" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l186" class="linenr"> 186</a>         The length of the word can be up to 31 characters (5 bits used) and the top three bits are used</div>
<div class="pre"><a id="l187" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l187" class="linenr"> 187</a>         for various flags which I'll come to later.  This is followed by the name itself, and in this</div>
<div class="pre"><a id="l188" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l188" class="linenr"> 188</a>         implementation the name is rounded up to a multiple of 4 bytes by padding it with zero bytes.</div>
<div class="pre"><a id="l189" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l189" class="linenr"> 189</a>         That's just to ensure that the definition starts on a 32 bit boundary.</div>
<div class="pre"><a id="l190" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l190" class="linenr"> 190</a> </div>
<div class="pre"><a id="l191" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l191" class="linenr"> 191</a>         A FORTH variable called LATEST contains a pointer to the most recently defined word, in</div>
<div class="pre"><a id="l192" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l192" class="linenr"> 192</a>         other words, the head of this linked list.</div>
<div class="pre"><a id="l193" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l193" class="linenr"> 193</a> </div>
<div class="pre"><a id="l194" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l194" class="linenr"> 194</a>         DOUBLE and QUADRUPLE might look like this:</div>
<div class="pre"><a id="l195" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l195" class="linenr"> 195</a> </div>
<div class="pre"><a id="l196" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l196" class="linenr"> 196</a>           pointer to previous word</div>
<div class="pre"><a id="l197" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l197" class="linenr"> 197</a>            ^</div>
<div class="pre"><a id="l198" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l198" class="linenr"> 198</a>            |</div>
<div class="pre"><a id="l199" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l199" class="linenr"> 199</a>         +--|------+---+---+---+---+---+---+---+---+------------- - - - -</div>
<div class="pre"><a id="l200" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l200" class="linenr"> 200</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | (definition ...)</div>
<div class="pre"><a id="l201" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l201" class="linenr"> 201</a>         +---------+---+---+---+---+---+---+---+---+------------- - - - -</div>
<div class="pre"><a id="l202" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l202" class="linenr"> 202</a>            ^       len                         padding</div>
<div class="pre"><a id="l203" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l203" class="linenr"> 203</a>            |</div>
<div class="pre"><a id="l204" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l204" class="linenr"> 204</a>         +--|------+---+---+---+---+---+---+---+---+---+---+---+---+------------- - - - -</div>
<div class="pre"><a id="l205" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l205" class="linenr"> 205</a>         | LINK    | 9 | Q | U | A | D | R | U | P | L | E | 0 | 0 | (definition ...)</div>
<div class="pre"><a id="l206" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l206" class="linenr"> 206</a>         +---------+---+---+---+---+---+---+---+---+---+---+---+---+------------- - - - -</div>
<div class="pre"><a id="l207" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l207" class="linenr"> 207</a>            ^       len                                     padding</div>
<div class="pre"><a id="l208" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l208" class="linenr"> 208</a>            |</div>
<div class="pre"><a id="l209" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l209" class="linenr"> 209</a>            |</div>
<div class="pre"><a id="l210" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l210" class="linenr"> 210</a>           LATEST</div>
<div class="pre"><a id="l211" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l211" class="linenr"> 211</a> </div>
<div class="pre"><a id="l212" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l212" class="linenr"> 212</a>         You should be able to see from this how you might implement functions to find a word in</div>
<div class="pre"><a id="l213" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l213" class="linenr"> 213</a>         the dictionary (just walk along the dictionary entries starting at LATEST and matching</div>
<div class="pre"><a id="l214" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l214" class="linenr"> 214</a>         the names until you either find a match or hit the NULL pointer at the end of the dictionary);</div>
<div class="pre"><a id="l215" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l215" class="linenr"> 215</a>         and add a word to the dictionary (create a new definition, set its LINK to LATEST, and set</div>
<div class="pre"><a id="l216" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l216" class="linenr"> 216</a>         LATEST to point to the new word).  We'll see precisely these functions implemented in</div>
<div class="pre"><a id="l217" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l217" class="linenr"> 217</a>         assembly code later on.</div>
<div class="pre"><a id="l218" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l218" class="linenr"> 218</a> </div>
<div class="pre"><a id="l219" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l219" class="linenr"> 219</a>         One interesting consequence of using a linked list is that you can redefine words, and</div>
<div class="pre"><a id="l220" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l220" class="linenr"> 220</a>         a newer definition of a word overrides an older one.  This is an important concept in</div>
<div class="pre"><a id="l221" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l221" class="linenr"> 221</a>         FORTH because it means that any word (even "built-in" or "standard" words) can be</div>
<div class="pre"><a id="l222" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l222" class="linenr"> 222</a>         overridden with a new definition, either to enhance it, to make it faster or even to</div>
<div class="pre"><a id="l223" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l223" class="linenr"> 223</a>         disable it.  However because of the way that FORTH words get compiled, which you'll</div>
<div class="pre"><a id="l224" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l224" class="linenr"> 224</a>         understand below, words defined using the old definition of a word continue to use</div>
<div class="pre"><a id="l225" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l225" class="linenr"> 225</a>         the old definition.  Only words defined after the new definition use the new definition.</div>
<div class="pre"><a id="l226" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l226" class="linenr"> 226</a> </div>
<div class="pre"><a id="l227" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l227" class="linenr"> 227</a>         DIRECT THREADED CODE ----------------------------------------------------------------------</div>
<div class="pre"><a id="l228" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l228" class="linenr"> 228</a> </div>
<div class="pre"><a id="l229" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l229" class="linenr"> 229</a>         Now we'll get to the really crucial bit in understanding FORTH, so go and get a cup of tea</div>
<div class="pre"><a id="l230" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l230" class="linenr"> 230</a>         or coffee and settle down.  It's fair to say that if you don't understand this section, then you</div>
<div class="pre"><a id="l231" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l231" class="linenr"> 231</a>         won't "get" how FORTH works, and that would be a failure on my part for not explaining it well.</div>
<div class="pre"><a id="l232" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l232" class="linenr"> 232</a>         So if after reading this section a few times you don't understand it, please email me</div>
<div class="pre"><a id="l233" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l233" class="linenr"> 233</a>         (rich@annexia.org).</div>
<div class="pre"><a id="l234" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l234" class="linenr"> 234</a> </div>
<div class="pre"><a id="l235" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l235" class="linenr"> 235</a>         Let's talk first about what "threaded code" means.  Imagine a peculiar version of C where</div>
<div class="pre"><a id="l236" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l236" class="linenr"> 236</a>         you are only allowed to call functions without arguments.  (Don't worry for now that such a</div>
<div class="pre"><a id="l237" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l237" class="linenr"> 237</a>         language would be completely useless!)  So in our peculiar C, code would look like this:</div>
<div class="pre"><a id="l238" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l238" class="linenr"> 238</a> </div>
<div class="pre"><a id="l239" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l239" class="linenr"> 239</a>         f ()</div>
<div class="pre"><a id="l240" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l240" class="linenr"> 240</a>         {</div>
<div class="pre"><a id="l241" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l241" class="linenr"> 241</a>           a ();</div>
<div class="pre"><a id="l242" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l242" class="linenr"> 242</a>           b ();</div>
<div class="pre"><a id="l243" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l243" class="linenr"> 243</a>           c ();</div>
<div class="pre"><a id="l244" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l244" class="linenr"> 244</a>         }</div>
<div class="pre"><a id="l245" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l245" class="linenr"> 245</a> </div>
<div class="pre"><a id="l246" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l246" class="linenr"> 246</a>         and so on.  How would a function, say 'f' above, be compiled by a standard C compiler?</div>
<div class="pre"><a id="l247" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l247" class="linenr"> 247</a>         Probably into assembly code like this.  On the right hand side I've written the actual</div>
<div class="pre"><a id="l248" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l248" class="linenr"> 248</a>         i386 machine code.</div>
<div class="pre"><a id="l249" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l249" class="linenr"> 249</a> </div>
<div class="pre"><a id="l250" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l250" class="linenr"> 250</a>         f:</div>
<div class="pre"><a id="l251" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l251" class="linenr"> 251</a>           CALL a                        E8 08 00 00 00</div>
<div class="pre"><a id="l252" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l252" class="linenr"> 252</a>           CALL b                        E8 1C 00 00 00</div>
<div class="pre"><a id="l253" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l253" class="linenr"> 253</a>           CALL c                        E8 2C 00 00 00</div>
<div class="pre"><a id="l254" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l254" class="linenr"> 254</a>           ; ignore the return from the function for now</div>
<div class="pre"><a id="l255" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l255" class="linenr"> 255</a> </div>
<div class="pre"><a id="l256" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l256" class="linenr"> 256</a>         "E8" is the x86 machine code to "CALL" a function.  In the first 20 years of computing</div>
<div class="pre"><a id="l257" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l257" class="linenr"> 257</a>         memory was hideously expensive and we might have worried about the wasted space being used</div>
<div class="pre"><a id="l258" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l258" class="linenr"> 258</a>         by the repeated "E8" bytes.  We can save 20% in code size (and therefore, in expensive memory)</div>
<div class="pre"><a id="l259" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l259" class="linenr"> 259</a>         by compressing this into just:</div>
<div class="pre"><a id="l260" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l260" class="linenr"> 260</a> </div>
<div class="pre"><a id="l261" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l261" class="linenr"> 261</a>         08 00 00 00             Just the function addresses, without</div>
<div class="pre"><a id="l262" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l262" class="linenr"> 262</a>         1C 00 00 00             the CALL prefix.</div>
<div class="pre"><a id="l263" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l263" class="linenr"> 263</a>         2C 00 00 00</div>
<div class="pre"><a id="l264" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l264" class="linenr"> 264</a> </div>
<div class="pre"><a id="l265" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l265" class="linenr"> 265</a>         On a 16-bit machine like the ones which originally ran FORTH the savings are even greater - 33%.</div>
<div class="pre"><a id="l266" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l266" class="linenr"> 266</a> </div>
<div class="pre"><a id="l267" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l267" class="linenr"> 267</a>         [Historical note: If the execution model that FORTH uses looks strange from the following</div>
<div class="pre"><a id="l268" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l268" class="linenr"> 268</a>         paragraphs, then it was motivated entirely by the need to save memory on early computers.</div>
<div class="pre"><a id="l269" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l269" class="linenr"> 269</a>         This code compression isn't so important now when our machines have more memory in their L1</div>
<div class="pre"><a id="l270" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l270" class="linenr"> 270</a>         caches than those early computers had in total, but the execution model still has some</div>
<div class="pre"><a id="l271" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l271" class="linenr"> 271</a>         useful properties].</div>
<div class="pre"><a id="l272" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l272" class="linenr"> 272</a> </div>
<div class="pre"><a id="l273" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l273" class="linenr"> 273</a>         Of course this code won't run directly on the CPU any more.  Instead we need to write an</div>
<div class="pre"><a id="l274" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l274" class="linenr"> 274</a>         interpreter which takes each set of bytes and calls it.</div>
<div class="pre"><a id="l275" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l275" class="linenr"> 275</a> </div>
<div class="pre"><a id="l276" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l276" class="linenr"> 276</a>         On an i386 machine it turns out that we can write this interpreter rather easily, in just</div>
<div class="pre"><a id="l277" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l277" class="linenr"> 277</a>         two assembly instructions which turn into just 3 bytes of machine code.  Let's store the</div>
<div class="pre"><a id="l278" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l278" class="linenr"> 278</a>         pointer to the next word to execute in the %esi register:</div>
<div class="pre"><a id="l279" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l279" class="linenr"> 279</a> </div>
<div class="pre"><a id="l280" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l280" class="linenr"> 280</a>                 08 00 00 00     &lt;- We're executing this one now.  %esi is the _next_ one to execute.</div>
<div class="pre"><a id="l281" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l281" class="linenr"> 281</a>         %esi -&gt; 1C 00 00 00</div>
<div class="pre"><a id="l282" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l282" class="linenr"> 282</a>                 2C 00 00 00</div>
<div class="pre"><a id="l283" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l283" class="linenr"> 283</a> </div>
<div class="pre"><a id="l284" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l284" class="linenr"> 284</a>         The all-important i386 instruction is called LODSL (or in Intel manuals, LODSW).  It does</div>
<div class="pre"><a id="l285" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l285" class="linenr"> 285</a>         two things.  Firstly it reads the memory at %esi into the accumulator (%eax).  Secondly it</div>
<div class="pre"><a id="l286" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l286" class="linenr"> 286</a>         increments %esi by 4 bytes.  So after LODSL, the situation now looks like this:</div>
<div class="pre"><a id="l287" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l287" class="linenr"> 287</a> </div>
<div class="pre"><a id="l288" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l288" class="linenr"> 288</a>                 08 00 00 00     &lt;- We're still executing this one</div>
<div class="pre"><a id="l289" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l289" class="linenr"> 289</a>                 1C 00 00 00     &lt;- %eax now contains this address (0x0000001C)</div>
<div class="pre"><a id="l290" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l290" class="linenr"> 290</a>         %esi -&gt; 2C 00 00 00</div>
<div class="pre"><a id="l291" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l291" class="linenr"> 291</a> </div>
<div class="pre"><a id="l292" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l292" class="linenr"> 292</a>         Now we just need to jump to the address in %eax.  This is again just a single x86 instruction</div>
<div class="pre"><a id="l293" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l293" class="linenr"> 293</a>         written JMP *(%eax).  And after doing the jump, the situation looks like:</div>
<div class="pre"><a id="l294" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l294" class="linenr"> 294</a> </div>
<div class="pre"><a id="l295" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l295" class="linenr"> 295</a>                 08 00 00 00</div>
<div class="pre"><a id="l296" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l296" class="linenr"> 296</a>                 1C 00 00 00     &lt;- Now we're executing this subroutine.</div>
<div class="pre"><a id="l297" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l297" class="linenr"> 297</a>         %esi -&gt; 2C 00 00 00</div>
<div class="pre"><a id="l298" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l298" class="linenr"> 298</a> </div>
<div class="pre"><a id="l299" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l299" class="linenr"> 299</a>         To make this work, each subroutine is followed by the two instructions 'LODSL; JMP *(%eax)'</div>
<div class="pre"><a id="l300" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l300" class="linenr"> 300</a>         which literally make the jump to the next subroutine.</div>
<div class="pre"><a id="l301" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l301" class="linenr"> 301</a> </div>
<div class="pre"><a id="l302" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l302" class="linenr"> 302</a>         And that brings us to our first piece of actual code!  Well, it's a macro.</div>
<div class="pre"><a id="l303" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l303" class="linenr"> 303</a> */</div>
<div class="pre"><a id="l304" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l304" class="linenr"> 304</a> </div>
<div class="pre"><a id="l305" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l305" class="linenr"> 305</a> /* NEXT macro. */</div>
<div class="pre"><a id="l306" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l306" class="linenr"> 306</a>         .macro NEXT</div>
<div class="pre"><a id="l307" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l307" class="linenr"> 307</a>         lodsl</div>
<div class="pre"><a id="l308" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l308" class="linenr"> 308</a>         jmp *(%eax)</div>
<div class="pre"><a id="l309" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l309" class="linenr"> 309</a>         .endm</div>
<div class="pre"><a id="l310" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l310" class="linenr"> 310</a> </div>
<div class="pre"><a id="l311" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l311" class="linenr"> 311</a> /*      The macro is called NEXT.  That's a FORTH-ism.  It expands to those two instructions.</div>
<div class="pre"><a id="l312" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l312" class="linenr"> 312</a> </div>
<div class="pre"><a id="l313" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l313" class="linenr"> 313</a>         Every FORTH primitive that we write has to be ended by NEXT.  Think of it kind of like</div>
<div class="pre"><a id="l314" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l314" class="linenr"> 314</a>         a return.</div>
<div class="pre"><a id="l315" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l315" class="linenr"> 315</a> </div>
<div class="pre"><a id="l316" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l316" class="linenr"> 316</a>         The above describes what is known as direct threaded code.</div>
<div class="pre"><a id="l317" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l317" class="linenr"> 317</a> </div>
<div class="pre"><a id="l318" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l318" class="linenr"> 318</a>         To sum up: We compress our function calls down to a list of addresses and use a somewhat</div>
<div class="pre"><a id="l319" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l319" class="linenr"> 319</a>         magical macro to act as a "jump to next function in the list".  We also use one register (%esi)</div>
<div class="pre"><a id="l320" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l320" class="linenr"> 320</a>         to act as a kind of instruction pointer, pointing to the next function in the list.</div>
<div class="pre"><a id="l321" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l321" class="linenr"> 321</a> </div>
<div class="pre"><a id="l322" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l322" class="linenr"> 322</a>         I'll just give you a hint of what is to come by saying that a FORTH definition such as:</div>
<div class="pre"><a id="l323" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l323" class="linenr"> 323</a> </div>
<div class="pre"><a id="l324" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l324" class="linenr"> 324</a>         : QUADRUPLE DOUBLE DOUBLE ;</div>
<div class="pre"><a id="l325" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l325" class="linenr"> 325</a> </div>
<div class="pre"><a id="l326" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l326" class="linenr"> 326</a>         actually compiles (almost, not precisely but we'll see why in a moment) to a list of</div>
<div class="pre"><a id="l327" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l327" class="linenr"> 327</a>         function addresses for DOUBLE, DOUBLE and a special function called EXIT to finish off.</div>
<div class="pre"><a id="l328" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l328" class="linenr"> 328</a> </div>
<div class="pre"><a id="l329" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l329" class="linenr"> 329</a>         At this point, REALLY EAGLE-EYED ASSEMBLY EXPERTS are saying "JONES, YOU'VE MADE A MISTAKE!".</div>
<div class="pre"><a id="l330" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l330" class="linenr"> 330</a> </div>
<div class="pre"><a id="l331" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l331" class="linenr"> 331</a>         I lied about JMP *(%eax).  </div>
<div class="pre"><a id="l332" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l332" class="linenr"> 332</a> </div>
<div class="pre"><a id="l333" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l333" class="linenr"> 333</a>         INDIRECT THREADED CODE ----------------------------------------------------------------------</div>
<div class="pre"><a id="l334" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l334" class="linenr"> 334</a> </div>
<div class="pre"><a id="l335" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l335" class="linenr"> 335</a>         It turns out that direct threaded code is interesting but only if you want to just execute</div>
<div class="pre"><a id="l336" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l336" class="linenr"> 336</a>         a list of functions written in assembly language.  So QUADRUPLE would work only if DOUBLE</div>
<div class="pre"><a id="l337" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l337" class="linenr"> 337</a>         was an assembly language function.  In the direct threaded code, QUADRUPLE would look like:</div>
<div class="pre"><a id="l338" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l338" class="linenr"> 338</a> </div>
<div class="pre"><a id="l339" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l339" class="linenr"> 339</a>                 +------------------+</div>
<div class="pre"><a id="l340" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l340" class="linenr"> 340</a>                 | addr of DOUBLE  --------------------&gt; (assembly code to do the double)</div>
<div class="pre"><a id="l341" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l341" class="linenr"> 341</a>                 +------------------+                    NEXT</div>
<div class="pre"><a id="l342" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l342" class="linenr"> 342</a>         %esi -&gt; | addr of DOUBLE   |</div>
<div class="pre"><a id="l343" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l343" class="linenr"> 343</a>                 +------------------+</div>
<div class="pre"><a id="l344" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l344" class="linenr"> 344</a> </div>
<div class="pre"><a id="l345" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l345" class="linenr"> 345</a>         We can add an extra indirection to allow us to run both words written in assembly language</div>
<div class="pre"><a id="l346" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l346" class="linenr"> 346</a>         (primitives written for speed) and words written in FORTH themselves as lists of addresses.</div>
<div class="pre"><a id="l347" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l347" class="linenr"> 347</a> </div>
<div class="pre"><a id="l348" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l348" class="linenr"> 348</a>         The extra indirection is the reason for the brackets in JMP *(%eax).</div>
<div class="pre"><a id="l349" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l349" class="linenr"> 349</a> </div>
<div class="pre"><a id="l350" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l350" class="linenr"> 350</a>         Let's have a look at how QUADRUPLE and DOUBLE really look in FORTH:</div>
<div class="pre"><a id="l351" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l351" class="linenr"> 351</a> </div>
<div class="pre"><a id="l352" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l352" class="linenr"> 352</a>                 : QUADRUPLE DOUBLE DOUBLE ;</div>
<div class="pre"><a id="l353" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l353" class="linenr"> 353</a> </div>
<div class="pre"><a id="l354" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l354" class="linenr"> 354</a>                 +------------------+</div>
<div class="pre"><a id="l355" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l355" class="linenr"> 355</a>                 | codeword         |               : DOUBLE DUP + ;</div>
<div class="pre"><a id="l356" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l356" class="linenr"> 356</a>                 +------------------+</div>
<div class="pre"><a id="l357" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l357" class="linenr"> 357</a>                 | addr of DOUBLE  ---------------&gt; +------------------+</div>
<div class="pre"><a id="l358" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l358" class="linenr"> 358</a>                 +------------------+               | codeword         |</div>
<div class="pre"><a id="l359" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l359" class="linenr"> 359</a>                 | addr of DOUBLE   |               +------------------+</div>
<div class="pre"><a id="l360" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l360" class="linenr"> 360</a>                 +------------------+               | addr of DUP   --------------&gt; +------------------+</div>
<div class="pre"><a id="l361" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l361" class="linenr"> 361</a>                 | addr of EXIT     |               +------------------+            | codeword      -------+</div>
<div class="pre"><a id="l362" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l362" class="linenr"> 362</a>                 +------------------+       %esi -&gt; | addr of +     --------+       +------------------+   |</div>
<div class="pre"><a id="l363" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l363" class="linenr"> 363</a>                                                    +------------------+    |       | assembly to    &lt;-----+</div>
<div class="pre"><a id="l364" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l364" class="linenr"> 364</a>                                                    | addr of EXIT     |    |       | implement DUP    |</div>
<div class="pre"><a id="l365" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l365" class="linenr"> 365</a>                                                    +------------------+    |       |    ..            |</div>
<div class="pre"><a id="l366" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l366" class="linenr"> 366</a>                                                                            |       |    ..            |</div>
<div class="pre"><a id="l367" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l367" class="linenr"> 367</a>                                                                            |       | NEXT             |</div>
<div class="pre"><a id="l368" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l368" class="linenr"> 368</a>                                                                            |       +------------------+</div>
<div class="pre"><a id="l369" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l369" class="linenr"> 369</a>                                                                            |</div>
<div class="pre"><a id="l370" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l370" class="linenr"> 370</a>                                                                            +-----&gt; +------------------+</div>
<div class="pre"><a id="l371" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l371" class="linenr"> 371</a>                                                                                    | codeword      -------+</div>
<div class="pre"><a id="l372" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l372" class="linenr"> 372</a>                                                                                    +------------------+   |</div>
<div class="pre"><a id="l373" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l373" class="linenr"> 373</a>                                                                                    | assembly to   &lt;------+</div>
<div class="pre"><a id="l374" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l374" class="linenr"> 374</a>                                                                                    | implement +      |</div>
<div class="pre"><a id="l375" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l375" class="linenr"> 375</a>                                                                                    |    ..            |</div>
<div class="pre"><a id="l376" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l376" class="linenr"> 376</a>                                                                                    |    ..            |</div>
<div class="pre"><a id="l377" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l377" class="linenr"> 377</a>                                                                                    | NEXT             |</div>
<div class="pre"><a id="l378" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l378" class="linenr"> 378</a>                                                                                    +------------------+</div>
<div class="pre"><a id="l379" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l379" class="linenr"> 379</a> </div>
<div class="pre"><a id="l380" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l380" class="linenr"> 380</a>         This is the part where you may need an extra cup of tea/coffee/favourite caffeinated</div>
<div class="pre"><a id="l381" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l381" class="linenr"> 381</a>         beverage.  What has changed is that I've added an extra pointer to the beginning of</div>
<div class="pre"><a id="l382" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l382" class="linenr"> 382</a>         the definitions.  In FORTH this is sometimes called the "codeword".  The codeword is</div>
<div class="pre"><a id="l383" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l383" class="linenr"> 383</a>         a pointer to the interpreter to run the function.  For primitives written in</div>
<div class="pre"><a id="l384" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l384" class="linenr"> 384</a>         assembly language, the "interpreter" just points to the actual assembly code itself.</div>
<div class="pre"><a id="l385" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l385" class="linenr"> 385</a>         They don't need interpreting, they just run.</div>
<div class="pre"><a id="l386" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l386" class="linenr"> 386</a> </div>
<div class="pre"><a id="l387" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l387" class="linenr"> 387</a>         In words written in FORTH (like QUADRUPLE and DOUBLE), the codeword points to an interpreter</div>
<div class="pre"><a id="l388" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l388" class="linenr"> 388</a>         function.</div>
<div class="pre"><a id="l389" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l389" class="linenr"> 389</a> </div>
<div class="pre"><a id="l390" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l390" class="linenr"> 390</a>         I'll show you the interpreter function shortly, but let's recall our indirect</div>
<div class="pre"><a id="l391" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l391" class="linenr"> 391</a>         JMP *(%eax) with the "extra" brackets.  Take the case where we're executing DOUBLE</div>
<div class="pre"><a id="l392" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l392" class="linenr"> 392</a>         as shown, and DUP has been called.  Note that %esi is pointing to the address of +</div>
<div class="pre"><a id="l393" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l393" class="linenr"> 393</a> </div>
<div class="pre"><a id="l394" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l394" class="linenr"> 394</a>         The assembly code for DUP eventually does a NEXT.  That:</div>
<div class="pre"><a id="l395" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l395" class="linenr"> 395</a> </div>
<div class="pre"><a id="l396" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l396" class="linenr"> 396</a>         (1) reads the address of + into %eax            %eax points to the codeword of +</div>
<div class="pre"><a id="l397" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l397" class="linenr"> 397</a>         (2) increments %esi by 4</div>
<div class="pre"><a id="l398" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l398" class="linenr"> 398</a>         (3) jumps to the indirect %eax                  jumps to the address in the codeword of +,</div>
<div class="pre"><a id="l399" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l399" class="linenr"> 399</a>                                                         ie. the assembly code to implement +</div>
<div class="pre"><a id="l400" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l400" class="linenr"> 400</a> </div>
<div class="pre"><a id="l401" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l401" class="linenr"> 401</a>                 +------------------+</div>
<div class="pre"><a id="l402" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l402" class="linenr"> 402</a>                 | codeword         |</div>
<div class="pre"><a id="l403" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l403" class="linenr"> 403</a>                 +------------------+</div>
<div class="pre"><a id="l404" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l404" class="linenr"> 404</a>                 | addr of DOUBLE  ---------------&gt; +------------------+</div>
<div class="pre"><a id="l405" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l405" class="linenr"> 405</a>                 +------------------+               | codeword         |</div>
<div class="pre"><a id="l406" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l406" class="linenr"> 406</a>                 | addr of DOUBLE   |               +------------------+</div>
<div class="pre"><a id="l407" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l407" class="linenr"> 407</a>                 +------------------+               | addr of DUP   --------------&gt; +------------------+</div>
<div class="pre"><a id="l408" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l408" class="linenr"> 408</a>                 | addr of EXIT     |               +------------------+            | codeword      -------+</div>
<div class="pre"><a id="l409" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l409" class="linenr"> 409</a>                 +------------------+               | addr of +     --------+       +------------------+   |</div>
<div class="pre"><a id="l410" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l410" class="linenr"> 410</a>                                                    +------------------+    |       | assembly to    &lt;-----+</div>
<div class="pre"><a id="l411" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l411" class="linenr"> 411</a>                                            %esi -&gt; | addr of EXIT     |    |       | implement DUP    |</div>
<div class="pre"><a id="l412" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l412" class="linenr"> 412</a>                                                    +------------------+    |       |    ..            |</div>
<div class="pre"><a id="l413" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l413" class="linenr"> 413</a>                                                                            |       |    ..            |</div>
<div class="pre"><a id="l414" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l414" class="linenr"> 414</a>                                                                            |       | NEXT             |</div>
<div class="pre"><a id="l415" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l415" class="linenr"> 415</a>                                                                            |       +------------------+</div>
<div class="pre"><a id="l416" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l416" class="linenr"> 416</a>                                                                            |</div>
<div class="pre"><a id="l417" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l417" class="linenr"> 417</a>                                                                            +-----&gt; +------------------+</div>
<div class="pre"><a id="l418" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l418" class="linenr"> 418</a>                                                                                    | codeword      -------+</div>
<div class="pre"><a id="l419" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l419" class="linenr"> 419</a>                                                                                    +------------------+   |</div>
<div class="pre"><a id="l420" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l420" class="linenr"> 420</a>                                                                         now we're  | assembly to    &lt;-----+</div>
<div class="pre"><a id="l421" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l421" class="linenr"> 421</a>                                                                         executing  | implement +      |</div>
<div class="pre"><a id="l422" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l422" class="linenr"> 422</a>                                                                         this       |    ..            |</div>
<div class="pre"><a id="l423" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l423" class="linenr"> 423</a>                                                                         function   |    ..            |</div>
<div class="pre"><a id="l424" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l424" class="linenr"> 424</a>                                                                                    | NEXT             |</div>
<div class="pre"><a id="l425" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l425" class="linenr"> 425</a>                                                                                    +------------------+</div>
<div class="pre"><a id="l426" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l426" class="linenr"> 426</a> </div>
<div class="pre"><a id="l427" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l427" class="linenr"> 427</a>         So I hope that I've convinced you that NEXT does roughly what you'd expect.  This is</div>
<div class="pre"><a id="l428" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l428" class="linenr"> 428</a>         indirect threaded code.</div>
<div class="pre"><a id="l429" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l429" class="linenr"> 429</a> </div>
<div class="pre"><a id="l430" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l430" class="linenr"> 430</a>         I've glossed over four things.  I wonder if you can guess without reading on what they are?</div>
<div class="pre"><a id="l431" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l431" class="linenr"> 431</a> </div>
<div class="pre"><a id="l432" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l432" class="linenr"> 432</a>         .</div>
<div class="pre"><a id="l433" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l433" class="linenr"> 433</a>         .</div>
<div class="pre"><a id="l434" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l434" class="linenr"> 434</a>         .</div>
<div class="pre"><a id="l435" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l435" class="linenr"> 435</a> </div>
<div class="pre"><a id="l436" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l436" class="linenr"> 436</a>         My list of four things are: (1) What does "EXIT" do?  (2) which is related to (1) is how do</div>
<div class="pre"><a id="l437" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l437" class="linenr"> 437</a>         you call into a function, ie. how does %esi start off pointing at part of QUADRUPLE, but</div>
<div class="pre"><a id="l438" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l438" class="linenr"> 438</a>         then point at part of DOUBLE.  (3) What goes in the codeword for the words which are written</div>
<div class="pre"><a id="l439" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l439" class="linenr"> 439</a>         in FORTH?  (4) How do you compile a function which does anything except call other functions</div>
<div class="pre"><a id="l440" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l440" class="linenr"> 440</a>         ie. a function which contains a number like : DOUBLE 2 * ; ?</div>
<div class="pre"><a id="l441" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l441" class="linenr"> 441</a> </div>
<div class="pre"><a id="l442" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l442" class="linenr"> 442</a>         THE INTERPRETER AND RETURN STACK ------------------------------------------------------------</div>
<div class="pre"><a id="l443" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l443" class="linenr"> 443</a> </div>
<div class="pre"><a id="l444" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l444" class="linenr"> 444</a>         Going at these in no particular order, let's talk about issues (3) and (2), the interpreter</div>
<div class="pre"><a id="l445" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l445" class="linenr"> 445</a>         and the return stack.</div>
<div class="pre"><a id="l446" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l446" class="linenr"> 446</a> </div>
<div class="pre"><a id="l447" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l447" class="linenr"> 447</a>         Words which are defined in FORTH need a codeword which points to a little bit of code to</div>
<div class="pre"><a id="l448" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l448" class="linenr"> 448</a>         give them a "helping hand" in life.  They don't need much, but they do need what is known</div>
<div class="pre"><a id="l449" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l449" class="linenr"> 449</a>         as an "interpreter", although it doesn't really "interpret" in the same way that, say,</div>
<div class="pre"><a id="l450" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l450" class="linenr"> 450</a>         Java bytecode used to be interpreted (ie. slowly).  This interpreter just sets up a few</div>
<div class="pre"><a id="l451" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l451" class="linenr"> 451</a>         machine registers so that the word can then execute at full speed using the indirect</div>
<div class="pre"><a id="l452" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l452" class="linenr"> 452</a>         threaded model above.</div>
<div class="pre"><a id="l453" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l453" class="linenr"> 453</a> </div>
<div class="pre"><a id="l454" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l454" class="linenr"> 454</a>         One of the things that needs to happen when QUADRUPLE calls DOUBLE is that we save the old</div>
<div class="pre"><a id="l455" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l455" class="linenr"> 455</a>         %esi ("instruction pointer") and create a new one pointing to the first word in DOUBLE.</div>
<div class="pre"><a id="l456" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l456" class="linenr"> 456</a>         Because we will need to restore the old %esi at the end of DOUBLE (this is, after all, like</div>
<div class="pre"><a id="l457" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l457" class="linenr"> 457</a>         a function call), we will need a stack to store these "return addresses" (old values of %esi).</div>
<div class="pre"><a id="l458" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l458" class="linenr"> 458</a> </div>
<div class="pre"><a id="l459" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l459" class="linenr"> 459</a>         As you will have seen in the background documentation, FORTH has two stacks, an ordinary</div>
<div class="pre"><a id="l460" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l460" class="linenr"> 460</a>         stack for parameters, and a return stack which is a bit more mysterious.  But our return</div>
<div class="pre"><a id="l461" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l461" class="linenr"> 461</a>         stack is just the stack I talked about in the previous paragraph, used to save %esi when</div>
<div class="pre"><a id="l462" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l462" class="linenr"> 462</a>         calling from a FORTH word into another FORTH word.</div>
<div class="pre"><a id="l463" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l463" class="linenr"> 463</a> </div>
<div class="pre"><a id="l464" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l464" class="linenr"> 464</a>         In this FORTH, we are using the normal stack pointer (%esp) for the parameter stack.</div>
<div class="pre"><a id="l465" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l465" class="linenr"> 465</a>         We will use the i386's "other" stack pointer (%ebp, usually called the "frame pointer")</div>
<div class="pre"><a id="l466" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l466" class="linenr"> 466</a>         for our return stack.</div>
<div class="pre"><a id="l467" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l467" class="linenr"> 467</a> </div>
<div class="pre"><a id="l468" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l468" class="linenr"> 468</a>         I've got two macros which just wrap up the details of using %ebp for the return stack.</div>
<div class="pre"><a id="l469" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l469" class="linenr"> 469</a>         You use them as for example "PUSHRSP %eax" (push %eax on the return stack) or "POPRSP %ebx"</div>
<div class="pre"><a id="l470" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l470" class="linenr"> 470</a>         (pop top of return stack into %ebx).</div>
<div class="pre"><a id="l471" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l471" class="linenr"> 471</a> */</div>
<div class="pre"><a id="l472" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l472" class="linenr"> 472</a> </div>
<div class="pre"><a id="l473" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l473" class="linenr"> 473</a> /* Macros to deal with the return stack. */</div>
<div class="pre"><a id="l474" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l474" class="linenr"> 474</a>         .macro PUSHRSP reg</div>
<div class="pre"><a id="l475" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l475" class="linenr"> 475</a>         lea -4(%ebp),%ebp       // push reg on to return stack</div>
<div class="pre"><a id="l476" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l476" class="linenr"> 476</a>         movl \reg,(%ebp)</div>
<div class="pre"><a id="l477" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l477" class="linenr"> 477</a>         .endm</div>
<div class="pre"><a id="l478" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l478" class="linenr"> 478</a> </div>
<div class="pre"><a id="l479" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l479" class="linenr"> 479</a>         .macro POPRSP reg</div>
<div class="pre"><a id="l480" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l480" class="linenr"> 480</a>         mov (%ebp),\reg         // pop top of return stack to reg</div>
<div class="pre"><a id="l481" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l481" class="linenr"> 481</a>         lea 4(%ebp),%ebp</div>
<div class="pre"><a id="l482" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l482" class="linenr"> 482</a>         .endm</div>
<div class="pre"><a id="l483" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l483" class="linenr"> 483</a> </div>
<div class="pre"><a id="l484" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l484" class="linenr"> 484</a> /*</div>
<div class="pre"><a id="l485" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l485" class="linenr"> 485</a>         And with that we can now talk about the interpreter.</div>
<div class="pre"><a id="l486" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l486" class="linenr"> 486</a> </div>
<div class="pre"><a id="l487" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l487" class="linenr"> 487</a>         In FORTH the interpreter function is often called DOCOL (I think it means "DO COLON" because</div>
<div class="pre"><a id="l488" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l488" class="linenr"> 488</a>         all FORTH definitions start with a colon, as in : DOUBLE DUP + ;</div>
<div class="pre"><a id="l489" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l489" class="linenr"> 489</a> </div>
<div class="pre"><a id="l490" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l490" class="linenr"> 490</a>         The "interpreter" (it's not really "interpreting") just needs to push the old %esi on the</div>
<div class="pre"><a id="l491" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l491" class="linenr"> 491</a>         stack and set %esi to the first word in the definition.  Remember that we jumped to the</div>
<div class="pre"><a id="l492" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l492" class="linenr"> 492</a>         function using JMP *(%eax)?  Well a consequence of that is that conveniently %eax contains</div>
<div class="pre"><a id="l493" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l493" class="linenr"> 493</a>         the address of this codeword, so just by adding 4 to it we get the address of the first</div>
<div class="pre"><a id="l494" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l494" class="linenr"> 494</a>         data word.  Finally after setting up %esi, it just does NEXT which causes that first word</div>
<div class="pre"><a id="l495" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l495" class="linenr"> 495</a>         to run.</div>
<div class="pre"><a id="l496" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l496" class="linenr"> 496</a> */</div>
<div class="pre"><a id="l497" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l497" class="linenr"> 497</a> </div>
<div class="pre"><a id="l498" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l498" class="linenr"> 498</a> /* DOCOL - the interpreter! */</div>
<div class="pre"><a id="l499" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l499" class="linenr"> 499</a>         .text</div>
<div class="pre"><a id="l500" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l500" class="linenr"> 500</a>         .align 4</div>
<div class="pre"><a id="l501" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l501" class="linenr"> 501</a> DOCOL:</div>
<div class="pre"><a id="l502" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l502" class="linenr"> 502</a>         PUSHRSP %esi            // push %esi on to the return stack</div>
<div class="pre"><a id="l503" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l503" class="linenr"> 503</a>         addl $4,%eax            // %eax points to codeword, so make</div>
<div class="pre"><a id="l504" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l504" class="linenr"> 504</a>         movl %eax,%esi          // %esi point to first data word</div>
<div class="pre"><a id="l505" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l505" class="linenr"> 505</a>         NEXT</div>
<div class="pre"><a id="l506" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l506" class="linenr"> 506</a> </div>
<div class="pre"><a id="l507" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l507" class="linenr"> 507</a> /*</div>
<div class="pre"><a id="l508" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l508" class="linenr"> 508</a>         Just to make this absolutely clear, let's see how DOCOL works when jumping from QUADRUPLE</div>
<div class="pre"><a id="l509" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l509" class="linenr"> 509</a>         into DOUBLE:</div>
<div class="pre"><a id="l510" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l510" class="linenr"> 510</a> </div>
<div class="pre"><a id="l511" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l511" class="linenr"> 511</a>                 QUADRUPLE:</div>
<div class="pre"><a id="l512" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l512" class="linenr"> 512</a>                 +------------------+</div>
<div class="pre"><a id="l513" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l513" class="linenr"> 513</a>                 | codeword         |</div>
<div class="pre"><a id="l514" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l514" class="linenr"> 514</a>                 +------------------+               DOUBLE:</div>
<div class="pre"><a id="l515" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l515" class="linenr"> 515</a>                 | addr of DOUBLE  ---------------&gt; +------------------+</div>
<div class="pre"><a id="l516" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l516" class="linenr"> 516</a>                 +------------------+       %eax -&gt; | addr of DOCOL    |</div>
<div class="pre"><a id="l517" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l517" class="linenr"> 517</a>         %esi -&gt; | addr of DOUBLE   |               +------------------+</div>
<div class="pre"><a id="l518" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l518" class="linenr"> 518</a>                 +------------------+               | addr of DUP      |</div>
<div class="pre"><a id="l519" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l519" class="linenr"> 519</a>                 | addr of EXIT     |               +------------------+</div>
<div class="pre"><a id="l520" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l520" class="linenr"> 520</a>                 +------------------+               | etc.             |</div>
<div class="pre"><a id="l521" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l521" class="linenr"> 521</a> </div>
<div class="pre"><a id="l522" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l522" class="linenr"> 522</a>         First, the call to DOUBLE calls DOCOL (the codeword of DOUBLE).  DOCOL does this:  It</div>
<div class="pre"><a id="l523" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l523" class="linenr"> 523</a>         pushes the old %esi on the return stack.  %eax points to the codeword of DOUBLE, so we</div>
<div class="pre"><a id="l524" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l524" class="linenr"> 524</a>         just add 4 on to it to get our new %esi:</div>
<div class="pre"><a id="l525" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l525" class="linenr"> 525</a> </div>
<div class="pre"><a id="l526" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l526" class="linenr"> 526</a>                 QUADRUPLE:</div>
<div class="pre"><a id="l527" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l527" class="linenr"> 527</a>                 +------------------+</div>
<div class="pre"><a id="l528" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l528" class="linenr"> 528</a>                 | codeword         |</div>
<div class="pre"><a id="l529" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l529" class="linenr"> 529</a>                 +------------------+               DOUBLE:</div>
<div class="pre"><a id="l530" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l530" class="linenr"> 530</a>                 | addr of DOUBLE  ---------------&gt; +------------------+</div>
<div class="pre"><a id="l531" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l531" class="linenr"> 531</a> top of return   +------------------+       %eax -&gt; | addr of DOCOL    |</div>
<div class="pre"><a id="l532" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l532" class="linenr"> 532</a> stack points -&gt; | addr of DOUBLE   |       + 4 =   +------------------+</div>
<div class="pre"><a id="l533" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l533" class="linenr"> 533</a>                 +------------------+       %esi -&gt; | addr of DUP      |</div>
<div class="pre"><a id="l534" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l534" class="linenr"> 534</a>                 | addr of EXIT     |               +------------------+</div>
<div class="pre"><a id="l535" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l535" class="linenr"> 535</a>                 +------------------+               | etc.             |</div>
<div class="pre"><a id="l536" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l536" class="linenr"> 536</a> </div>
<div class="pre"><a id="l537" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l537" class="linenr"> 537</a>         Then we do NEXT, and because of the magic of threaded code that increments %esi again</div>
<div class="pre"><a id="l538" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l538" class="linenr"> 538</a>         and calls DUP.</div>
<div class="pre"><a id="l539" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l539" class="linenr"> 539</a> </div>
<div class="pre"><a id="l540" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l540" class="linenr"> 540</a>         Well, it seems to work.</div>
<div class="pre"><a id="l541" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l541" class="linenr"> 541</a> </div>
<div class="pre"><a id="l542" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l542" class="linenr"> 542</a>         One minor point here.  Because DOCOL is the first bit of assembly actually to be defined</div>
<div class="pre"><a id="l543" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l543" class="linenr"> 543</a>         in this file (the others were just macros), and because I usually compile this code with the</div>
<div class="pre"><a id="l544" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l544" class="linenr"> 544</a>         text segment starting at address 0, DOCOL has address 0.  So if you are disassembling the</div>
<div class="pre"><a id="l545" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l545" class="linenr"> 545</a>         code and see a word with a codeword of 0, you will immediately know that the word is</div>
<div class="pre"><a id="l546" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l546" class="linenr"> 546</a>         written in FORTH (it's not an assembler primitive) and so uses DOCOL as the interpreter.</div>
<div class="pre"><a id="l547" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l547" class="linenr"> 547</a> </div>
<div class="pre"><a id="l548" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l548" class="linenr"> 548</a>         STARTING UP ----------------------------------------------------------------------</div>
<div class="pre"><a id="l549" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l549" class="linenr"> 549</a> </div>
<div class="pre"><a id="l550" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l550" class="linenr"> 550</a>         Now let's get down to nuts and bolts.  When we start the program we need to set up</div>
<div class="pre"><a id="l551" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l551" class="linenr"> 551</a>         a few things like the return stack.  But as soon as we can, we want to jump into FORTH</div>
<div class="pre"><a id="l552" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l552" class="linenr"> 552</a>         code (albeit much of the "early" FORTH code will still need to be written as</div>
<div class="pre"><a id="l553" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l553" class="linenr"> 553</a>         assembly language primitives).</div>
<div class="pre"><a id="l554" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l554" class="linenr"> 554</a> </div>
<div class="pre"><a id="l555" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l555" class="linenr"> 555</a>         This is what the set up code does.  Does a tiny bit of house-keeping, sets up the</div>
<div class="pre"><a id="l556" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l556" class="linenr"> 556</a>         separate return stack (NB: Linux gives us the ordinary parameter stack already), then</div>
<div class="pre"><a id="l557" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l557" class="linenr"> 557</a>         immediately jumps to a FORTH word called QUIT.  Despite its name, QUIT doesn't quit</div>
<div class="pre"><a id="l558" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l558" class="linenr"> 558</a>         anything.  It resets some internal state and starts reading and interpreting commands.</div>
<div class="pre"><a id="l559" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l559" class="linenr"> 559</a>         (The reason it is called QUIT is because you can call QUIT from your own FORTH code</div>
<div class="pre"><a id="l560" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l560" class="linenr"> 560</a>         to "quit" your program and go back to interpreting).</div>
<div class="pre"><a id="l561" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l561" class="linenr"> 561</a> */</div>
<div class="pre"><a id="l562" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l562" class="linenr"> 562</a> </div>
<div class="pre"><a id="l563" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l563" class="linenr"> 563</a> /* Assembler entry point. */</div>
<div class="pre"><a id="l564" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l564" class="linenr"> 564</a>         .text</div>
<div class="pre"><a id="l565" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l565" class="linenr"> 565</a>         .globl _start</div>
<div class="pre"><a id="l566" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l566" class="linenr"> 566</a> _start:</div>
<div class="pre"><a id="l567" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l567" class="linenr"> 567</a>         cld</div>
<div class="pre"><a id="l568" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l568" class="linenr"> 568</a>         mov %esp,var_S0         // Save the initial data stack pointer in FORTH variable S0.</div>
<div class="pre"><a id="l569" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l569" class="linenr"> 569</a>         mov $return_stack_top,%ebp // Initialise the return stack.</div>
<div class="pre"><a id="l570" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l570" class="linenr"> 570</a>         call set_up_data_segment</div>
<div class="pre"><a id="l571" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l571" class="linenr"> 571</a> </div>
<div class="pre"><a id="l572" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l572" class="linenr"> 572</a>         mov $cold_start,%esi    // Initialise interpreter.</div>
<div class="pre"><a id="l573" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l573" class="linenr"> 573</a>         NEXT                    // Run interpreter!</div>
<div class="pre"><a id="l574" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l574" class="linenr"> 574</a> </div>
<div class="pre"><a id="l575" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l575" class="linenr"> 575</a>         .section .rodata</div>
<div class="pre"><a id="l576" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l576" class="linenr"> 576</a> cold_start:                     // High-level code without a codeword.</div>
<div class="pre"><a id="l577" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l577" class="linenr"> 577</a>         .int QUIT</div>
<div class="pre"><a id="l578" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l578" class="linenr"> 578</a> </div>
<div class="pre"><a id="l579" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l579" class="linenr"> 579</a> /*</div>
<div class="pre"><a id="l580" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l580" class="linenr"> 580</a>         BUILT-IN WORDS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l581" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l581" class="linenr"> 581</a> </div>
<div class="pre"><a id="l582" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l582" class="linenr"> 582</a>         Remember our dictionary entries (headers)?  Let's bring those together with the codeword</div>
<div class="pre"><a id="l583" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l583" class="linenr"> 583</a>         and data words to see how : DOUBLE DUP + ; really looks in memory.</div>
<div class="pre"><a id="l584" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l584" class="linenr"> 584</a> </div>
<div class="pre"><a id="l585" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l585" class="linenr"> 585</a>           pointer to previous word</div>
<div class="pre"><a id="l586" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l586" class="linenr"> 586</a>            ^</div>
<div class="pre"><a id="l587" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l587" class="linenr"> 587</a>            |</div>
<div class="pre"><a id="l588" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l588" class="linenr"> 588</a>         +--|------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l589" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l589" class="linenr"> 589</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          | EXIT       |</div>
<div class="pre"><a id="l590" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l590" class="linenr"> 590</a>         +---------+---+---+---+---+---+---+---+---+------------+--|---------+------------+------------+</div>
<div class="pre"><a id="l591" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l591" class="linenr"> 591</a>            ^       len                         pad  codeword      |</div>
<div class="pre"><a id="l592" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l592" class="linenr"> 592</a>            |                                                      V</div>
<div class="pre"><a id="l593" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l593" class="linenr"> 593</a>           LINK in next word                             points to codeword of DUP</div>
<div class="pre"><a id="l594" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l594" class="linenr"> 594</a>         </div>
<div class="pre"><a id="l595" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l595" class="linenr"> 595</a>         Initially we can't just write ": DOUBLE DUP + ;" (ie. that literal string) here because we</div>
<div class="pre"><a id="l596" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l596" class="linenr"> 596</a>         don't yet have anything to read the string, break it up at spaces, parse each word, etc. etc.</div>
<div class="pre"><a id="l597" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l597" class="linenr"> 597</a>         So instead we will have to define built-in words using the GNU assembler data constructors</div>
<div class="pre"><a id="l598" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l598" class="linenr"> 598</a>         (like .int, .byte, .string, .ascii and so on -- look them up in the gas info page if you are</div>
<div class="pre"><a id="l599" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l599" class="linenr"> 599</a>         unsure of them).</div>
<div class="pre"><a id="l600" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l600" class="linenr"> 600</a> </div>
<div class="pre"><a id="l601" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l601" class="linenr"> 601</a>         The long way would be:</div>
<div class="pre"><a id="l602" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l602" class="linenr"> 602</a> </div>
<div class="pre"><a id="l603" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l603" class="linenr"> 603</a>         .int &lt;link to previous word&gt;</div>
<div class="pre"><a id="l604" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l604" class="linenr"> 604</a>         .byte 6                 // len</div>
<div class="pre"><a id="l605" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l605" class="linenr"> 605</a>         .ascii "DOUBLE"         // string</div>
<div class="pre"><a id="l606" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l606" class="linenr"> 606</a>         .byte 0                 // padding</div>
<div class="pre"><a id="l607" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l607" class="linenr"> 607</a> DOUBLE: .int DOCOL              // codeword</div>
<div class="pre"><a id="l608" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l608" class="linenr"> 608</a>         .int DUP                // pointer to codeword of DUP</div>
<div class="pre"><a id="l609" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l609" class="linenr"> 609</a>         .int PLUS               // pointer to codeword of +</div>
<div class="pre"><a id="l610" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l610" class="linenr"> 610</a>         .int EXIT               // pointer to codeword of EXIT</div>
<div class="pre"><a id="l611" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l611" class="linenr"> 611</a> </div>
<div class="pre"><a id="l612" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l612" class="linenr"> 612</a>         That's going to get quite tedious rather quickly, so here I define an assembler macro</div>
<div class="pre"><a id="l613" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l613" class="linenr"> 613</a>         so that I can just write:</div>
<div class="pre"><a id="l614" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l614" class="linenr"> 614</a> </div>
<div class="pre"><a id="l615" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l615" class="linenr"> 615</a>         defword "DOUBLE",6,,DOUBLE</div>
<div class="pre"><a id="l616" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l616" class="linenr"> 616</a>         .int DUP,PLUS,EXIT</div>
<div class="pre"><a id="l617" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l617" class="linenr"> 617</a> </div>
<div class="pre"><a id="l618" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l618" class="linenr"> 618</a>         and I'll get exactly the same effect.</div>
<div class="pre"><a id="l619" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l619" class="linenr"> 619</a> </div>
<div class="pre"><a id="l620" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l620" class="linenr"> 620</a>         Don't worry too much about the exact implementation details of this macro - it's complicated!</div>
<div class="pre"><a id="l621" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l621" class="linenr"> 621</a> */</div>
<div class="pre"><a id="l622" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l622" class="linenr"> 622</a> </div>
<div class="pre"><a id="l623" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l623" class="linenr"> 623</a> /* Flags - these are discussed later. */</div>
<div class="pre"><a id="l624" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l624" class="linenr"> 624</a>         .set F_IMMED,0x80</div>
<div class="pre"><a id="l625" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l625" class="linenr"> 625</a>         .set F_HIDDEN,0x20</div>
<div class="pre"><a id="l626" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l626" class="linenr"> 626</a>         .set F_LENMASK,0x1f     // length mask</div>
<div class="pre"><a id="l627" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l627" class="linenr"> 627</a> </div>
<div class="pre"><a id="l628" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l628" class="linenr"> 628</a>         // Store the chain of links.</div>
<div class="pre"><a id="l629" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l629" class="linenr"> 629</a>         .set link,0</div>
<div class="pre"><a id="l630" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l630" class="linenr"> 630</a> </div>
<div class="pre"><a id="l631" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l631" class="linenr"> 631</a>         .macro defword name, namelen, flags=0, label</div>
<div class="pre"><a id="l632" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l632" class="linenr"> 632</a>         .section .rodata</div>
<div class="pre"><a id="l633" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l633" class="linenr"> 633</a>         .align 4</div>
<div class="pre"><a id="l634" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l634" class="linenr"> 634</a>         .globl name_\label</div>
<div class="pre"><a id="l635" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l635" class="linenr"> 635</a> name_\label :</div>
<div class="pre"><a id="l636" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l636" class="linenr"> 636</a>         .int link               // link</div>
<div class="pre"><a id="l637" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l637" class="linenr"> 637</a>         .set link,name_\label</div>
<div class="pre"><a id="l638" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l638" class="linenr"> 638</a>         .byte \flags+\namelen   // flags + length byte</div>
<div class="pre"><a id="l639" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l639" class="linenr"> 639</a>         .ascii "\name"          // the name</div>
<div class="pre"><a id="l640" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l640" class="linenr"> 640</a>         .align 4                // padding to next 4 byte boundary</div>
<div class="pre"><a id="l641" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l641" class="linenr"> 641</a>         .globl \label</div>
<div class="pre"><a id="l642" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l642" class="linenr"> 642</a> \label :</div>
<div class="pre"><a id="l643" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l643" class="linenr"> 643</a>         .int DOCOL              // codeword - the interpreter</div>
<div class="pre"><a id="l644" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l644" class="linenr"> 644</a>         // list of word pointers follow</div>
<div class="pre"><a id="l645" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l645" class="linenr"> 645</a>         .endm</div>
<div class="pre"><a id="l646" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l646" class="linenr"> 646</a> </div>
<div class="pre"><a id="l647" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l647" class="linenr"> 647</a> /*</div>
<div class="pre"><a id="l648" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l648" class="linenr"> 648</a>         Similarly I want a way to write words written in assembly language.  There will quite a few</div>
<div class="pre"><a id="l649" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l649" class="linenr"> 649</a>         of these to start with because, well, everything has to start in assembly before there's</div>
<div class="pre"><a id="l650" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l650" class="linenr"> 650</a>         enough "infrastructure" to be able to start writing FORTH words, but also I want to define</div>
<div class="pre"><a id="l651" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l651" class="linenr"> 651</a>         some common FORTH words in assembly language for speed, even though I could write them in FORTH.</div>
<div class="pre"><a id="l652" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l652" class="linenr"> 652</a> </div>
<div class="pre"><a id="l653" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l653" class="linenr"> 653</a>         This is what DUP looks like in memory:</div>
<div class="pre"><a id="l654" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l654" class="linenr"> 654</a> </div>
<div class="pre"><a id="l655" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l655" class="linenr"> 655</a>           pointer to previous word</div>
<div class="pre"><a id="l656" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l656" class="linenr"> 656</a>            ^</div>
<div class="pre"><a id="l657" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l657" class="linenr"> 657</a>            |</div>
<div class="pre"><a id="l658" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l658" class="linenr"> 658</a>         +--|------+---+---+---+---+------------+</div>
<div class="pre"><a id="l659" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l659" class="linenr"> 659</a>         | LINK    | 3 | D | U | P | code_DUP ---------------------&gt; points to the assembly</div>
<div class="pre"><a id="l660" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l660" class="linenr"> 660</a>         +---------+---+---+---+---+------------+                    code used to write DUP,</div>
<div class="pre"><a id="l661" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l661" class="linenr"> 661</a>            ^       len              codeword                        which ends with NEXT.</div>
<div class="pre"><a id="l662" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l662" class="linenr"> 662</a>            |</div>
<div class="pre"><a id="l663" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l663" class="linenr"> 663</a>           LINK in next word</div>
<div class="pre"><a id="l664" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l664" class="linenr"> 664</a> </div>
<div class="pre"><a id="l665" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l665" class="linenr"> 665</a>         Again, for brevity in writing the header I'm going to write an assembler macro called defcode.</div>
<div class="pre"><a id="l666" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l666" class="linenr"> 666</a>         As with defword above, don't worry about the complicated details of the macro.</div>
<div class="pre"><a id="l667" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l667" class="linenr"> 667</a> */</div>
<div class="pre"><a id="l668" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l668" class="linenr"> 668</a> </div>
<div class="pre"><a id="l669" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l669" class="linenr"> 669</a>         .macro defcode name, namelen, flags=0, label</div>
<div class="pre"><a id="l670" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l670" class="linenr"> 670</a>         .section .rodata</div>
<div class="pre"><a id="l671" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l671" class="linenr"> 671</a>         .align 4</div>
<div class="pre"><a id="l672" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l672" class="linenr"> 672</a>         .globl name_\label</div>
<div class="pre"><a id="l673" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l673" class="linenr"> 673</a> name_\label :</div>
<div class="pre"><a id="l674" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l674" class="linenr"> 674</a>         .int link               // link</div>
<div class="pre"><a id="l675" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l675" class="linenr"> 675</a>         .set link,name_\label</div>
<div class="pre"><a id="l676" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l676" class="linenr"> 676</a>         .byte \flags+\namelen   // flags + length byte</div>
<div class="pre"><a id="l677" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l677" class="linenr"> 677</a>         .ascii "\name"          // the name</div>
<div class="pre"><a id="l678" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l678" class="linenr"> 678</a>         .align 4                // padding to next 4 byte boundary</div>
<div class="pre"><a id="l679" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l679" class="linenr"> 679</a>         .globl \label</div>
<div class="pre"><a id="l680" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l680" class="linenr"> 680</a> \label :</div>
<div class="pre"><a id="l681" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l681" class="linenr"> 681</a>         .int code_\label        // codeword</div>
<div class="pre"><a id="l682" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l682" class="linenr"> 682</a>         .text</div>
<div class="pre"><a id="l683" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l683" class="linenr"> 683</a>         //.align 4</div>
<div class="pre"><a id="l684" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l684" class="linenr"> 684</a>         .globl code_\label</div>
<div class="pre"><a id="l685" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l685" class="linenr"> 685</a> code_\label :                   // assembler code follows</div>
<div class="pre"><a id="l686" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l686" class="linenr"> 686</a>         .endm</div>
<div class="pre"><a id="l687" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l687" class="linenr"> 687</a> </div>
<div class="pre"><a id="l688" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l688" class="linenr"> 688</a> /*</div>
<div class="pre"><a id="l689" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l689" class="linenr"> 689</a>         Now some easy FORTH primitives.  These are written in assembly for speed.  If you understand</div>
<div class="pre"><a id="l690" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l690" class="linenr"> 690</a>         i386 assembly language then it is worth reading these.  However if you don't understand assembly</div>
<div class="pre"><a id="l691" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l691" class="linenr"> 691</a>         you can skip the details.</div>
<div class="pre"><a id="l692" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l692" class="linenr"> 692</a> */</div>
<div class="pre"><a id="l693" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l693" class="linenr"> 693</a> </div>
<div class="pre"><a id="l694" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l694" class="linenr"> 694</a>         defcode "DROP",4,,DROP</div>
<div class="pre"><a id="l695" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l695" class="linenr"> 695</a>         pop %eax                // drop top of stack</div>
<div class="pre"><a id="l696" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l696" class="linenr"> 696</a>         NEXT</div>
<div class="pre"><a id="l697" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l697" class="linenr"> 697</a> </div>
<div class="pre"><a id="l698" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l698" class="linenr"> 698</a>         defcode "SWAP",4,,SWAP</div>
<div class="pre"><a id="l699" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l699" class="linenr"> 699</a>         pop %eax                // swap top two elements on stack</div>
<div class="pre"><a id="l700" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l700" class="linenr"> 700</a>         pop %ebx</div>
<div class="pre"><a id="l701" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l701" class="linenr"> 701</a>         push %eax</div>
<div class="pre"><a id="l702" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l702" class="linenr"> 702</a>         push %ebx</div>
<div class="pre"><a id="l703" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l703" class="linenr"> 703</a>         NEXT</div>
<div class="pre"><a id="l704" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l704" class="linenr"> 704</a> </div>
<div class="pre"><a id="l705" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l705" class="linenr"> 705</a>         defcode "DUP",3,,DUP</div>
<div class="pre"><a id="l706" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l706" class="linenr"> 706</a>         mov (%esp),%eax         // duplicate top of stack</div>
<div class="pre"><a id="l707" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l707" class="linenr"> 707</a>         push %eax</div>
<div class="pre"><a id="l708" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l708" class="linenr"> 708</a>         NEXT</div>
<div class="pre"><a id="l709" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l709" class="linenr"> 709</a> </div>
<div class="pre"><a id="l710" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l710" class="linenr"> 710</a>         defcode "OVER",4,,OVER</div>
<div class="pre"><a id="l711" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l711" class="linenr"> 711</a>         mov 4(%esp),%eax        // get the second element of stack</div>
<div class="pre"><a id="l712" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l712" class="linenr"> 712</a>         push %eax               // and push it on top</div>
<div class="pre"><a id="l713" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l713" class="linenr"> 713</a>         NEXT</div>
<div class="pre"><a id="l714" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l714" class="linenr"> 714</a> </div>
<div class="pre"><a id="l715" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l715" class="linenr"> 715</a>         defcode "ROT",3,,ROT</div>
<div class="pre"><a id="l716" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l716" class="linenr"> 716</a>         pop %eax</div>
<div class="pre"><a id="l717" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l717" class="linenr"> 717</a>         pop %ebx</div>
<div class="pre"><a id="l718" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l718" class="linenr"> 718</a>         pop %ecx</div>
<div class="pre"><a id="l719" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l719" class="linenr"> 719</a>         push %ebx</div>
<div class="pre"><a id="l720" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l720" class="linenr"> 720</a>         push %eax</div>
<div class="pre"><a id="l721" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l721" class="linenr"> 721</a>         push %ecx</div>
<div class="pre"><a id="l722" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l722" class="linenr"> 722</a>         NEXT</div>
<div class="pre"><a id="l723" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l723" class="linenr"> 723</a> </div>
<div class="pre"><a id="l724" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l724" class="linenr"> 724</a>         defcode "-ROT",4,,NROT</div>
<div class="pre"><a id="l725" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l725" class="linenr"> 725</a>         pop %eax</div>
<div class="pre"><a id="l726" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l726" class="linenr"> 726</a>         pop %ebx</div>
<div class="pre"><a id="l727" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l727" class="linenr"> 727</a>         pop %ecx</div>
<div class="pre"><a id="l728" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l728" class="linenr"> 728</a>         push %eax</div>
<div class="pre"><a id="l729" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l729" class="linenr"> 729</a>         push %ecx</div>
<div class="pre"><a id="l730" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l730" class="linenr"> 730</a>         push %ebx</div>
<div class="pre"><a id="l731" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l731" class="linenr"> 731</a>         NEXT</div>
<div class="pre"><a id="l732" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l732" class="linenr"> 732</a> </div>
<div class="pre"><a id="l733" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l733" class="linenr"> 733</a>         defcode "2DROP",5,,TWODROP // drop top two elements of stack</div>
<div class="pre"><a id="l734" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l734" class="linenr"> 734</a>         pop %eax</div>
<div class="pre"><a id="l735" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l735" class="linenr"> 735</a>         pop %eax</div>
<div class="pre"><a id="l736" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l736" class="linenr"> 736</a>         NEXT</div>
<div class="pre"><a id="l737" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l737" class="linenr"> 737</a> </div>
<div class="pre"><a id="l738" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l738" class="linenr"> 738</a>         defcode "2DUP",4,,TWODUP // duplicate top two elements of stack</div>
<div class="pre"><a id="l739" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l739" class="linenr"> 739</a>         mov (%esp),%eax</div>
<div class="pre"><a id="l740" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l740" class="linenr"> 740</a>         mov 4(%esp),%ebx</div>
<div class="pre"><a id="l741" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l741" class="linenr"> 741</a>         push %ebx</div>
<div class="pre"><a id="l742" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l742" class="linenr"> 742</a>         push %eax</div>
<div class="pre"><a id="l743" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l743" class="linenr"> 743</a>         NEXT</div>
<div class="pre"><a id="l744" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l744" class="linenr"> 744</a> </div>
<div class="pre"><a id="l745" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l745" class="linenr"> 745</a>         defcode "2SWAP",5,,TWOSWAP // swap top two pairs of elements of stack</div>
<div class="pre"><a id="l746" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l746" class="linenr"> 746</a>         pop %eax</div>
<div class="pre"><a id="l747" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l747" class="linenr"> 747</a>         pop %ebx</div>
<div class="pre"><a id="l748" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l748" class="linenr"> 748</a>         pop %ecx</div>
<div class="pre"><a id="l749" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l749" class="linenr"> 749</a>         pop %edx</div>
<div class="pre"><a id="l750" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l750" class="linenr"> 750</a>         push %ebx</div>
<div class="pre"><a id="l751" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l751" class="linenr"> 751</a>         push %eax</div>
<div class="pre"><a id="l752" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l752" class="linenr"> 752</a>         push %edx</div>
<div class="pre"><a id="l753" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l753" class="linenr"> 753</a>         push %ecx</div>
<div class="pre"><a id="l754" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l754" class="linenr"> 754</a>         NEXT</div>
<div class="pre"><a id="l755" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l755" class="linenr"> 755</a> </div>
<div class="pre"><a id="l756" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l756" class="linenr"> 756</a>         defcode "?DUP",4,,QDUP  // duplicate top of stack if non-zero</div>
<div class="pre"><a id="l757" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l757" class="linenr"> 757</a>         movl (%esp),%eax</div>
<div class="pre"><a id="l758" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l758" class="linenr"> 758</a>         test %eax,%eax</div>
<div class="pre"><a id="l759" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l759" class="linenr"> 759</a>         jz 1f</div>
<div class="pre"><a id="l760" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l760" class="linenr"> 760</a>         push %eax</div>
<div class="pre"><a id="l761" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l761" class="linenr"> 761</a> 1:      NEXT</div>
<div class="pre"><a id="l762" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l762" class="linenr"> 762</a> </div>
<div class="pre"><a id="l763" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l763" class="linenr"> 763</a>         defcode "1+",2,,INCR</div>
<div class="pre"><a id="l764" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l764" class="linenr"> 764</a>         incl (%esp)             // increment top of stack</div>
<div class="pre"><a id="l765" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l765" class="linenr"> 765</a>         NEXT</div>
<div class="pre"><a id="l766" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l766" class="linenr"> 766</a> </div>
<div class="pre"><a id="l767" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l767" class="linenr"> 767</a>         defcode "1-",2,,DECR</div>
<div class="pre"><a id="l768" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l768" class="linenr"> 768</a>         decl (%esp)             // decrement top of stack</div>
<div class="pre"><a id="l769" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l769" class="linenr"> 769</a>         NEXT</div>
<div class="pre"><a id="l770" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l770" class="linenr"> 770</a> </div>
<div class="pre"><a id="l771" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l771" class="linenr"> 771</a>         defcode "4+",2,,INCR4</div>
<div class="pre"><a id="l772" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l772" class="linenr"> 772</a>         addl $4,(%esp)          // add 4 to top of stack</div>
<div class="pre"><a id="l773" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l773" class="linenr"> 773</a>         NEXT</div>
<div class="pre"><a id="l774" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l774" class="linenr"> 774</a> </div>
<div class="pre"><a id="l775" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l775" class="linenr"> 775</a>         defcode "4-",2,,DECR4</div>
<div class="pre"><a id="l776" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l776" class="linenr"> 776</a>         subl $4,(%esp)          // subtract 4 from top of stack</div>
<div class="pre"><a id="l777" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l777" class="linenr"> 777</a>         NEXT</div>
<div class="pre"><a id="l778" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l778" class="linenr"> 778</a> </div>
<div class="pre"><a id="l779" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l779" class="linenr"> 779</a>         defcode "+",1,,ADD</div>
<div class="pre"><a id="l780" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l780" class="linenr"> 780</a>         pop %eax                // get top of stack</div>
<div class="pre"><a id="l781" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l781" class="linenr"> 781</a>         addl %eax,(%esp)        // and add it to next word on stack</div>
<div class="pre"><a id="l782" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l782" class="linenr"> 782</a>         NEXT</div>
<div class="pre"><a id="l783" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l783" class="linenr"> 783</a> </div>
<div class="pre"><a id="l784" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l784" class="linenr"> 784</a>         defcode "-",1,,SUB</div>
<div class="pre"><a id="l785" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l785" class="linenr"> 785</a>         pop %eax                // get top of stack</div>
<div class="pre"><a id="l786" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l786" class="linenr"> 786</a>         subl %eax,(%esp)        // and subtract it from next word on stack</div>
<div class="pre"><a id="l787" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l787" class="linenr"> 787</a>         NEXT</div>
<div class="pre"><a id="l788" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l788" class="linenr"> 788</a> </div>
<div class="pre"><a id="l789" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l789" class="linenr"> 789</a>         defcode "*",1,,MUL</div>
<div class="pre"><a id="l790" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l790" class="linenr"> 790</a>         pop %eax</div>
<div class="pre"><a id="l791" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l791" class="linenr"> 791</a>         pop %ebx</div>
<div class="pre"><a id="l792" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l792" class="linenr"> 792</a>         imull %ebx,%eax</div>
<div class="pre"><a id="l793" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l793" class="linenr"> 793</a>         push %eax               // ignore overflow</div>
<div class="pre"><a id="l794" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l794" class="linenr"> 794</a>         NEXT</div>
<div class="pre"><a id="l795" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l795" class="linenr"> 795</a> </div>
<div class="pre"><a id="l796" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l796" class="linenr"> 796</a> /*</div>
<div class="pre"><a id="l797" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l797" class="linenr"> 797</a>         In this FORTH, only /MOD is primitive.  Later we will define the / and MOD words in</div>
<div class="pre"><a id="l798" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l798" class="linenr"> 798</a>         terms of the primitive /MOD.  The design of the i386 assembly instruction idiv which</div>
<div class="pre"><a id="l799" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l799" class="linenr"> 799</a>         leaves both quotient and remainder makes this the obvious choice.</div>
<div class="pre"><a id="l800" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l800" class="linenr"> 800</a> */</div>
<div class="pre"><a id="l801" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l801" class="linenr"> 801</a> </div>
<div class="pre"><a id="l802" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l802" class="linenr"> 802</a>         defcode "/MOD",4,,DIVMOD</div>
<div class="pre"><a id="l803" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l803" class="linenr"> 803</a>         xor %edx,%edx</div>
<div class="pre"><a id="l804" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l804" class="linenr"> 804</a>         pop %ebx</div>
<div class="pre"><a id="l805" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l805" class="linenr"> 805</a>         pop %eax</div>
<div class="pre"><a id="l806" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l806" class="linenr"> 806</a>         idivl %ebx</div>
<div class="pre"><a id="l807" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l807" class="linenr"> 807</a>         push %edx               // push remainder</div>
<div class="pre"><a id="l808" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l808" class="linenr"> 808</a>         push %eax               // push quotient</div>
<div class="pre"><a id="l809" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l809" class="linenr"> 809</a>         NEXT</div>
<div class="pre"><a id="l810" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l810" class="linenr"> 810</a> </div>
<div class="pre"><a id="l811" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l811" class="linenr"> 811</a> /*</div>
<div class="pre"><a id="l812" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l812" class="linenr"> 812</a>         Lots of comparison operations like =, &lt;, &gt;, etc..</div>
<div class="pre"><a id="l813" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l813" class="linenr"> 813</a> </div>
<div class="pre"><a id="l814" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l814" class="linenr"> 814</a>         ANS FORTH says that the comparison words should return all (binary) 1's for</div>
<div class="pre"><a id="l815" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l815" class="linenr"> 815</a>         TRUE and all 0's for FALSE.  However this is a bit of a strange convention</div>
<div class="pre"><a id="l816" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l816" class="linenr"> 816</a>         so this FORTH breaks it and returns the more normal (for C programmers ...)</div>
<div class="pre"><a id="l817" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l817" class="linenr"> 817</a>         1 meaning TRUE and 0 meaning FALSE.</div>
<div class="pre"><a id="l818" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l818" class="linenr"> 818</a> */</div>
<div class="pre"><a id="l819" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l819" class="linenr"> 819</a> </div>
<div class="pre"><a id="l820" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l820" class="linenr"> 820</a>         defcode "=",1,,EQU      // top two words are equal?</div>
<div class="pre"><a id="l821" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l821" class="linenr"> 821</a>         pop %eax</div>
<div class="pre"><a id="l822" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l822" class="linenr"> 822</a>         pop %ebx</div>
<div class="pre"><a id="l823" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l823" class="linenr"> 823</a>         cmp %ebx,%eax</div>
<div class="pre"><a id="l824" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l824" class="linenr"> 824</a>         sete %al</div>
<div class="pre"><a id="l825" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l825" class="linenr"> 825</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l826" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l826" class="linenr"> 826</a>         pushl %eax</div>
<div class="pre"><a id="l827" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l827" class="linenr"> 827</a>         NEXT</div>
<div class="pre"><a id="l828" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l828" class="linenr"> 828</a> </div>
<div class="pre"><a id="l829" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l829" class="linenr"> 829</a>         defcode "&lt;&gt;",2,,NEQU    // top two words are not equal?</div>
<div class="pre"><a id="l830" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l830" class="linenr"> 830</a>         pop %eax</div>
<div class="pre"><a id="l831" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l831" class="linenr"> 831</a>         pop %ebx</div>
<div class="pre"><a id="l832" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l832" class="linenr"> 832</a>         cmp %ebx,%eax</div>
<div class="pre"><a id="l833" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l833" class="linenr"> 833</a>         setne %al</div>
<div class="pre"><a id="l834" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l834" class="linenr"> 834</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l835" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l835" class="linenr"> 835</a>         pushl %eax</div>
<div class="pre"><a id="l836" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l836" class="linenr"> 836</a>         NEXT</div>
<div class="pre"><a id="l837" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l837" class="linenr"> 837</a> </div>
<div class="pre"><a id="l838" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l838" class="linenr"> 838</a>         defcode "&lt;",1,,LT</div>
<div class="pre"><a id="l839" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l839" class="linenr"> 839</a>         pop %eax</div>
<div class="pre"><a id="l840" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l840" class="linenr"> 840</a>         pop %ebx</div>
<div class="pre"><a id="l841" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l841" class="linenr"> 841</a>         cmp %eax,%ebx</div>
<div class="pre"><a id="l842" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l842" class="linenr"> 842</a>         setl %al</div>
<div class="pre"><a id="l843" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l843" class="linenr"> 843</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l844" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l844" class="linenr"> 844</a>         pushl %eax</div>
<div class="pre"><a id="l845" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l845" class="linenr"> 845</a>         NEXT</div>
<div class="pre"><a id="l846" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l846" class="linenr"> 846</a> </div>
<div class="pre"><a id="l847" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l847" class="linenr"> 847</a>         defcode "&gt;",1,,GT</div>
<div class="pre"><a id="l848" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l848" class="linenr"> 848</a>         pop %eax</div>
<div class="pre"><a id="l849" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l849" class="linenr"> 849</a>         pop %ebx</div>
<div class="pre"><a id="l850" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l850" class="linenr"> 850</a>         cmp %eax,%ebx</div>
<div class="pre"><a id="l851" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l851" class="linenr"> 851</a>         setg %al</div>
<div class="pre"><a id="l852" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l852" class="linenr"> 852</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l853" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l853" class="linenr"> 853</a>         pushl %eax</div>
<div class="pre"><a id="l854" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l854" class="linenr"> 854</a>         NEXT</div>
<div class="pre"><a id="l855" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l855" class="linenr"> 855</a> </div>
<div class="pre"><a id="l856" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l856" class="linenr"> 856</a>         defcode "&lt;=",2,,LE</div>
<div class="pre"><a id="l857" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l857" class="linenr"> 857</a>         pop %eax</div>
<div class="pre"><a id="l858" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l858" class="linenr"> 858</a>         pop %ebx</div>
<div class="pre"><a id="l859" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l859" class="linenr"> 859</a>         cmp %eax,%ebx</div>
<div class="pre"><a id="l860" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l860" class="linenr"> 860</a>         setle %al</div>
<div class="pre"><a id="l861" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l861" class="linenr"> 861</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l862" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l862" class="linenr"> 862</a>         pushl %eax</div>
<div class="pre"><a id="l863" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l863" class="linenr"> 863</a>         NEXT</div>
<div class="pre"><a id="l864" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l864" class="linenr"> 864</a> </div>
<div class="pre"><a id="l865" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l865" class="linenr"> 865</a>         defcode "&gt;=",2,,GE</div>
<div class="pre"><a id="l866" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l866" class="linenr"> 866</a>         pop %eax</div>
<div class="pre"><a id="l867" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l867" class="linenr"> 867</a>         pop %ebx</div>
<div class="pre"><a id="l868" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l868" class="linenr"> 868</a>         cmp %eax,%ebx</div>
<div class="pre"><a id="l869" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l869" class="linenr"> 869</a>         setge %al</div>
<div class="pre"><a id="l870" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l870" class="linenr"> 870</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l871" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l871" class="linenr"> 871</a>         pushl %eax</div>
<div class="pre"><a id="l872" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l872" class="linenr"> 872</a>         NEXT</div>
<div class="pre"><a id="l873" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l873" class="linenr"> 873</a> </div>
<div class="pre"><a id="l874" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l874" class="linenr"> 874</a>         defcode "0=",2,,ZEQU    // top of stack equals 0?</div>
<div class="pre"><a id="l875" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l875" class="linenr"> 875</a>         pop %eax</div>
<div class="pre"><a id="l876" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l876" class="linenr"> 876</a>         test %eax,%eax</div>
<div class="pre"><a id="l877" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l877" class="linenr"> 877</a>         setz %al</div>
<div class="pre"><a id="l878" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l878" class="linenr"> 878</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l879" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l879" class="linenr"> 879</a>         pushl %eax</div>
<div class="pre"><a id="l880" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l880" class="linenr"> 880</a>         NEXT</div>
<div class="pre"><a id="l881" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l881" class="linenr"> 881</a> </div>
<div class="pre"><a id="l882" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l882" class="linenr"> 882</a>         defcode "0&lt;&gt;",3,,ZNEQU  // top of stack not 0?</div>
<div class="pre"><a id="l883" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l883" class="linenr"> 883</a>         pop %eax</div>
<div class="pre"><a id="l884" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l884" class="linenr"> 884</a>         test %eax,%eax</div>
<div class="pre"><a id="l885" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l885" class="linenr"> 885</a>         setnz %al</div>
<div class="pre"><a id="l886" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l886" class="linenr"> 886</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l887" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l887" class="linenr"> 887</a>         pushl %eax</div>
<div class="pre"><a id="l888" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l888" class="linenr"> 888</a>         NEXT</div>
<div class="pre"><a id="l889" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l889" class="linenr"> 889</a> </div>
<div class="pre"><a id="l890" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l890" class="linenr"> 890</a>         defcode "0&lt;",2,,ZLT     // comparisons with 0</div>
<div class="pre"><a id="l891" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l891" class="linenr"> 891</a>         pop %eax</div>
<div class="pre"><a id="l892" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l892" class="linenr"> 892</a>         test %eax,%eax</div>
<div class="pre"><a id="l893" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l893" class="linenr"> 893</a>         setl %al</div>
<div class="pre"><a id="l894" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l894" class="linenr"> 894</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l895" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l895" class="linenr"> 895</a>         pushl %eax</div>
<div class="pre"><a id="l896" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l896" class="linenr"> 896</a>         NEXT</div>
<div class="pre"><a id="l897" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l897" class="linenr"> 897</a> </div>
<div class="pre"><a id="l898" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l898" class="linenr"> 898</a>         defcode "0&gt;",2,,ZGT</div>
<div class="pre"><a id="l899" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l899" class="linenr"> 899</a>         pop %eax</div>
<div class="pre"><a id="l900" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l900" class="linenr"> 900</a>         test %eax,%eax</div>
<div class="pre"><a id="l901" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l901" class="linenr"> 901</a>         setg %al</div>
<div class="pre"><a id="l902" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l902" class="linenr"> 902</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l903" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l903" class="linenr"> 903</a>         pushl %eax</div>
<div class="pre"><a id="l904" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l904" class="linenr"> 904</a>         NEXT</div>
<div class="pre"><a id="l905" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l905" class="linenr"> 905</a> </div>
<div class="pre"><a id="l906" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l906" class="linenr"> 906</a>         defcode "0&lt;=",3,,ZLE</div>
<div class="pre"><a id="l907" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l907" class="linenr"> 907</a>         pop %eax</div>
<div class="pre"><a id="l908" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l908" class="linenr"> 908</a>         test %eax,%eax</div>
<div class="pre"><a id="l909" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l909" class="linenr"> 909</a>         setle %al</div>
<div class="pre"><a id="l910" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l910" class="linenr"> 910</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l911" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l911" class="linenr"> 911</a>         pushl %eax</div>
<div class="pre"><a id="l912" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l912" class="linenr"> 912</a>         NEXT</div>
<div class="pre"><a id="l913" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l913" class="linenr"> 913</a> </div>
<div class="pre"><a id="l914" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l914" class="linenr"> 914</a>         defcode "0&gt;=",3,,ZGE</div>
<div class="pre"><a id="l915" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l915" class="linenr"> 915</a>         pop %eax</div>
<div class="pre"><a id="l916" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l916" class="linenr"> 916</a>         test %eax,%eax</div>
<div class="pre"><a id="l917" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l917" class="linenr"> 917</a>         setge %al</div>
<div class="pre"><a id="l918" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l918" class="linenr"> 918</a>         movzbl %al,%eax</div>
<div class="pre"><a id="l919" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l919" class="linenr"> 919</a>         pushl %eax</div>
<div class="pre"><a id="l920" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l920" class="linenr"> 920</a>         NEXT</div>
<div class="pre"><a id="l921" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l921" class="linenr"> 921</a> </div>
<div class="pre"><a id="l922" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l922" class="linenr"> 922</a>         defcode "AND",3,,AND    // bitwise AND</div>
<div class="pre"><a id="l923" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l923" class="linenr"> 923</a>         pop %eax</div>
<div class="pre"><a id="l924" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l924" class="linenr"> 924</a>         andl %eax,(%esp)</div>
<div class="pre"><a id="l925" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l925" class="linenr"> 925</a>         NEXT</div>
<div class="pre"><a id="l926" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l926" class="linenr"> 926</a> </div>
<div class="pre"><a id="l927" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l927" class="linenr"> 927</a>         defcode "OR",2,,OR      // bitwise OR</div>
<div class="pre"><a id="l928" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l928" class="linenr"> 928</a>         pop %eax</div>
<div class="pre"><a id="l929" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l929" class="linenr"> 929</a>         orl %eax,(%esp)</div>
<div class="pre"><a id="l930" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l930" class="linenr"> 930</a>         NEXT</div>
<div class="pre"><a id="l931" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l931" class="linenr"> 931</a> </div>
<div class="pre"><a id="l932" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l932" class="linenr"> 932</a>         defcode "XOR",3,,XOR    // bitwise XOR</div>
<div class="pre"><a id="l933" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l933" class="linenr"> 933</a>         pop %eax</div>
<div class="pre"><a id="l934" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l934" class="linenr"> 934</a>         xorl %eax,(%esp)</div>
<div class="pre"><a id="l935" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l935" class="linenr"> 935</a>         NEXT</div>
<div class="pre"><a id="l936" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l936" class="linenr"> 936</a> </div>
<div class="pre"><a id="l937" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l937" class="linenr"> 937</a>         defcode "INVERT",6,,INVERT // this is the FORTH bitwise "NOT" function (cf. NEGATE and NOT)</div>
<div class="pre"><a id="l938" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l938" class="linenr"> 938</a>         notl (%esp)</div>
<div class="pre"><a id="l939" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l939" class="linenr"> 939</a>         NEXT</div>
<div class="pre"><a id="l940" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l940" class="linenr"> 940</a> </div>
<div class="pre"><a id="l941" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l941" class="linenr"> 941</a> /*</div>
<div class="pre"><a id="l942" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l942" class="linenr"> 942</a>         RETURNING FROM FORTH WORDS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l943" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l943" class="linenr"> 943</a> </div>
<div class="pre"><a id="l944" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l944" class="linenr"> 944</a>         Time to talk about what happens when we EXIT a function.  In this diagram QUADRUPLE has called</div>
<div class="pre"><a id="l945" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l945" class="linenr"> 945</a>         DOUBLE, and DOUBLE is about to exit (look at where %esi is pointing):</div>
<div class="pre"><a id="l946" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l946" class="linenr"> 946</a> </div>
<div class="pre"><a id="l947" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l947" class="linenr"> 947</a>                 QUADRUPLE</div>
<div class="pre"><a id="l948" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l948" class="linenr"> 948</a>                 +------------------+</div>
<div class="pre"><a id="l949" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l949" class="linenr"> 949</a>                 | codeword         |</div>
<div class="pre"><a id="l950" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l950" class="linenr"> 950</a>                 +------------------+               DOUBLE</div>
<div class="pre"><a id="l951" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l951" class="linenr"> 951</a>                 | addr of DOUBLE  ---------------&gt; +------------------+</div>
<div class="pre"><a id="l952" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l952" class="linenr"> 952</a>                 +------------------+               | codeword         |</div>
<div class="pre"><a id="l953" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l953" class="linenr"> 953</a>                 | addr of DOUBLE   |               +------------------+</div>
<div class="pre"><a id="l954" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l954" class="linenr"> 954</a>                 +------------------+               | addr of DUP      |</div>
<div class="pre"><a id="l955" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l955" class="linenr"> 955</a>                 | addr of EXIT     |               +------------------+</div>
<div class="pre"><a id="l956" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l956" class="linenr"> 956</a>                 +------------------+               | addr of +        |</div>
<div class="pre"><a id="l957" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l957" class="linenr"> 957</a>                                                    +------------------+</div>
<div class="pre"><a id="l958" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l958" class="linenr"> 958</a>                                            %esi -&gt; | addr of EXIT     |</div>
<div class="pre"><a id="l959" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l959" class="linenr"> 959</a>                                                    +------------------+</div>
<div class="pre"><a id="l960" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l960" class="linenr"> 960</a> </div>
<div class="pre"><a id="l961" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l961" class="linenr"> 961</a>         What happens when the + function does NEXT?  Well, the following code is executed.</div>
<div class="pre"><a id="l962" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l962" class="linenr"> 962</a> */</div>
<div class="pre"><a id="l963" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l963" class="linenr"> 963</a> </div>
<div class="pre"><a id="l964" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l964" class="linenr"> 964</a>         defcode "EXIT",4,,EXIT</div>
<div class="pre"><a id="l965" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l965" class="linenr"> 965</a>         POPRSP %esi             // pop return stack into %esi</div>
<div class="pre"><a id="l966" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l966" class="linenr"> 966</a>         NEXT</div>
<div class="pre"><a id="l967" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l967" class="linenr"> 967</a> </div>
<div class="pre"><a id="l968" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l968" class="linenr"> 968</a> /*</div>
<div class="pre"><a id="l969" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l969" class="linenr"> 969</a>         EXIT gets the old %esi which we saved from before on the return stack, and puts it in %esi.</div>
<div class="pre"><a id="l970" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l970" class="linenr"> 970</a>         So after this (but just before NEXT) we get:</div>
<div class="pre"><a id="l971" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l971" class="linenr"> 971</a> </div>
<div class="pre"><a id="l972" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l972" class="linenr"> 972</a>                 QUADRUPLE</div>
<div class="pre"><a id="l973" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l973" class="linenr"> 973</a>                 +------------------+</div>
<div class="pre"><a id="l974" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l974" class="linenr"> 974</a>                 | codeword         |</div>
<div class="pre"><a id="l975" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l975" class="linenr"> 975</a>                 +------------------+               DOUBLE</div>
<div class="pre"><a id="l976" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l976" class="linenr"> 976</a>                 | addr of DOUBLE  ---------------&gt; +------------------+</div>
<div class="pre"><a id="l977" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l977" class="linenr"> 977</a>                 +------------------+               | codeword         |</div>
<div class="pre"><a id="l978" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l978" class="linenr"> 978</a>         %esi -&gt; | addr of DOUBLE   |               +------------------+</div>
<div class="pre"><a id="l979" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l979" class="linenr"> 979</a>                 +------------------+               | addr of DUP      |</div>
<div class="pre"><a id="l980" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l980" class="linenr"> 980</a>                 | addr of EXIT     |               +------------------+</div>
<div class="pre"><a id="l981" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l981" class="linenr"> 981</a>                 +------------------+               | addr of +        |</div>
<div class="pre"><a id="l982" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l982" class="linenr"> 982</a>                                                    +------------------+</div>
<div class="pre"><a id="l983" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l983" class="linenr"> 983</a>                                                    | addr of EXIT     |</div>
<div class="pre"><a id="l984" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l984" class="linenr"> 984</a>                                                    +------------------+</div>
<div class="pre"><a id="l985" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l985" class="linenr"> 985</a> </div>
<div class="pre"><a id="l986" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l986" class="linenr"> 986</a>         And NEXT just completes the job by, well, in this case just by calling DOUBLE again :-)</div>
<div class="pre"><a id="l987" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l987" class="linenr"> 987</a> </div>
<div class="pre"><a id="l988" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l988" class="linenr"> 988</a>         LITERALS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l989" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l989" class="linenr"> 989</a> </div>
<div class="pre"><a id="l990" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l990" class="linenr"> 990</a>         The final point I "glossed over" before was how to deal with functions that do anything</div>
<div class="pre"><a id="l991" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l991" class="linenr"> 991</a>         apart from calling other functions.  For example, suppose that DOUBLE was defined like this:</div>
<div class="pre"><a id="l992" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l992" class="linenr"> 992</a> </div>
<div class="pre"><a id="l993" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l993" class="linenr"> 993</a>         : DOUBLE 2 * ;</div>
<div class="pre"><a id="l994" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l994" class="linenr"> 994</a> </div>
<div class="pre"><a id="l995" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l995" class="linenr"> 995</a>         It does the same thing, but how do we compile it since it contains the literal 2?  One way</div>
<div class="pre"><a id="l996" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l996" class="linenr"> 996</a>         would be to have a function called "2" (which you'd have to write in assembler), but you'd need</div>
<div class="pre"><a id="l997" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l997" class="linenr"> 997</a>         a function for every single literal that you wanted to use.</div>
<div class="pre"><a id="l998" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l998" class="linenr"> 998</a> </div>
<div class="pre"><a id="l999" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l999" class="linenr"> 999</a>         FORTH solves this by compiling the function using a special word called LIT:</div>
<div class="pre"><a id="l1000" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1000" class="linenr">1000</a> </div>
<div class="pre"><a id="l1001" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1001" class="linenr">1001</a>         +---------------------------+-------+-------+-------+-------+-------+</div>
<div class="pre"><a id="l1002" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1002" class="linenr">1002</a>         | (usual header of DOUBLE)  | DOCOL | LIT   | 2     | *     | EXIT  |</div>
<div class="pre"><a id="l1003" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1003" class="linenr">1003</a>         +---------------------------+-------+-------+-------+-------+-------+</div>
<div class="pre"><a id="l1004" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1004" class="linenr">1004</a> </div>
<div class="pre"><a id="l1005" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1005" class="linenr">1005</a>         LIT is executed in the normal way, but what it does next is definitely not normal.  It</div>
<div class="pre"><a id="l1006" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1006" class="linenr">1006</a>         looks at %esi (which now points to the number 2), grabs it, pushes it on the stack, then</div>
<div class="pre"><a id="l1007" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1007" class="linenr">1007</a>         manipulates %esi in order to skip the number as if it had never been there.</div>
<div class="pre"><a id="l1008" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1008" class="linenr">1008</a> </div>
<div class="pre"><a id="l1009" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1009" class="linenr">1009</a>         What's neat is that the whole grab/manipulate can be done using a single byte single</div>
<div class="pre"><a id="l1010" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1010" class="linenr">1010</a>         i386 instruction, our old friend LODSL.  Rather than me drawing more ASCII-art diagrams,</div>
<div class="pre"><a id="l1011" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1011" class="linenr">1011</a>         see if you can find out how LIT works:</div>
<div class="pre"><a id="l1012" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1012" class="linenr">1012</a> */</div>
<div class="pre"><a id="l1013" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1013" class="linenr">1013</a> </div>
<div class="pre"><a id="l1014" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1014" class="linenr">1014</a>         defcode "LIT",3,,LIT</div>
<div class="pre"><a id="l1015" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1015" class="linenr">1015</a>         // %esi points to the next command, but in this case it points to the next</div>
<div class="pre"><a id="l1016" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1016" class="linenr">1016</a>         // literal 32 bit integer.  Get that literal into %eax and increment %esi.</div>
<div class="pre"><a id="l1017" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1017" class="linenr">1017</a>         // On x86, it's a convenient single byte instruction!  (cf. NEXT macro)</div>
<div class="pre"><a id="l1018" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1018" class="linenr">1018</a>         lodsl</div>
<div class="pre"><a id="l1019" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1019" class="linenr">1019</a>         push %eax               // push the literal number on to stack</div>
<div class="pre"><a id="l1020" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1020" class="linenr">1020</a>         NEXT</div>
<div class="pre"><a id="l1021" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1021" class="linenr">1021</a> </div>
<div class="pre"><a id="l1022" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1022" class="linenr">1022</a> /*</div>
<div class="pre"><a id="l1023" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1023" class="linenr">1023</a>         MEMORY ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1024" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1024" class="linenr">1024</a> </div>
<div class="pre"><a id="l1025" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1025" class="linenr">1025</a>         As important point about FORTH is that it gives you direct access to the lowest levels</div>
<div class="pre"><a id="l1026" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1026" class="linenr">1026</a>         of the machine.  Manipulating memory directly is done frequently in FORTH, and these are</div>
<div class="pre"><a id="l1027" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1027" class="linenr">1027</a>         the primitive words for doing it.</div>
<div class="pre"><a id="l1028" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1028" class="linenr">1028</a> */</div>
<div class="pre"><a id="l1029" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1029" class="linenr">1029</a> </div>
<div class="pre"><a id="l1030" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1030" class="linenr">1030</a>         defcode "!",1,,STORE</div>
<div class="pre"><a id="l1031" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1031" class="linenr">1031</a>         pop %ebx                // address to store at</div>
<div class="pre"><a id="l1032" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1032" class="linenr">1032</a>         pop %eax                // data to store there</div>
<div class="pre"><a id="l1033" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1033" class="linenr">1033</a>         mov %eax,(%ebx)         // store it</div>
<div class="pre"><a id="l1034" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1034" class="linenr">1034</a>         NEXT</div>
<div class="pre"><a id="l1035" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1035" class="linenr">1035</a> </div>
<div class="pre"><a id="l1036" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1036" class="linenr">1036</a>         defcode "@",1,,FETCH</div>
<div class="pre"><a id="l1037" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1037" class="linenr">1037</a>         pop %ebx                // address to fetch</div>
<div class="pre"><a id="l1038" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1038" class="linenr">1038</a>         mov (%ebx),%eax         // fetch it</div>
<div class="pre"><a id="l1039" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1039" class="linenr">1039</a>         push %eax               // push value onto stack</div>
<div class="pre"><a id="l1040" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1040" class="linenr">1040</a>         NEXT</div>
<div class="pre"><a id="l1041" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1041" class="linenr">1041</a> </div>
<div class="pre"><a id="l1042" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1042" class="linenr">1042</a>         defcode "+!",2,,ADDSTORE</div>
<div class="pre"><a id="l1043" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1043" class="linenr">1043</a>         pop %ebx                // address</div>
<div class="pre"><a id="l1044" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1044" class="linenr">1044</a>         pop %eax                // the amount to add</div>
<div class="pre"><a id="l1045" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1045" class="linenr">1045</a>         addl %eax,(%ebx)        // add it</div>
<div class="pre"><a id="l1046" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1046" class="linenr">1046</a>         NEXT</div>
<div class="pre"><a id="l1047" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1047" class="linenr">1047</a> </div>
<div class="pre"><a id="l1048" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1048" class="linenr">1048</a>         defcode "-!",2,,SUBSTORE</div>
<div class="pre"><a id="l1049" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1049" class="linenr">1049</a>         pop %ebx                // address</div>
<div class="pre"><a id="l1050" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1050" class="linenr">1050</a>         pop %eax                // the amount to subtract</div>
<div class="pre"><a id="l1051" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1051" class="linenr">1051</a>         subl %eax,(%ebx)        // add it</div>
<div class="pre"><a id="l1052" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1052" class="linenr">1052</a>         NEXT</div>
<div class="pre"><a id="l1053" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1053" class="linenr">1053</a> </div>
<div class="pre"><a id="l1054" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1054" class="linenr">1054</a> /*</div>
<div class="pre"><a id="l1055" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1055" class="linenr">1055</a>         ! and @ (STORE and FETCH) store 32-bit words.  It's also useful to be able to read and write bytes</div>
<div class="pre"><a id="l1056" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1056" class="linenr">1056</a>         so we also define standard words C@ and C!.</div>
<div class="pre"><a id="l1057" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1057" class="linenr">1057</a> </div>
<div class="pre"><a id="l1058" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1058" class="linenr">1058</a>         Byte-oriented operations only work on architectures which permit them (i386 is one of those).</div>
<div class="pre"><a id="l1059" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1059" class="linenr">1059</a>  */</div>
<div class="pre"><a id="l1060" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1060" class="linenr">1060</a> </div>
<div class="pre"><a id="l1061" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1061" class="linenr">1061</a>         defcode "C!",2,,STOREBYTE</div>
<div class="pre"><a id="l1062" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1062" class="linenr">1062</a>         pop %ebx                // address to store at</div>
<div class="pre"><a id="l1063" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1063" class="linenr">1063</a>         pop %eax                // data to store there</div>
<div class="pre"><a id="l1064" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1064" class="linenr">1064</a>         movb %al,(%ebx)         // store it</div>
<div class="pre"><a id="l1065" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1065" class="linenr">1065</a>         NEXT</div>
<div class="pre"><a id="l1066" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1066" class="linenr">1066</a> </div>
<div class="pre"><a id="l1067" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1067" class="linenr">1067</a>         defcode "C@",2,,FETCHBYTE</div>
<div class="pre"><a id="l1068" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1068" class="linenr">1068</a>         pop %ebx                // address to fetch</div>
<div class="pre"><a id="l1069" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1069" class="linenr">1069</a>         xor %eax,%eax</div>
<div class="pre"><a id="l1070" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1070" class="linenr">1070</a>         movb (%ebx),%al         // fetch it</div>
<div class="pre"><a id="l1071" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1071" class="linenr">1071</a>         push %eax               // push value onto stack</div>
<div class="pre"><a id="l1072" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1072" class="linenr">1072</a>         NEXT</div>
<div class="pre"><a id="l1073" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1073" class="linenr">1073</a> </div>
<div class="pre"><a id="l1074" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1074" class="linenr">1074</a> /* C@C! is a useful byte copy primitive. */</div>
<div class="pre"><a id="l1075" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1075" class="linenr">1075</a>         defcode "C@C!",4,,CCOPY</div>
<div class="pre"><a id="l1076" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1076" class="linenr">1076</a>         movl 4(%esp),%ebx       // source address</div>
<div class="pre"><a id="l1077" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1077" class="linenr">1077</a>         movb (%ebx),%al         // get source character</div>
<div class="pre"><a id="l1078" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1078" class="linenr">1078</a>         pop %edi                // destination address</div>
<div class="pre"><a id="l1079" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1079" class="linenr">1079</a>         stosb                   // copy to destination</div>
<div class="pre"><a id="l1080" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1080" class="linenr">1080</a>         push %edi               // increment destination address</div>
<div class="pre"><a id="l1081" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1081" class="linenr">1081</a>         incl 4(%esp)            // increment source address</div>
<div class="pre"><a id="l1082" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1082" class="linenr">1082</a>         NEXT</div>
<div class="pre"><a id="l1083" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1083" class="linenr">1083</a> </div>
<div class="pre"><a id="l1084" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1084" class="linenr">1084</a> /* and CMOVE is a block copy operation. */</div>
<div class="pre"><a id="l1085" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1085" class="linenr">1085</a>         defcode "CMOVE",5,,CMOVE</div>
<div class="pre"><a id="l1086" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1086" class="linenr">1086</a>         mov %esi,%edx           // preserve %esi</div>
<div class="pre"><a id="l1087" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1087" class="linenr">1087</a>         pop %ecx                // length</div>
<div class="pre"><a id="l1088" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1088" class="linenr">1088</a>         pop %edi                // destination address</div>
<div class="pre"><a id="l1089" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1089" class="linenr">1089</a>         pop %esi                // source address</div>
<div class="pre"><a id="l1090" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1090" class="linenr">1090</a>         rep movsb               // copy source to destination</div>
<div class="pre"><a id="l1091" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1091" class="linenr">1091</a>         mov %edx,%esi           // restore %esi</div>
<div class="pre"><a id="l1092" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1092" class="linenr">1092</a>         NEXT</div>
<div class="pre"><a id="l1093" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1093" class="linenr">1093</a> </div>
<div class="pre"><a id="l1094" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1094" class="linenr">1094</a> /*</div>
<div class="pre"><a id="l1095" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1095" class="linenr">1095</a>         BUILT-IN VARIABLES ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1096" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1096" class="linenr">1096</a> </div>
<div class="pre"><a id="l1097" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1097" class="linenr">1097</a>         These are some built-in variables and related standard FORTH words.  Of these, the only one that we</div>
<div class="pre"><a id="l1098" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1098" class="linenr">1098</a>         have discussed so far was LATEST, which points to the last (most recently defined) word in the</div>
<div class="pre"><a id="l1099" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1099" class="linenr">1099</a>         FORTH dictionary.  LATEST is also a FORTH word which pushes the address of LATEST (the variable)</div>
<div class="pre"><a id="l1100" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1100" class="linenr">1100</a>         on to the stack, so you can read or write it using @ and ! operators.  For example, to print</div>
<div class="pre"><a id="l1101" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1101" class="linenr">1101</a>         the current value of LATEST (and this can apply to any FORTH variable) you would do:</div>
<div class="pre"><a id="l1102" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1102" class="linenr">1102</a> </div>
<div class="pre"><a id="l1103" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1103" class="linenr">1103</a>         LATEST @ . CR</div>
<div class="pre"><a id="l1104" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1104" class="linenr">1104</a> </div>
<div class="pre"><a id="l1105" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1105" class="linenr">1105</a>         To make defining variables shorter, I'm using a macro called defvar, similar to defword and</div>
<div class="pre"><a id="l1106" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1106" class="linenr">1106</a>         defcode above.  (In fact the defvar macro uses defcode to do the dictionary header).</div>
<div class="pre"><a id="l1107" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1107" class="linenr">1107</a> */</div>
<div class="pre"><a id="l1108" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1108" class="linenr">1108</a> </div>
<div class="pre"><a id="l1109" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1109" class="linenr">1109</a>         .macro defvar name, namelen, flags=0, label, initial=0</div>
<div class="pre"><a id="l1110" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1110" class="linenr">1110</a>         defcode \name,\namelen,\flags,\label</div>
<div class="pre"><a id="l1111" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1111" class="linenr">1111</a>         push $var_\name</div>
<div class="pre"><a id="l1112" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1112" class="linenr">1112</a>         NEXT</div>
<div class="pre"><a id="l1113" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1113" class="linenr">1113</a>         .data</div>
<div class="pre"><a id="l1114" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1114" class="linenr">1114</a>         .align 4</div>
<div class="pre"><a id="l1115" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1115" class="linenr">1115</a> var_\name :</div>
<div class="pre"><a id="l1116" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1116" class="linenr">1116</a>         .int \initial</div>
<div class="pre"><a id="l1117" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1117" class="linenr">1117</a>         .endm</div>
<div class="pre"><a id="l1118" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1118" class="linenr">1118</a> </div>
<div class="pre"><a id="l1119" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1119" class="linenr">1119</a> /*</div>
<div class="pre"><a id="l1120" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1120" class="linenr">1120</a>         The built-in variables are:</div>
<div class="pre"><a id="l1121" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1121" class="linenr">1121</a> </div>
<div class="pre"><a id="l1122" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1122" class="linenr">1122</a>         STATE           Is the interpreter executing code (0) or compiling a word (non-zero)?</div>
<div class="pre"><a id="l1123" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1123" class="linenr">1123</a>         LATEST          Points to the latest (most recently defined) word in the dictionary.</div>
<div class="pre"><a id="l1124" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1124" class="linenr">1124</a>         HERE            Points to the next free byte of memory.  When compiling, compiled words go here.</div>
<div class="pre"><a id="l1125" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1125" class="linenr">1125</a>         S0              Stores the address of the top of the parameter stack.</div>
<div class="pre"><a id="l1126" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1126" class="linenr">1126</a>         BASE            The current base for printing and reading numbers.</div>
<div class="pre"><a id="l1127" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1127" class="linenr">1127</a> </div>
<div class="pre"><a id="l1128" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1128" class="linenr">1128</a> */</div>
<div class="pre"><a id="l1129" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1129" class="linenr">1129</a>         defvar "STATE",5,,STATE</div>
<div class="pre"><a id="l1130" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1130" class="linenr">1130</a>         defvar "HERE",4,,HERE</div>
<div class="pre"><a id="l1131" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1131" class="linenr">1131</a>         defvar "LATEST",6,,LATEST,name_SYSCALL0 // SYSCALL0 must be last in built-in dictionary</div>
<div class="pre"><a id="l1132" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1132" class="linenr">1132</a>         defvar "S0",2,,SZ</div>
<div class="pre"><a id="l1133" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1133" class="linenr">1133</a>         defvar "BASE",4,,BASE,10</div>
<div class="pre"><a id="l1134" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1134" class="linenr">1134</a> </div>
<div class="pre"><a id="l1135" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1135" class="linenr">1135</a> /*</div>
<div class="pre"><a id="l1136" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1136" class="linenr">1136</a>         BUILT-IN CONSTANTS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1137" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1137" class="linenr">1137</a> </div>
<div class="pre"><a id="l1138" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1138" class="linenr">1138</a>         It's also useful to expose a few constants to FORTH.  When the word is executed it pushes a</div>
<div class="pre"><a id="l1139" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1139" class="linenr">1139</a>         constant value on the stack.</div>
<div class="pre"><a id="l1140" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1140" class="linenr">1140</a> </div>
<div class="pre"><a id="l1141" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1141" class="linenr">1141</a>         The built-in constants are:</div>
<div class="pre"><a id="l1142" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1142" class="linenr">1142</a> </div>
<div class="pre"><a id="l1143" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1143" class="linenr">1143</a>         VERSION         Is the current version of this FORTH.</div>
<div class="pre"><a id="l1144" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1144" class="linenr">1144</a>         R0              The address of the top of the return stack.</div>
<div class="pre"><a id="l1145" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1145" class="linenr">1145</a>         DOCOL           Pointer to DOCOL.</div>
<div class="pre"><a id="l1146" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1146" class="linenr">1146</a>         F_IMMED         The IMMEDIATE flag's actual value.</div>
<div class="pre"><a id="l1147" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1147" class="linenr">1147</a>         F_HIDDEN        The HIDDEN flag's actual value.</div>
<div class="pre"><a id="l1148" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1148" class="linenr">1148</a>         F_LENMASK       The length mask in the flags/len byte.</div>
<div class="pre"><a id="l1149" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1149" class="linenr">1149</a> </div>
<div class="pre"><a id="l1150" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1150" class="linenr">1150</a>         SYS_*           and the numeric codes of various Linux syscalls (from &lt;asm/unistd.h&gt;)</div>
<div class="pre"><a id="l1151" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1151" class="linenr">1151</a> */</div>
<div class="pre"><a id="l1152" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1152" class="linenr">1152</a> </div>
<div class="pre"><a id="l1153" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1153" class="linenr">1153</a> //#include &lt;asm-i386/unistd.h&gt;  // you might need this instead</div>
<div class="pre"><a id="l1154" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1154" class="linenr">1154</a> #include &lt;asm/unistd.h&gt;</div>
<div class="pre"><a id="l1155" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1155" class="linenr">1155</a> </div>
<div class="pre"><a id="l1156" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1156" class="linenr">1156</a>         .macro defconst name, namelen, flags=0, label, value</div>
<div class="pre"><a id="l1157" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1157" class="linenr">1157</a>         defcode \name,\namelen,\flags,\label</div>
<div class="pre"><a id="l1158" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1158" class="linenr">1158</a>         push $\value</div>
<div class="pre"><a id="l1159" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1159" class="linenr">1159</a>         NEXT</div>
<div class="pre"><a id="l1160" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1160" class="linenr">1160</a>         .endm</div>
<div class="pre"><a id="l1161" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1161" class="linenr">1161</a> </div>
<div class="pre"><a id="l1162" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1162" class="linenr">1162</a>         defconst "VERSION",7,,VERSION,JONES_VERSION</div>
<div class="pre"><a id="l1163" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1163" class="linenr">1163</a>         defconst "R0",2,,RZ,return_stack_top</div>
<div class="pre"><a id="l1164" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1164" class="linenr">1164</a>         defconst "DOCOL",5,,__DOCOL,DOCOL</div>
<div class="pre"><a id="l1165" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1165" class="linenr">1165</a>         defconst "F_IMMED",7,,__F_IMMED,F_IMMED</div>
<div class="pre"><a id="l1166" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1166" class="linenr">1166</a>         defconst "F_HIDDEN",8,,__F_HIDDEN,F_HIDDEN</div>
<div class="pre"><a id="l1167" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1167" class="linenr">1167</a>         defconst "F_LENMASK",9,,__F_LENMASK,F_LENMASK</div>
<div class="pre"><a id="l1168" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1168" class="linenr">1168</a> </div>
<div class="pre"><a id="l1169" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1169" class="linenr">1169</a>         defconst "SYS_EXIT",8,,SYS_EXIT,__NR_exit</div>
<div class="pre"><a id="l1170" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1170" class="linenr">1170</a>         defconst "SYS_OPEN",8,,SYS_OPEN,__NR_open</div>
<div class="pre"><a id="l1171" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1171" class="linenr">1171</a>         defconst "SYS_CLOSE",9,,SYS_CLOSE,__NR_close</div>
<div class="pre"><a id="l1172" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1172" class="linenr">1172</a>         defconst "SYS_READ",8,,SYS_READ,__NR_read</div>
<div class="pre"><a id="l1173" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1173" class="linenr">1173</a>         defconst "SYS_WRITE",9,,SYS_WRITE,__NR_write</div>
<div class="pre"><a id="l1174" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1174" class="linenr">1174</a>         defconst "SYS_CREAT",9,,SYS_CREAT,__NR_creat</div>
<div class="pre"><a id="l1175" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1175" class="linenr">1175</a>         defconst "SYS_BRK",7,,SYS_BRK,__NR_brk</div>
<div class="pre"><a id="l1176" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1176" class="linenr">1176</a> </div>
<div class="pre"><a id="l1177" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1177" class="linenr">1177</a>         defconst "O_RDONLY",8,,__O_RDONLY,0</div>
<div class="pre"><a id="l1178" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1178" class="linenr">1178</a>         defconst "O_WRONLY",8,,__O_WRONLY,1</div>
<div class="pre"><a id="l1179" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1179" class="linenr">1179</a>         defconst "O_RDWR",6,,__O_RDWR,2</div>
<div class="pre"><a id="l1180" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1180" class="linenr">1180</a>         defconst "O_CREAT",7,,__O_CREAT,0100</div>
<div class="pre"><a id="l1181" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1181" class="linenr">1181</a>         defconst "O_EXCL",6,,__O_EXCL,0200</div>
<div class="pre"><a id="l1182" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1182" class="linenr">1182</a>         defconst "O_TRUNC",7,,__O_TRUNC,01000</div>
<div class="pre"><a id="l1183" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1183" class="linenr">1183</a>         defconst "O_APPEND",8,,__O_APPEND,02000</div>
<div class="pre"><a id="l1184" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1184" class="linenr">1184</a>         defconst "O_NONBLOCK",10,,__O_NONBLOCK,04000</div>
<div class="pre"><a id="l1185" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1185" class="linenr">1185</a> </div>
<div class="pre"><a id="l1186" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1186" class="linenr">1186</a> /*</div>
<div class="pre"><a id="l1187" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1187" class="linenr">1187</a>         RETURN STACK ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1188" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1188" class="linenr">1188</a> </div>
<div class="pre"><a id="l1189" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1189" class="linenr">1189</a>         These words allow you to access the return stack.  Recall that the register %ebp always points to</div>
<div class="pre"><a id="l1190" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1190" class="linenr">1190</a>         the top of the return stack.</div>
<div class="pre"><a id="l1191" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1191" class="linenr">1191</a> */</div>
<div class="pre"><a id="l1192" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1192" class="linenr">1192</a> </div>
<div class="pre"><a id="l1193" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1193" class="linenr">1193</a>         defcode "&gt;R",2,,TOR</div>
<div class="pre"><a id="l1194" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1194" class="linenr">1194</a>         pop %eax                // pop parameter stack into %eax</div>
<div class="pre"><a id="l1195" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1195" class="linenr">1195</a>         PUSHRSP %eax            // push it on to the return stack</div>
<div class="pre"><a id="l1196" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1196" class="linenr">1196</a>         NEXT</div>
<div class="pre"><a id="l1197" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1197" class="linenr">1197</a> </div>
<div class="pre"><a id="l1198" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1198" class="linenr">1198</a>         defcode "R&gt;",2,,FROMR</div>
<div class="pre"><a id="l1199" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1199" class="linenr">1199</a>         POPRSP %eax             // pop return stack on to %eax</div>
<div class="pre"><a id="l1200" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1200" class="linenr">1200</a>         push %eax               // and push on to parameter stack</div>
<div class="pre"><a id="l1201" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1201" class="linenr">1201</a>         NEXT</div>
<div class="pre"><a id="l1202" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1202" class="linenr">1202</a> </div>
<div class="pre"><a id="l1203" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1203" class="linenr">1203</a>         defcode "RSP@",4,,RSPFETCH</div>
<div class="pre"><a id="l1204" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1204" class="linenr">1204</a>         push %ebp</div>
<div class="pre"><a id="l1205" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1205" class="linenr">1205</a>         NEXT</div>
<div class="pre"><a id="l1206" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1206" class="linenr">1206</a> </div>
<div class="pre"><a id="l1207" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1207" class="linenr">1207</a>         defcode "RSP!",4,,RSPSTORE</div>
<div class="pre"><a id="l1208" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1208" class="linenr">1208</a>         pop %ebp</div>
<div class="pre"><a id="l1209" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1209" class="linenr">1209</a>         NEXT</div>
<div class="pre"><a id="l1210" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1210" class="linenr">1210</a> </div>
<div class="pre"><a id="l1211" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1211" class="linenr">1211</a>         defcode "RDROP",5,,RDROP</div>
<div class="pre"><a id="l1212" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1212" class="linenr">1212</a>         addl $4,%ebp            // pop return stack and throw away</div>
<div class="pre"><a id="l1213" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1213" class="linenr">1213</a>         NEXT</div>
<div class="pre"><a id="l1214" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1214" class="linenr">1214</a> </div>
<div class="pre"><a id="l1215" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1215" class="linenr">1215</a> /*</div>
<div class="pre"><a id="l1216" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1216" class="linenr">1216</a>         PARAMETER (DATA) STACK ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1217" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1217" class="linenr">1217</a> </div>
<div class="pre"><a id="l1218" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1218" class="linenr">1218</a>         These functions allow you to manipulate the parameter stack.  Recall that Linux sets up the parameter</div>
<div class="pre"><a id="l1219" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1219" class="linenr">1219</a>         stack for us, and it is accessed through %esp.</div>
<div class="pre"><a id="l1220" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1220" class="linenr">1220</a> */</div>
<div class="pre"><a id="l1221" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1221" class="linenr">1221</a> </div>
<div class="pre"><a id="l1222" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1222" class="linenr">1222</a>         defcode "DSP@",4,,DSPFETCH</div>
<div class="pre"><a id="l1223" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1223" class="linenr">1223</a>         mov %esp,%eax</div>
<div class="pre"><a id="l1224" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1224" class="linenr">1224</a>         push %eax</div>
<div class="pre"><a id="l1225" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1225" class="linenr">1225</a>         NEXT</div>
<div class="pre"><a id="l1226" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1226" class="linenr">1226</a> </div>
<div class="pre"><a id="l1227" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1227" class="linenr">1227</a>         defcode "DSP!",4,,DSPSTORE</div>
<div class="pre"><a id="l1228" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1228" class="linenr">1228</a>         pop %esp</div>
<div class="pre"><a id="l1229" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1229" class="linenr">1229</a>         NEXT</div>
<div class="pre"><a id="l1230" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1230" class="linenr">1230</a> </div>
<div class="pre"><a id="l1231" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1231" class="linenr">1231</a> /*</div>
<div class="pre"><a id="l1232" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1232" class="linenr">1232</a>         INPUT AND OUTPUT ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1233" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1233" class="linenr">1233</a> </div>
<div class="pre"><a id="l1234" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1234" class="linenr">1234</a>         These are our first really meaty/complicated FORTH primitives.  I have chosen to write them in</div>
<div class="pre"><a id="l1235" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1235" class="linenr">1235</a>         assembler, but surprisingly in "real" FORTH implementations these are often written in terms</div>
<div class="pre"><a id="l1236" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1236" class="linenr">1236</a>         of more fundamental FORTH primitives.  I chose to avoid that because I think that just obscures</div>
<div class="pre"><a id="l1237" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1237" class="linenr">1237</a>         the implementation.  After all, you may not understand assembler but you can just think of it</div>
<div class="pre"><a id="l1238" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1238" class="linenr">1238</a>         as an opaque block of code that does what it says.</div>
<div class="pre"><a id="l1239" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1239" class="linenr">1239</a> </div>
<div class="pre"><a id="l1240" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1240" class="linenr">1240</a>         Let's discuss input first.</div>
<div class="pre"><a id="l1241" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1241" class="linenr">1241</a> </div>
<div class="pre"><a id="l1242" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1242" class="linenr">1242</a>         The FORTH word KEY reads the next byte from stdin (and pushes it on the parameter stack).</div>
<div class="pre"><a id="l1243" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1243" class="linenr">1243</a>         So if KEY is called and someone hits the space key, then the number 32 (ASCII code of space)</div>
<div class="pre"><a id="l1244" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1244" class="linenr">1244</a>         is pushed on the stack.</div>
<div class="pre"><a id="l1245" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1245" class="linenr">1245</a> </div>
<div class="pre"><a id="l1246" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1246" class="linenr">1246</a>         In FORTH there is no distinction between reading code and reading input.  We might be reading</div>
<div class="pre"><a id="l1247" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1247" class="linenr">1247</a>         and compiling code, we might be reading words to execute, we might be asking for the user</div>
<div class="pre"><a id="l1248" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1248" class="linenr">1248</a>         to type their name -- ultimately it all comes in through KEY.</div>
<div class="pre"><a id="l1249" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1249" class="linenr">1249</a> </div>
<div class="pre"><a id="l1250" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1250" class="linenr">1250</a>         The implementation of KEY uses an input buffer of a certain size (defined at the end of this</div>
<div class="pre"><a id="l1251" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1251" class="linenr">1251</a>         file).  It calls the Linux read(2) system call to fill this buffer and tracks its position</div>
<div class="pre"><a id="l1252" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1252" class="linenr">1252</a>         in the buffer using a couple of variables, and if it runs out of input buffer then it refills</div>
<div class="pre"><a id="l1253" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1253" class="linenr">1253</a>         it automatically.  The other thing that KEY does is if it detects that stdin has closed, it</div>
<div class="pre"><a id="l1254" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1254" class="linenr">1254</a>         exits the program, which is why when you hit ^D the FORTH system cleanly exits.</div>
<div class="pre"><a id="l1255" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1255" class="linenr">1255</a> </div>
<div class="pre"><a id="l1256" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1256" class="linenr">1256</a>      buffer                           bufftop</div>
<div class="pre"><a id="l1257" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1257" class="linenr">1257</a>         |                                |</div>
<div class="pre"><a id="l1258" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1258" class="linenr">1258</a>         V                                V</div>
<div class="pre"><a id="l1259" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1259" class="linenr">1259</a>         +-------------------------------+--------------------------------------+</div>
<div class="pre"><a id="l1260" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1260" class="linenr">1260</a>         | INPUT READ FROM STDIN ....... | unused part of the buffer            |</div>
<div class="pre"><a id="l1261" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1261" class="linenr">1261</a>         +-------------------------------+--------------------------------------+</div>
<div class="pre"><a id="l1262" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1262" class="linenr">1262</a>                           ^</div>
<div class="pre"><a id="l1263" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1263" class="linenr">1263</a>                           |</div>
<div class="pre"><a id="l1264" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1264" class="linenr">1264</a>                        currkey (next character to read)</div>
<div class="pre"><a id="l1265" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1265" class="linenr">1265</a> </div>
<div class="pre"><a id="l1266" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1266" class="linenr">1266</a>         &lt;---------------------- BUFFER_SIZE (4096 bytes) ----------------------&gt;</div>
<div class="pre"><a id="l1267" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1267" class="linenr">1267</a> */</div>
<div class="pre"><a id="l1268" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1268" class="linenr">1268</a> </div>
<div class="pre"><a id="l1269" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1269" class="linenr">1269</a>         defcode "KEY",3,,KEY</div>
<div class="pre"><a id="l1270" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1270" class="linenr">1270</a>         call _KEY</div>
<div class="pre"><a id="l1271" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1271" class="linenr">1271</a>         push %eax               // push return value on stack</div>
<div class="pre"><a id="l1272" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1272" class="linenr">1272</a>         NEXT</div>
<div class="pre"><a id="l1273" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1273" class="linenr">1273</a> _KEY:</div>
<div class="pre"><a id="l1274" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1274" class="linenr">1274</a>         mov (currkey),%ebx</div>
<div class="pre"><a id="l1275" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1275" class="linenr">1275</a>         cmp (bufftop),%ebx</div>
<div class="pre"><a id="l1276" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1276" class="linenr">1276</a>         jge 1f                  // exhausted the input buffer?</div>
<div class="pre"><a id="l1277" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1277" class="linenr">1277</a>         xor %eax,%eax</div>
<div class="pre"><a id="l1278" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1278" class="linenr">1278</a>         mov (%ebx),%al          // get next key from input buffer</div>
<div class="pre"><a id="l1279" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1279" class="linenr">1279</a>         inc %ebx</div>
<div class="pre"><a id="l1280" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1280" class="linenr">1280</a>         mov %ebx,(currkey)      // increment currkey</div>
<div class="pre"><a id="l1281" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1281" class="linenr">1281</a>         ret</div>
<div class="pre"><a id="l1282" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1282" class="linenr">1282</a> </div>
<div class="pre"><a id="l1283" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1283" class="linenr">1283</a> 1:      // Out of input; use read(2) to fetch more input from stdin.</div>
<div class="pre"><a id="l1284" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1284" class="linenr">1284</a>         xor %ebx,%ebx           // 1st param: stdin</div>
<div class="pre"><a id="l1285" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1285" class="linenr">1285</a>         mov $buffer,%ecx        // 2nd param: buffer</div>
<div class="pre"><a id="l1286" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1286" class="linenr">1286</a>         mov %ecx,currkey</div>
<div class="pre"><a id="l1287" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1287" class="linenr">1287</a>         mov $BUFFER_SIZE,%edx   // 3rd param: max length</div>
<div class="pre"><a id="l1288" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1288" class="linenr">1288</a>         mov $__NR_read,%eax     // syscall: read</div>
<div class="pre"><a id="l1289" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1289" class="linenr">1289</a>         int $0x80</div>
<div class="pre"><a id="l1290" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1290" class="linenr">1290</a>         test %eax,%eax          // If %eax &lt;= 0, then exit.</div>
<div class="pre"><a id="l1291" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1291" class="linenr">1291</a>         jbe 2f</div>
<div class="pre"><a id="l1292" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1292" class="linenr">1292</a>         addl %eax,%ecx          // buffer+%eax = bufftop</div>
<div class="pre"><a id="l1293" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1293" class="linenr">1293</a>         mov %ecx,bufftop</div>
<div class="pre"><a id="l1294" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1294" class="linenr">1294</a>         jmp _KEY</div>
<div class="pre"><a id="l1295" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1295" class="linenr">1295</a> </div>
<div class="pre"><a id="l1296" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1296" class="linenr">1296</a> 2:      // Error or end of input: exit the program.</div>
<div class="pre"><a id="l1297" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1297" class="linenr">1297</a>         xor %ebx,%ebx</div>
<div class="pre"><a id="l1298" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1298" class="linenr">1298</a>         mov $__NR_exit,%eax     // syscall: exit</div>
<div class="pre"><a id="l1299" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1299" class="linenr">1299</a>         int $0x80</div>
<div class="pre"><a id="l1300" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1300" class="linenr">1300</a> </div>
<div class="pre"><a id="l1301" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1301" class="linenr">1301</a>         .data</div>
<div class="pre"><a id="l1302" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1302" class="linenr">1302</a>         .align 4</div>
<div class="pre"><a id="l1303" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1303" class="linenr">1303</a> currkey:</div>
<div class="pre"><a id="l1304" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1304" class="linenr">1304</a>         .int buffer             // Current place in input buffer (next character to read).</div>
<div class="pre"><a id="l1305" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1305" class="linenr">1305</a> bufftop:</div>
<div class="pre"><a id="l1306" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1306" class="linenr">1306</a>         .int buffer             // Last valid data in input buffer + 1.</div>
<div class="pre"><a id="l1307" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1307" class="linenr">1307</a> </div>
<div class="pre"><a id="l1308" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1308" class="linenr">1308</a> /*</div>
<div class="pre"><a id="l1309" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1309" class="linenr">1309</a>         By contrast, output is much simpler.  The FORTH word EMIT writes out a single byte to stdout.</div>
<div class="pre"><a id="l1310" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1310" class="linenr">1310</a>         This implementation just uses the write system call.  No attempt is made to buffer output, but</div>
<div class="pre"><a id="l1311" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1311" class="linenr">1311</a>         it would be a good exercise to add it.</div>
<div class="pre"><a id="l1312" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1312" class="linenr">1312</a> */</div>
<div class="pre"><a id="l1313" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1313" class="linenr">1313</a> </div>
<div class="pre"><a id="l1314" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1314" class="linenr">1314</a>         defcode "EMIT",4,,EMIT</div>
<div class="pre"><a id="l1315" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1315" class="linenr">1315</a>         pop %eax</div>
<div class="pre"><a id="l1316" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1316" class="linenr">1316</a>         call _EMIT</div>
<div class="pre"><a id="l1317" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1317" class="linenr">1317</a>         NEXT</div>
<div class="pre"><a id="l1318" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1318" class="linenr">1318</a> _EMIT:</div>
<div class="pre"><a id="l1319" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1319" class="linenr">1319</a>         mov $1,%ebx             // 1st param: stdout</div>
<div class="pre"><a id="l1320" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1320" class="linenr">1320</a> </div>
<div class="pre"><a id="l1321" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1321" class="linenr">1321</a>         // write needs the address of the byte to write</div>
<div class="pre"><a id="l1322" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1322" class="linenr">1322</a>         mov %al,emit_scratch</div>
<div class="pre"><a id="l1323" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1323" class="linenr">1323</a>         mov $emit_scratch,%ecx  // 2nd param: address</div>
<div class="pre"><a id="l1324" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1324" class="linenr">1324</a> </div>
<div class="pre"><a id="l1325" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1325" class="linenr">1325</a>         mov $1,%edx             // 3rd param: nbytes = 1</div>
<div class="pre"><a id="l1326" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1326" class="linenr">1326</a> </div>
<div class="pre"><a id="l1327" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1327" class="linenr">1327</a>         mov $__NR_write,%eax    // write syscall</div>
<div class="pre"><a id="l1328" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1328" class="linenr">1328</a>         int $0x80</div>
<div class="pre"><a id="l1329" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1329" class="linenr">1329</a>         ret</div>
<div class="pre"><a id="l1330" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1330" class="linenr">1330</a> </div>
<div class="pre"><a id="l1331" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1331" class="linenr">1331</a>         .data                   // NB: easier to fit in the .data section</div>
<div class="pre"><a id="l1332" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1332" class="linenr">1332</a> emit_scratch:</div>
<div class="pre"><a id="l1333" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1333" class="linenr">1333</a>         .space 1                // scratch used by EMIT</div>
<div class="pre"><a id="l1334" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1334" class="linenr">1334</a> </div>
<div class="pre"><a id="l1335" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1335" class="linenr">1335</a> /*</div>
<div class="pre"><a id="l1336" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1336" class="linenr">1336</a>         Back to input, WORD is a FORTH word which reads the next full word of input.</div>
<div class="pre"><a id="l1337" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1337" class="linenr">1337</a> </div>
<div class="pre"><a id="l1338" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1338" class="linenr">1338</a>         What it does in detail is that it first skips any blanks (spaces, tabs, newlines and so on).</div>
<div class="pre"><a id="l1339" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1339" class="linenr">1339</a>         Then it calls KEY to read characters into an internal buffer until it hits a blank.  Then it</div>
<div class="pre"><a id="l1340" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1340" class="linenr">1340</a>         calculates the length of the word it read and returns the address and the length as</div>
<div class="pre"><a id="l1341" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1341" class="linenr">1341</a>         two words on the stack (with the length at the top of stack).</div>
<div class="pre"><a id="l1342" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1342" class="linenr">1342</a> </div>
<div class="pre"><a id="l1343" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1343" class="linenr">1343</a>         Notice that WORD has a single internal buffer which it overwrites each time (rather like</div>
<div class="pre"><a id="l1344" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1344" class="linenr">1344</a>         a static C string).  Also notice that WORD's internal buffer is just 32 bytes long and</div>
<div class="pre"><a id="l1345" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1345" class="linenr">1345</a>         there is NO checking for overflow.  31 bytes happens to be the maximum length of a</div>
<div class="pre"><a id="l1346" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1346" class="linenr">1346</a>         FORTH word that we support, and that is what WORD is used for: to read FORTH words when</div>
<div class="pre"><a id="l1347" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1347" class="linenr">1347</a>         we are compiling and executing code.  The returned strings are not NUL-terminated.</div>
<div class="pre"><a id="l1348" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1348" class="linenr">1348</a> </div>
<div class="pre"><a id="l1349" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1349" class="linenr">1349</a>         Start address+length is the normal way to represent strings in FORTH (not ending in an</div>
<div class="pre"><a id="l1350" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1350" class="linenr">1350</a>         ASCII NUL character as in C), and so FORTH strings can contain any character including NULs</div>
<div class="pre"><a id="l1351" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1351" class="linenr">1351</a>         and can be any length.</div>
<div class="pre"><a id="l1352" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1352" class="linenr">1352</a> </div>
<div class="pre"><a id="l1353" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1353" class="linenr">1353</a>         WORD is not suitable for just reading strings (eg. user input) because of all the above</div>
<div class="pre"><a id="l1354" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1354" class="linenr">1354</a>         peculiarities and limitations.</div>
<div class="pre"><a id="l1355" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1355" class="linenr">1355</a> </div>
<div class="pre"><a id="l1356" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1356" class="linenr">1356</a>         Note that when executing, you'll see:</div>
<div class="pre"><a id="l1357" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1357" class="linenr">1357</a>         WORD FOO</div>
<div class="pre"><a id="l1358" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1358" class="linenr">1358</a>         which puts "FOO" and length 3 on the stack, but when compiling:</div>
<div class="pre"><a id="l1359" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1359" class="linenr">1359</a>         : BAR WORD FOO ;</div>
<div class="pre"><a id="l1360" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1360" class="linenr">1360</a>         is an error (or at least it doesn't do what you might expect).  Later we'll talk about compiling</div>
<div class="pre"><a id="l1361" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1361" class="linenr">1361</a>         and immediate mode, and you'll understand why.</div>
<div class="pre"><a id="l1362" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1362" class="linenr">1362</a> */</div>
<div class="pre"><a id="l1363" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1363" class="linenr">1363</a> </div>
<div class="pre"><a id="l1364" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1364" class="linenr">1364</a>         defcode "WORD",4,,WORD</div>
<div class="pre"><a id="l1365" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1365" class="linenr">1365</a>         call _WORD</div>
<div class="pre"><a id="l1366" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1366" class="linenr">1366</a>         push %edi               // push base address</div>
<div class="pre"><a id="l1367" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1367" class="linenr">1367</a>         push %ecx               // push length</div>
<div class="pre"><a id="l1368" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1368" class="linenr">1368</a>         NEXT</div>
<div class="pre"><a id="l1369" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1369" class="linenr">1369</a> </div>
<div class="pre"><a id="l1370" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1370" class="linenr">1370</a> _WORD:</div>
<div class="pre"><a id="l1371" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1371" class="linenr">1371</a>         /* Search for first non-blank character.  Also skip \ comments. */</div>
<div class="pre"><a id="l1372" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1372" class="linenr">1372</a> 1:</div>
<div class="pre"><a id="l1373" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1373" class="linenr">1373</a>         call _KEY               // get next key, returned in %eax</div>
<div class="pre"><a id="l1374" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1374" class="linenr">1374</a>         cmpb $'\\',%al          // start of a comment?</div>
<div class="pre"><a id="l1375" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1375" class="linenr">1375</a>         je 3f                   // if so, skip the comment</div>
<div class="pre"><a id="l1376" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1376" class="linenr">1376</a>         cmpb $' ',%al</div>
<div class="pre"><a id="l1377" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1377" class="linenr">1377</a>         jbe 1b                  // if so, keep looking</div>
<div class="pre"><a id="l1378" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1378" class="linenr">1378</a> </div>
<div class="pre"><a id="l1379" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1379" class="linenr">1379</a>         /* Search for the end of the word, storing chars as we go. */</div>
<div class="pre"><a id="l1380" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1380" class="linenr">1380</a>         mov $word_buffer,%edi   // pointer to return buffer</div>
<div class="pre"><a id="l1381" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1381" class="linenr">1381</a> 2:</div>
<div class="pre"><a id="l1382" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1382" class="linenr">1382</a>         stosb                   // add character to return buffer</div>
<div class="pre"><a id="l1383" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1383" class="linenr">1383</a>         call _KEY               // get next key, returned in %al</div>
<div class="pre"><a id="l1384" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1384" class="linenr">1384</a>         cmpb $' ',%al           // is blank?</div>
<div class="pre"><a id="l1385" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1385" class="linenr">1385</a>         ja 2b                   // if not, keep looping</div>
<div class="pre"><a id="l1386" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1386" class="linenr">1386</a> </div>
<div class="pre"><a id="l1387" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1387" class="linenr">1387</a>         /* Return the word (well, the static buffer) and length. */</div>
<div class="pre"><a id="l1388" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1388" class="linenr">1388</a>         sub $word_buffer,%edi</div>
<div class="pre"><a id="l1389" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1389" class="linenr">1389</a>         mov %edi,%ecx           // return length of the word</div>
<div class="pre"><a id="l1390" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1390" class="linenr">1390</a>         mov $word_buffer,%edi   // return address of the word</div>
<div class="pre"><a id="l1391" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1391" class="linenr">1391</a>         ret</div>
<div class="pre"><a id="l1392" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1392" class="linenr">1392</a> </div>
<div class="pre"><a id="l1393" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1393" class="linenr">1393</a>         /* Code to skip \ comments to end of the current line. */</div>
<div class="pre"><a id="l1394" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1394" class="linenr">1394</a> 3:</div>
<div class="pre"><a id="l1395" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1395" class="linenr">1395</a>         call _KEY</div>
<div class="pre"><a id="l1396" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1396" class="linenr">1396</a>         cmpb $'\n',%al          // end of line yet?</div>
<div class="pre"><a id="l1397" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1397" class="linenr">1397</a>         jne 3b</div>
<div class="pre"><a id="l1398" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1398" class="linenr">1398</a>         jmp 1b</div>
<div class="pre"><a id="l1399" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1399" class="linenr">1399</a> </div>
<div class="pre"><a id="l1400" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1400" class="linenr">1400</a>         .data                   // NB: easier to fit in the .data section</div>
<div class="pre"><a id="l1401" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1401" class="linenr">1401</a>         // A static buffer where WORD returns.  Subsequent calls</div>
<div class="pre"><a id="l1402" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1402" class="linenr">1402</a>         // overwrite this buffer.  Maximum word length is 32 chars.</div>
<div class="pre"><a id="l1403" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1403" class="linenr">1403</a> word_buffer:</div>
<div class="pre"><a id="l1404" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1404" class="linenr">1404</a>         .space 32</div>
<div class="pre"><a id="l1405" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1405" class="linenr">1405</a> </div>
<div class="pre"><a id="l1406" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1406" class="linenr">1406</a> /*</div>
<div class="pre"><a id="l1407" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1407" class="linenr">1407</a>         As well as reading in words we'll need to read in numbers and for that we are using a function</div>
<div class="pre"><a id="l1408" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1408" class="linenr">1408</a>         called NUMBER.  This parses a numeric string such as one returned by WORD and pushes the</div>
<div class="pre"><a id="l1409" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1409" class="linenr">1409</a>         number on the parameter stack.</div>
<div class="pre"><a id="l1410" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1410" class="linenr">1410</a> </div>
<div class="pre"><a id="l1411" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1411" class="linenr">1411</a>         The function uses the variable BASE as the base (radix) for conversion, so for example if</div>
<div class="pre"><a id="l1412" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1412" class="linenr">1412</a>         BASE is 2 then we expect a binary number.  Normally BASE is 10.</div>
<div class="pre"><a id="l1413" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1413" class="linenr">1413</a> </div>
<div class="pre"><a id="l1414" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1414" class="linenr">1414</a>         If the word starts with a '-' character then the returned value is negative.</div>
<div class="pre"><a id="l1415" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1415" class="linenr">1415</a> </div>
<div class="pre"><a id="l1416" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1416" class="linenr">1416</a>         If the string can't be parsed as a number (or contains characters outside the current BASE)</div>
<div class="pre"><a id="l1417" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1417" class="linenr">1417</a>         then we need to return an error indication.  So NUMBER actually returns two items on the stack.</div>
<div class="pre"><a id="l1418" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1418" class="linenr">1418</a>         At the top of stack we return the number of unconverted characters (ie. if 0 then all characters</div>
<div class="pre"><a id="l1419" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1419" class="linenr">1419</a>         were converted, so there is no error).  Second from top of stack is the parsed number or a</div>
<div class="pre"><a id="l1420" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1420" class="linenr">1420</a>         partial value if there was an error.</div>
<div class="pre"><a id="l1421" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1421" class="linenr">1421</a> */</div>
<div class="pre"><a id="l1422" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1422" class="linenr">1422</a>         defcode "NUMBER",6,,NUMBER</div>
<div class="pre"><a id="l1423" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1423" class="linenr">1423</a>         pop %ecx                // length of string</div>
<div class="pre"><a id="l1424" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1424" class="linenr">1424</a>         pop %edi                // start address of string</div>
<div class="pre"><a id="l1425" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1425" class="linenr">1425</a>         call _NUMBER</div>
<div class="pre"><a id="l1426" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1426" class="linenr">1426</a>         push %eax               // parsed number</div>
<div class="pre"><a id="l1427" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1427" class="linenr">1427</a>         push %ecx               // number of unparsed characters (0 = no error)</div>
<div class="pre"><a id="l1428" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1428" class="linenr">1428</a>         NEXT</div>
<div class="pre"><a id="l1429" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1429" class="linenr">1429</a> </div>
<div class="pre"><a id="l1430" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1430" class="linenr">1430</a> _NUMBER:</div>
<div class="pre"><a id="l1431" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1431" class="linenr">1431</a>         xor %eax,%eax</div>
<div class="pre"><a id="l1432" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1432" class="linenr">1432</a>         xor %ebx,%ebx</div>
<div class="pre"><a id="l1433" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1433" class="linenr">1433</a> </div>
<div class="pre"><a id="l1434" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1434" class="linenr">1434</a>         test %ecx,%ecx          // trying to parse a zero-length string is an error, but will return 0.</div>
<div class="pre"><a id="l1435" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1435" class="linenr">1435</a>         jz 5f</div>
<div class="pre"><a id="l1436" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1436" class="linenr">1436</a> </div>
<div class="pre"><a id="l1437" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1437" class="linenr">1437</a>         movl var_BASE,%edx      // get BASE (in %dl)</div>
<div class="pre"><a id="l1438" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1438" class="linenr">1438</a> </div>
<div class="pre"><a id="l1439" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1439" class="linenr">1439</a>         // Check if first character is '-'.</div>
<div class="pre"><a id="l1440" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1440" class="linenr">1440</a>         movb (%edi),%bl         // %bl = first character in string</div>
<div class="pre"><a id="l1441" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1441" class="linenr">1441</a>         inc %edi</div>
<div class="pre"><a id="l1442" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1442" class="linenr">1442</a>         push %eax               // push 0 on stack</div>
<div class="pre"><a id="l1443" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1443" class="linenr">1443</a>         cmpb $'-',%bl           // negative number?</div>
<div class="pre"><a id="l1444" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1444" class="linenr">1444</a>         jnz 2f</div>
<div class="pre"><a id="l1445" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1445" class="linenr">1445</a>         pop %eax</div>
<div class="pre"><a id="l1446" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1446" class="linenr">1446</a>         push %ebx               // push &lt;&gt; 0 on stack, indicating negative</div>
<div class="pre"><a id="l1447" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1447" class="linenr">1447</a>         dec %ecx</div>
<div class="pre"><a id="l1448" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1448" class="linenr">1448</a>         jnz 1f</div>
<div class="pre"><a id="l1449" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1449" class="linenr">1449</a>         pop %ebx                // error: string is only '-'.</div>
<div class="pre"><a id="l1450" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1450" class="linenr">1450</a>         movl $1,%ecx</div>
<div class="pre"><a id="l1451" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1451" class="linenr">1451</a>         ret</div>
<div class="pre"><a id="l1452" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1452" class="linenr">1452</a> </div>
<div class="pre"><a id="l1453" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1453" class="linenr">1453</a>         // Loop reading digits.</div>
<div class="pre"><a id="l1454" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1454" class="linenr">1454</a> 1:      imull %edx,%eax         // %eax *= BASE</div>
<div class="pre"><a id="l1455" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1455" class="linenr">1455</a>         movb (%edi),%bl         // %bl = next character in string</div>
<div class="pre"><a id="l1456" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1456" class="linenr">1456</a>         inc %edi</div>
<div class="pre"><a id="l1457" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1457" class="linenr">1457</a> </div>
<div class="pre"><a id="l1458" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1458" class="linenr">1458</a>         // Convert 0-9, A-Z to a number 0-35.</div>
<div class="pre"><a id="l1459" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1459" class="linenr">1459</a> 2:      subb $'0',%bl           // &lt; '0'?</div>
<div class="pre"><a id="l1460" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1460" class="linenr">1460</a>         jb 4f</div>
<div class="pre"><a id="l1461" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1461" class="linenr">1461</a>         cmp $10,%bl             // &lt;= '9'?</div>
<div class="pre"><a id="l1462" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1462" class="linenr">1462</a>         jb 3f</div>
<div class="pre"><a id="l1463" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1463" class="linenr">1463</a>         subb $17,%bl            // &lt; 'A'? (17 is 'A'-'0')</div>
<div class="pre"><a id="l1464" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1464" class="linenr">1464</a>         jb 4f</div>
<div class="pre"><a id="l1465" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1465" class="linenr">1465</a>         addb $10,%bl</div>
<div class="pre"><a id="l1466" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1466" class="linenr">1466</a> </div>
<div class="pre"><a id="l1467" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1467" class="linenr">1467</a> 3:      cmp %dl,%bl             // &gt;= BASE?</div>
<div class="pre"><a id="l1468" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1468" class="linenr">1468</a>         jge 4f</div>
<div class="pre"><a id="l1469" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1469" class="linenr">1469</a> </div>
<div class="pre"><a id="l1470" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1470" class="linenr">1470</a>         // OK, so add it to %eax and loop.</div>
<div class="pre"><a id="l1471" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1471" class="linenr">1471</a>         add %ebx,%eax</div>
<div class="pre"><a id="l1472" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1472" class="linenr">1472</a>         dec %ecx</div>
<div class="pre"><a id="l1473" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1473" class="linenr">1473</a>         jnz 1b</div>
<div class="pre"><a id="l1474" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1474" class="linenr">1474</a> </div>
<div class="pre"><a id="l1475" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1475" class="linenr">1475</a>         // Negate the result if first character was '-' (saved on the stack).</div>
<div class="pre"><a id="l1476" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1476" class="linenr">1476</a> 4:      pop %ebx</div>
<div class="pre"><a id="l1477" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1477" class="linenr">1477</a>         test %ebx,%ebx</div>
<div class="pre"><a id="l1478" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1478" class="linenr">1478</a>         jz 5f</div>
<div class="pre"><a id="l1479" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1479" class="linenr">1479</a>         neg %eax</div>
<div class="pre"><a id="l1480" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1480" class="linenr">1480</a> </div>
<div class="pre"><a id="l1481" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1481" class="linenr">1481</a> 5:      ret</div>
<div class="pre"><a id="l1482" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1482" class="linenr">1482</a> </div>
<div class="pre"><a id="l1483" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1483" class="linenr">1483</a> /*</div>
<div class="pre"><a id="l1484" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1484" class="linenr">1484</a>         DICTIONARY LOOK UPS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1485" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1485" class="linenr">1485</a> </div>
<div class="pre"><a id="l1486" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1486" class="linenr">1486</a>         We're building up to our prelude on how FORTH code is compiled, but first we need yet more infrastructure.</div>
<div class="pre"><a id="l1487" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1487" class="linenr">1487</a> </div>
<div class="pre"><a id="l1488" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1488" class="linenr">1488</a>         The FORTH word FIND takes a string (a word as parsed by WORD -- see above) and looks it up in the</div>
<div class="pre"><a id="l1489" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1489" class="linenr">1489</a>         dictionary.  What it actually returns is the address of the dictionary header, if it finds it,</div>
<div class="pre"><a id="l1490" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1490" class="linenr">1490</a>         or 0 if it didn't.</div>
<div class="pre"><a id="l1491" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1491" class="linenr">1491</a> </div>
<div class="pre"><a id="l1492" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1492" class="linenr">1492</a>         So if DOUBLE is defined in the dictionary, then WORD DOUBLE FIND returns the following pointer:</div>
<div class="pre"><a id="l1493" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1493" class="linenr">1493</a> </div>
<div class="pre"><a id="l1494" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1494" class="linenr">1494</a>     pointer to this</div>
<div class="pre"><a id="l1495" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1495" class="linenr">1495</a>         |</div>
<div class="pre"><a id="l1496" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1496" class="linenr">1496</a>         |</div>
<div class="pre"><a id="l1497" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1497" class="linenr">1497</a>         V</div>
<div class="pre"><a id="l1498" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1498" class="linenr">1498</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1499" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1499" class="linenr">1499</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          | EXIT       |</div>
<div class="pre"><a id="l1500" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1500" class="linenr">1500</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1501" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1501" class="linenr">1501</a> </div>
<div class="pre"><a id="l1502" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1502" class="linenr">1502</a>         See also &gt;CFA and &gt;DFA.</div>
<div class="pre"><a id="l1503" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1503" class="linenr">1503</a> </div>
<div class="pre"><a id="l1504" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1504" class="linenr">1504</a>         FIND doesn't find dictionary entries which are flagged as HIDDEN.  See below for why.</div>
<div class="pre"><a id="l1505" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1505" class="linenr">1505</a> */</div>
<div class="pre"><a id="l1506" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1506" class="linenr">1506</a> </div>
<div class="pre"><a id="l1507" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1507" class="linenr">1507</a>         defcode "FIND",4,,FIND</div>
<div class="pre"><a id="l1508" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1508" class="linenr">1508</a>         pop %ecx                // %ecx = length</div>
<div class="pre"><a id="l1509" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1509" class="linenr">1509</a>         pop %edi                // %edi = address</div>
<div class="pre"><a id="l1510" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1510" class="linenr">1510</a>         call _FIND</div>
<div class="pre"><a id="l1511" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1511" class="linenr">1511</a>         push %eax               // %eax = address of dictionary entry (or NULL)</div>
<div class="pre"><a id="l1512" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1512" class="linenr">1512</a>         NEXT</div>
<div class="pre"><a id="l1513" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1513" class="linenr">1513</a> </div>
<div class="pre"><a id="l1514" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1514" class="linenr">1514</a> _FIND:</div>
<div class="pre"><a id="l1515" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1515" class="linenr">1515</a>         push %esi               // Save %esi so we can use it in string comparison.</div>
<div class="pre"><a id="l1516" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1516" class="linenr">1516</a> </div>
<div class="pre"><a id="l1517" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1517" class="linenr">1517</a>         // Now we start searching backwards through the dictionary for this word.</div>
<div class="pre"><a id="l1518" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1518" class="linenr">1518</a>         mov var_LATEST,%edx     // LATEST points to name header of the latest word in the dictionary</div>
<div class="pre"><a id="l1519" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1519" class="linenr">1519</a> 1:      test %edx,%edx          // NULL pointer?  (end of the linked list)</div>
<div class="pre"><a id="l1520" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1520" class="linenr">1520</a>         je 4f</div>
<div class="pre"><a id="l1521" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1521" class="linenr">1521</a> </div>
<div class="pre"><a id="l1522" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1522" class="linenr">1522</a>         // Compare the length expected and the length of the word.</div>
<div class="pre"><a id="l1523" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1523" class="linenr">1523</a>         // Note that if the F_HIDDEN flag is set on the word, then by a bit of trickery</div>
<div class="pre"><a id="l1524" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1524" class="linenr">1524</a>         // this won't pick the word (the length will appear to be wrong).</div>
<div class="pre"><a id="l1525" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1525" class="linenr">1525</a>         xor %eax,%eax</div>
<div class="pre"><a id="l1526" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1526" class="linenr">1526</a>         movb 4(%edx),%al        // %al = flags+length field</div>
<div class="pre"><a id="l1527" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1527" class="linenr">1527</a>         andb $(F_HIDDEN|F_LENMASK),%al // %al = name length</div>
<div class="pre"><a id="l1528" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1528" class="linenr">1528</a>         cmpb %cl,%al            // Length is the same?</div>
<div class="pre"><a id="l1529" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1529" class="linenr">1529</a>         jne 2f</div>
<div class="pre"><a id="l1530" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1530" class="linenr">1530</a> </div>
<div class="pre"><a id="l1531" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1531" class="linenr">1531</a>         // Compare the strings in detail.</div>
<div class="pre"><a id="l1532" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1532" class="linenr">1532</a>         push %ecx               // Save the length</div>
<div class="pre"><a id="l1533" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1533" class="linenr">1533</a>         push %edi               // Save the address (repe cmpsb will move this pointer)</div>
<div class="pre"><a id="l1534" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1534" class="linenr">1534</a>         lea 5(%edx),%esi        // Dictionary string we are checking against.</div>
<div class="pre"><a id="l1535" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1535" class="linenr">1535</a>         repe cmpsb              // Compare the strings.</div>
<div class="pre"><a id="l1536" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1536" class="linenr">1536</a>         pop %edi</div>
<div class="pre"><a id="l1537" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1537" class="linenr">1537</a>         pop %ecx</div>
<div class="pre"><a id="l1538" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1538" class="linenr">1538</a>         jne 2f                  // Not the same.</div>
<div class="pre"><a id="l1539" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1539" class="linenr">1539</a> </div>
<div class="pre"><a id="l1540" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1540" class="linenr">1540</a>         // The strings are the same - return the header pointer in %eax</div>
<div class="pre"><a id="l1541" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1541" class="linenr">1541</a>         pop %esi</div>
<div class="pre"><a id="l1542" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1542" class="linenr">1542</a>         mov %edx,%eax</div>
<div class="pre"><a id="l1543" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1543" class="linenr">1543</a>         ret</div>
<div class="pre"><a id="l1544" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1544" class="linenr">1544</a> </div>
<div class="pre"><a id="l1545" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1545" class="linenr">1545</a> 2:      mov (%edx),%edx         // Move back through the link field to the previous word</div>
<div class="pre"><a id="l1546" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1546" class="linenr">1546</a>         jmp 1b                  // .. and loop.</div>
<div class="pre"><a id="l1547" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1547" class="linenr">1547</a> </div>
<div class="pre"><a id="l1548" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1548" class="linenr">1548</a> 4:      // Not found.</div>
<div class="pre"><a id="l1549" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1549" class="linenr">1549</a>         pop %esi</div>
<div class="pre"><a id="l1550" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1550" class="linenr">1550</a>         xor %eax,%eax           // Return zero to indicate not found.</div>
<div class="pre"><a id="l1551" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1551" class="linenr">1551</a>         ret</div>
<div class="pre"><a id="l1552" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1552" class="linenr">1552</a> </div>
<div class="pre"><a id="l1553" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1553" class="linenr">1553</a> /*</div>
<div class="pre"><a id="l1554" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1554" class="linenr">1554</a>         FIND returns the dictionary pointer, but when compiling we need the codeword pointer (recall</div>
<div class="pre"><a id="l1555" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1555" class="linenr">1555</a>         that FORTH definitions are compiled into lists of codeword pointers).  The standard FORTH</div>
<div class="pre"><a id="l1556" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1556" class="linenr">1556</a>         word &gt;CFA turns a dictionary pointer into a codeword pointer.</div>
<div class="pre"><a id="l1557" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1557" class="linenr">1557</a> </div>
<div class="pre"><a id="l1558" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1558" class="linenr">1558</a>         The example below shows the result of:</div>
<div class="pre"><a id="l1559" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1559" class="linenr">1559</a> </div>
<div class="pre"><a id="l1560" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1560" class="linenr">1560</a>                 WORD DOUBLE FIND &gt;CFA</div>
<div class="pre"><a id="l1561" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1561" class="linenr">1561</a> </div>
<div class="pre"><a id="l1562" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1562" class="linenr">1562</a>         FIND returns a pointer to this</div>
<div class="pre"><a id="l1563" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1563" class="linenr">1563</a>         |                               &gt;CFA converts it to a pointer to this</div>
<div class="pre"><a id="l1564" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1564" class="linenr">1564</a>         |                                          |</div>
<div class="pre"><a id="l1565" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1565" class="linenr">1565</a>         V                                          V</div>
<div class="pre"><a id="l1566" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1566" class="linenr">1566</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1567" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1567" class="linenr">1567</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          | EXIT       |</div>
<div class="pre"><a id="l1568" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1568" class="linenr">1568</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1569" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1569" class="linenr">1569</a>                                                    codeword</div>
<div class="pre"><a id="l1570" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1570" class="linenr">1570</a> </div>
<div class="pre"><a id="l1571" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1571" class="linenr">1571</a>         Notes:</div>
<div class="pre"><a id="l1572" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1572" class="linenr">1572</a> </div>
<div class="pre"><a id="l1573" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1573" class="linenr">1573</a>         Because names vary in length, this isn't just a simple increment.</div>
<div class="pre"><a id="l1574" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1574" class="linenr">1574</a> </div>
<div class="pre"><a id="l1575" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1575" class="linenr">1575</a>         In this FORTH you cannot easily turn a codeword pointer back into a dictionary entry pointer, but</div>
<div class="pre"><a id="l1576" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1576" class="linenr">1576</a>         that is not true in most FORTH implementations where they store a back pointer in the definition</div>
<div class="pre"><a id="l1577" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1577" class="linenr">1577</a>         (with an obvious memory/complexity cost).  The reason they do this is that it is useful to be</div>
<div class="pre"><a id="l1578" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1578" class="linenr">1578</a>         able to go backwards (codeword -&gt; dictionary entry) in order to decompile FORTH definitions</div>
<div class="pre"><a id="l1579" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1579" class="linenr">1579</a>         quickly.</div>
<div class="pre"><a id="l1580" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1580" class="linenr">1580</a> </div>
<div class="pre"><a id="l1581" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1581" class="linenr">1581</a>         What does CFA stand for?  My best guess is "Code Field Address".</div>
<div class="pre"><a id="l1582" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1582" class="linenr">1582</a> */</div>
<div class="pre"><a id="l1583" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1583" class="linenr">1583</a> </div>
<div class="pre"><a id="l1584" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1584" class="linenr">1584</a>         defcode "&gt;CFA",4,,TCFA</div>
<div class="pre"><a id="l1585" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1585" class="linenr">1585</a>         pop %edi</div>
<div class="pre"><a id="l1586" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1586" class="linenr">1586</a>         call _TCFA</div>
<div class="pre"><a id="l1587" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1587" class="linenr">1587</a>         push %edi</div>
<div class="pre"><a id="l1588" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1588" class="linenr">1588</a>         NEXT</div>
<div class="pre"><a id="l1589" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1589" class="linenr">1589</a> _TCFA:</div>
<div class="pre"><a id="l1590" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1590" class="linenr">1590</a>         xor %eax,%eax</div>
<div class="pre"><a id="l1591" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1591" class="linenr">1591</a>         add $4,%edi             // Skip link pointer.</div>
<div class="pre"><a id="l1592" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1592" class="linenr">1592</a>         movb (%edi),%al         // Load flags+len into %al.</div>
<div class="pre"><a id="l1593" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1593" class="linenr">1593</a>         inc %edi                // Skip flags+len byte.</div>
<div class="pre"><a id="l1594" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1594" class="linenr">1594</a>         andb $F_LENMASK,%al     // Just the length, not the flags.</div>
<div class="pre"><a id="l1595" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1595" class="linenr">1595</a>         add %eax,%edi           // Skip the name.</div>
<div class="pre"><a id="l1596" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1596" class="linenr">1596</a>         addl $3,%edi            // The codeword is 4-byte aligned.</div>
<div class="pre"><a id="l1597" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1597" class="linenr">1597</a>         andl $~3,%edi</div>
<div class="pre"><a id="l1598" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1598" class="linenr">1598</a>         ret</div>
<div class="pre"><a id="l1599" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1599" class="linenr">1599</a> </div>
<div class="pre"><a id="l1600" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1600" class="linenr">1600</a> /*</div>
<div class="pre"><a id="l1601" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1601" class="linenr">1601</a>         Related to &gt;CFA is &gt;DFA which takes a dictionary entry address as returned by FIND and</div>
<div class="pre"><a id="l1602" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1602" class="linenr">1602</a>         returns a pointer to the first data field.</div>
<div class="pre"><a id="l1603" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1603" class="linenr">1603</a> </div>
<div class="pre"><a id="l1604" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1604" class="linenr">1604</a>         FIND returns a pointer to this</div>
<div class="pre"><a id="l1605" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1605" class="linenr">1605</a>         |                               &gt;CFA converts it to a pointer to this</div>
<div class="pre"><a id="l1606" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1606" class="linenr">1606</a>         |                                          |</div>
<div class="pre"><a id="l1607" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1607" class="linenr">1607</a>         |                                          |    &gt;DFA converts it to a pointer to this</div>
<div class="pre"><a id="l1608" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1608" class="linenr">1608</a>         |                                          |             |</div>
<div class="pre"><a id="l1609" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1609" class="linenr">1609</a>         V                                          V             V</div>
<div class="pre"><a id="l1610" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1610" class="linenr">1610</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1611" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1611" class="linenr">1611</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          | EXIT       |</div>
<div class="pre"><a id="l1612" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1612" class="linenr">1612</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1613" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1613" class="linenr">1613</a>                                                    codeword</div>
<div class="pre"><a id="l1614" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1614" class="linenr">1614</a> </div>
<div class="pre"><a id="l1615" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1615" class="linenr">1615</a>         (Note to those following the source of FIG-FORTH / ciforth: My &gt;DFA definition is</div>
<div class="pre"><a id="l1616" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1616" class="linenr">1616</a>         different from theirs, because they have an extra indirection).</div>
<div class="pre"><a id="l1617" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1617" class="linenr">1617</a> </div>
<div class="pre"><a id="l1618" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1618" class="linenr">1618</a>         You can see that &gt;DFA is easily defined in FORTH just by adding 4 to the result of &gt;CFA.</div>
<div class="pre"><a id="l1619" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1619" class="linenr">1619</a> */</div>
<div class="pre"><a id="l1620" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1620" class="linenr">1620</a> </div>
<div class="pre"><a id="l1621" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1621" class="linenr">1621</a>         defword "&gt;DFA",4,,TDFA</div>
<div class="pre"><a id="l1622" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1622" class="linenr">1622</a>         .int TCFA               // &gt;CFA         (get code field address)</div>
<div class="pre"><a id="l1623" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1623" class="linenr">1623</a>         .int INCR4              // 4+           (add 4 to it to get to next word)</div>
<div class="pre"><a id="l1624" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1624" class="linenr">1624</a>         .int EXIT               // EXIT         (return from FORTH word)</div>
<div class="pre"><a id="l1625" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1625" class="linenr">1625</a> </div>
<div class="pre"><a id="l1626" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1626" class="linenr">1626</a> /*</div>
<div class="pre"><a id="l1627" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1627" class="linenr">1627</a>         COMPILING ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1628" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1628" class="linenr">1628</a> </div>
<div class="pre"><a id="l1629" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1629" class="linenr">1629</a>         Now we'll talk about how FORTH compiles words.  Recall that a word definition looks like this:</div>
<div class="pre"><a id="l1630" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1630" class="linenr">1630</a> </div>
<div class="pre"><a id="l1631" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1631" class="linenr">1631</a>                 : DOUBLE DUP + ;</div>
<div class="pre"><a id="l1632" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1632" class="linenr">1632</a> </div>
<div class="pre"><a id="l1633" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1633" class="linenr">1633</a>         and we have to turn this into:</div>
<div class="pre"><a id="l1634" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1634" class="linenr">1634</a> </div>
<div class="pre"><a id="l1635" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1635" class="linenr">1635</a>           pointer to previous word</div>
<div class="pre"><a id="l1636" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1636" class="linenr">1636</a>            ^</div>
<div class="pre"><a id="l1637" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1637" class="linenr">1637</a>            |</div>
<div class="pre"><a id="l1638" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1638" class="linenr">1638</a>         +--|------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1639" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1639" class="linenr">1639</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          | EXIT       |</div>
<div class="pre"><a id="l1640" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1640" class="linenr">1640</a>         +---------+---+---+---+---+---+---+---+---+------------+--|---------+------------+------------+</div>
<div class="pre"><a id="l1641" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1641" class="linenr">1641</a>            ^       len                         pad  codeword      |</div>
<div class="pre"><a id="l1642" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1642" class="linenr">1642</a>            |                                                      V</div>
<div class="pre"><a id="l1643" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1643" class="linenr">1643</a>           LATEST points here                            points to codeword of DUP</div>
<div class="pre"><a id="l1644" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1644" class="linenr">1644</a> </div>
<div class="pre"><a id="l1645" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1645" class="linenr">1645</a>         There are several problems to solve.  Where to put the new word?  How do we read words?  How</div>
<div class="pre"><a id="l1646" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1646" class="linenr">1646</a>         do we define the words : (COLON) and ; (SEMICOLON)?</div>
<div class="pre"><a id="l1647" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1647" class="linenr">1647</a> </div>
<div class="pre"><a id="l1648" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1648" class="linenr">1648</a>         FORTH solves this rather elegantly and as you might expect in a very low-level way which</div>
<div class="pre"><a id="l1649" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1649" class="linenr">1649</a>         allows you to change how the compiler works on your own code.</div>
<div class="pre"><a id="l1650" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1650" class="linenr">1650</a> </div>
<div class="pre"><a id="l1651" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1651" class="linenr">1651</a>         FORTH has an INTERPRET function (a true interpreter this time, not DOCOL) which runs in a</div>
<div class="pre"><a id="l1652" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1652" class="linenr">1652</a>         loop, reading words (using WORD), looking them up (using FIND), turning them into codeword</div>
<div class="pre"><a id="l1653" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1653" class="linenr">1653</a>         pointers (using &gt;CFA) and deciding what to do with them.</div>
<div class="pre"><a id="l1654" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1654" class="linenr">1654</a> </div>
<div class="pre"><a id="l1655" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1655" class="linenr">1655</a>         What it does depends on the mode of the interpreter (in variable STATE).</div>
<div class="pre"><a id="l1656" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1656" class="linenr">1656</a> </div>
<div class="pre"><a id="l1657" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1657" class="linenr">1657</a>         When STATE is zero, the interpreter just runs each word as it looks them up.  This is known as</div>
<div class="pre"><a id="l1658" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1658" class="linenr">1658</a>         immediate mode.</div>
<div class="pre"><a id="l1659" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1659" class="linenr">1659</a> </div>
<div class="pre"><a id="l1660" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1660" class="linenr">1660</a>         The interesting stuff happens when STATE is non-zero -- compiling mode.  In this mode the</div>
<div class="pre"><a id="l1661" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1661" class="linenr">1661</a>         interpreter appends the codeword pointer to user memory (the HERE variable points to the next</div>
<div class="pre"><a id="l1662" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1662" class="linenr">1662</a>         free byte of user memory -- see DATA SEGMENT section below).</div>
<div class="pre"><a id="l1663" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1663" class="linenr">1663</a> </div>
<div class="pre"><a id="l1664" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1664" class="linenr">1664</a>         So you may be able to see how we could define : (COLON).  The general plan is:</div>
<div class="pre"><a id="l1665" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1665" class="linenr">1665</a> </div>
<div class="pre"><a id="l1666" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1666" class="linenr">1666</a>         (1) Use WORD to read the name of the function being defined.</div>
<div class="pre"><a id="l1667" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1667" class="linenr">1667</a> </div>
<div class="pre"><a id="l1668" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1668" class="linenr">1668</a>         (2) Construct the dictionary entry -- just the header part -- in user memory:</div>
<div class="pre"><a id="l1669" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1669" class="linenr">1669</a> </div>
<div class="pre"><a id="l1670" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1670" class="linenr">1670</a>     pointer to previous word (from LATEST)                      +-- Afterwards, HERE points here, where</div>
<div class="pre"><a id="l1671" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1671" class="linenr">1671</a>            ^                                                    |   the interpreter will start appending</div>
<div class="pre"><a id="l1672" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1672" class="linenr">1672</a>            |                                                    V   codewords.</div>
<div class="pre"><a id="l1673" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1673" class="linenr">1673</a>         +--|------+---+---+---+---+---+---+---+---+------------+</div>
<div class="pre"><a id="l1674" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1674" class="linenr">1674</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      |</div>
<div class="pre"><a id="l1675" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1675" class="linenr">1675</a>         +---------+---+---+---+---+---+---+---+---+------------+</div>
<div class="pre"><a id="l1676" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1676" class="linenr">1676</a>                    len                         pad  codeword</div>
<div class="pre"><a id="l1677" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1677" class="linenr">1677</a> </div>
<div class="pre"><a id="l1678" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1678" class="linenr">1678</a>         (3) Set LATEST to point to the newly defined word, ...</div>
<div class="pre"><a id="l1679" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1679" class="linenr">1679</a> </div>
<div class="pre"><a id="l1680" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1680" class="linenr">1680</a>         (4) .. and most importantly leave HERE pointing just after the new codeword.  This is where</div>
<div class="pre"><a id="l1681" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1681" class="linenr">1681</a>             the interpreter will append codewords.</div>
<div class="pre"><a id="l1682" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1682" class="linenr">1682</a> </div>
<div class="pre"><a id="l1683" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1683" class="linenr">1683</a>         (5) Set STATE to 1.  This goes into compile mode so the interpreter starts appending codewords to</div>
<div class="pre"><a id="l1684" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1684" class="linenr">1684</a>             our partially-formed header.</div>
<div class="pre"><a id="l1685" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1685" class="linenr">1685</a> </div>
<div class="pre"><a id="l1686" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1686" class="linenr">1686</a>         After : has run, our input is here:</div>
<div class="pre"><a id="l1687" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1687" class="linenr">1687</a> </div>
<div class="pre"><a id="l1688" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1688" class="linenr">1688</a>         : DOUBLE DUP + ;</div>
<div class="pre"><a id="l1689" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1689" class="linenr">1689</a>                  ^</div>
<div class="pre"><a id="l1690" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1690" class="linenr">1690</a>                  |</div>
<div class="pre"><a id="l1691" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1691" class="linenr">1691</a>                 Next byte returned by KEY will be the 'D' character of DUP</div>
<div class="pre"><a id="l1692" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1692" class="linenr">1692</a> </div>
<div class="pre"><a id="l1693" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1693" class="linenr">1693</a>         so the interpreter (now it's in compile mode, so I guess it's really the compiler) reads "DUP",</div>
<div class="pre"><a id="l1694" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1694" class="linenr">1694</a>         looks it up in the dictionary, gets its codeword pointer, and appends it:</div>
<div class="pre"><a id="l1695" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1695" class="linenr">1695</a> </div>
<div class="pre"><a id="l1696" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1696" class="linenr">1696</a>                                                                              +-- HERE updated to point here.</div>
<div class="pre"><a id="l1697" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1697" class="linenr">1697</a>                                                                              |</div>
<div class="pre"><a id="l1698" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1698" class="linenr">1698</a>                                                                              V</div>
<div class="pre"><a id="l1699" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1699" class="linenr">1699</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+</div>
<div class="pre"><a id="l1700" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1700" class="linenr">1700</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        |</div>
<div class="pre"><a id="l1701" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1701" class="linenr">1701</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+</div>
<div class="pre"><a id="l1702" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1702" class="linenr">1702</a>                    len                         pad  codeword</div>
<div class="pre"><a id="l1703" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1703" class="linenr">1703</a> </div>
<div class="pre"><a id="l1704" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1704" class="linenr">1704</a>         Next we read +, get the codeword pointer, and append it:</div>
<div class="pre"><a id="l1705" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1705" class="linenr">1705</a> </div>
<div class="pre"><a id="l1706" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1706" class="linenr">1706</a>                                                                                           +-- HERE updated to point here.</div>
<div class="pre"><a id="l1707" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1707" class="linenr">1707</a>                                                                                           |</div>
<div class="pre"><a id="l1708" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1708" class="linenr">1708</a>                                                                                           V</div>
<div class="pre"><a id="l1709" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1709" class="linenr">1709</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+</div>
<div class="pre"><a id="l1710" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1710" class="linenr">1710</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          |</div>
<div class="pre"><a id="l1711" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1711" class="linenr">1711</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+</div>
<div class="pre"><a id="l1712" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1712" class="linenr">1712</a>                    len                         pad  codeword</div>
<div class="pre"><a id="l1713" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1713" class="linenr">1713</a> </div>
<div class="pre"><a id="l1714" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1714" class="linenr">1714</a>         The issue is what happens next.  Obviously what we _don't_ want to happen is that we</div>
<div class="pre"><a id="l1715" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1715" class="linenr">1715</a>         read ";" and compile it and go on compiling everything afterwards.</div>
<div class="pre"><a id="l1716" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1716" class="linenr">1716</a> </div>
<div class="pre"><a id="l1717" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1717" class="linenr">1717</a>         At this point, FORTH uses a trick.  Remember the length byte in the dictionary definition</div>
<div class="pre"><a id="l1718" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1718" class="linenr">1718</a>         isn't just a plain length byte, but can also contain flags.  One flag is called the</div>
<div class="pre"><a id="l1719" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1719" class="linenr">1719</a>         IMMEDIATE flag (F_IMMED in this code).  If a word in the dictionary is flagged as</div>
<div class="pre"><a id="l1720" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1720" class="linenr">1720</a>         IMMEDIATE then the interpreter runs it immediately _even if it's in compile mode_.</div>
<div class="pre"><a id="l1721" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1721" class="linenr">1721</a> </div>
<div class="pre"><a id="l1722" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1722" class="linenr">1722</a>         This is how the word ; (SEMICOLON) works -- as a word flagged in the dictionary as IMMEDIATE.</div>
<div class="pre"><a id="l1723" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1723" class="linenr">1723</a> </div>
<div class="pre"><a id="l1724" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1724" class="linenr">1724</a>         And all it does is append the codeword for EXIT on to the current definition and switch</div>
<div class="pre"><a id="l1725" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1725" class="linenr">1725</a>         back to immediate mode (set STATE back to 0).  Shortly we'll see the actual definition</div>
<div class="pre"><a id="l1726" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1726" class="linenr">1726</a>         of ; and we'll see that it's really a very simple definition, declared IMMEDIATE.</div>
<div class="pre"><a id="l1727" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1727" class="linenr">1727</a> </div>
<div class="pre"><a id="l1728" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1728" class="linenr">1728</a>         After the interpreter reads ; and executes it 'immediately', we get this:</div>
<div class="pre"><a id="l1729" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1729" class="linenr">1729</a> </div>
<div class="pre"><a id="l1730" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1730" class="linenr">1730</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1731" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1731" class="linenr">1731</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      | DUP        | +          | EXIT       |</div>
<div class="pre"><a id="l1732" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1732" class="linenr">1732</a>         +---------+---+---+---+---+---+---+---+---+------------+------------+------------+------------+</div>
<div class="pre"><a id="l1733" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1733" class="linenr">1733</a>                    len                         pad  codeword                                           ^</div>
<div class="pre"><a id="l1734" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1734" class="linenr">1734</a>                                                                                                        |</div>
<div class="pre"><a id="l1735" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1735" class="linenr">1735</a>                                                                                                       HERE</div>
<div class="pre"><a id="l1736" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1736" class="linenr">1736</a>         STATE is set to 0.</div>
<div class="pre"><a id="l1737" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1737" class="linenr">1737</a> </div>
<div class="pre"><a id="l1738" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1738" class="linenr">1738</a>         And that's it, job done, our new definition is compiled, and we're back in immediate mode</div>
<div class="pre"><a id="l1739" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1739" class="linenr">1739</a>         just reading and executing words, perhaps including a call to test our new word DOUBLE.</div>
<div class="pre"><a id="l1740" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1740" class="linenr">1740</a> </div>
<div class="pre"><a id="l1741" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1741" class="linenr">1741</a>         The only last wrinkle in this is that while our word was being compiled, it was in a</div>
<div class="pre"><a id="l1742" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1742" class="linenr">1742</a>         half-finished state.  We certainly wouldn't want DOUBLE to be called somehow during</div>
<div class="pre"><a id="l1743" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1743" class="linenr">1743</a>         this time.  There are several ways to stop this from happening, but in FORTH what we</div>
<div class="pre"><a id="l1744" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1744" class="linenr">1744</a>         do is flag the word with the HIDDEN flag (F_HIDDEN in this code) just while it is</div>
<div class="pre"><a id="l1745" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1745" class="linenr">1745</a>         being compiled.  This prevents FIND from finding it, and thus in theory stops any</div>
<div class="pre"><a id="l1746" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1746" class="linenr">1746</a>         chance of it being called.</div>
<div class="pre"><a id="l1747" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1747" class="linenr">1747</a> </div>
<div class="pre"><a id="l1748" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1748" class="linenr">1748</a>         The above explains how compiling, : (COLON) and ; (SEMICOLON) works and in a moment I'm</div>
<div class="pre"><a id="l1749" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1749" class="linenr">1749</a>         going to define them.  The : (COLON) function can be made a little bit more general by writing</div>
<div class="pre"><a id="l1750" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1750" class="linenr">1750</a>         it in two parts.  The first part, called CREATE, makes just the header:</div>
<div class="pre"><a id="l1751" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1751" class="linenr">1751</a> </div>
<div class="pre"><a id="l1752" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1752" class="linenr">1752</a>                                                    +-- Afterwards, HERE points here.</div>
<div class="pre"><a id="l1753" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1753" class="linenr">1753</a>                                                    |</div>
<div class="pre"><a id="l1754" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1754" class="linenr">1754</a>                                                    V</div>
<div class="pre"><a id="l1755" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1755" class="linenr">1755</a>         +---------+---+---+---+---+---+---+---+---+</div>
<div class="pre"><a id="l1756" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1756" class="linenr">1756</a>         | LINK    | 6 | D | O | U | B | L | E | 0 |</div>
<div class="pre"><a id="l1757" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1757" class="linenr">1757</a>         +---------+---+---+---+---+---+---+---+---+</div>
<div class="pre"><a id="l1758" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1758" class="linenr">1758</a>                    len                         pad</div>
<div class="pre"><a id="l1759" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1759" class="linenr">1759</a> </div>
<div class="pre"><a id="l1760" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1760" class="linenr">1760</a>         and the second part, the actual definition of : (COLON), calls CREATE and appends the</div>
<div class="pre"><a id="l1761" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1761" class="linenr">1761</a>         DOCOL codeword, so leaving:</div>
<div class="pre"><a id="l1762" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1762" class="linenr">1762</a> </div>
<div class="pre"><a id="l1763" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1763" class="linenr">1763</a>                                                                 +-- Afterwards, HERE points here.</div>
<div class="pre"><a id="l1764" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1764" class="linenr">1764</a>                                                                 |</div>
<div class="pre"><a id="l1765" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1765" class="linenr">1765</a>                                                                 V</div>
<div class="pre"><a id="l1766" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1766" class="linenr">1766</a>         +---------+---+---+---+---+---+---+---+---+------------+</div>
<div class="pre"><a id="l1767" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1767" class="linenr">1767</a>         | LINK    | 6 | D | O | U | B | L | E | 0 | DOCOL      |</div>
<div class="pre"><a id="l1768" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1768" class="linenr">1768</a>         +---------+---+---+---+---+---+---+---+---+------------+</div>
<div class="pre"><a id="l1769" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1769" class="linenr">1769</a>                    len                         pad  codeword</div>
<div class="pre"><a id="l1770" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1770" class="linenr">1770</a> </div>
<div class="pre"><a id="l1771" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1771" class="linenr">1771</a>         CREATE is a standard FORTH word and the advantage of this split is that we can reuse it to</div>
<div class="pre"><a id="l1772" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1772" class="linenr">1772</a>         create other types of words (not just ones which contain code, but words which contain variables,</div>
<div class="pre"><a id="l1773" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1773" class="linenr">1773</a>         constants and other data).</div>
<div class="pre"><a id="l1774" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1774" class="linenr">1774</a> */</div>
<div class="pre"><a id="l1775" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1775" class="linenr">1775</a> </div>
<div class="pre"><a id="l1776" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1776" class="linenr">1776</a>         defcode "CREATE",6,,CREATE</div>
<div class="pre"><a id="l1777" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1777" class="linenr">1777</a> </div>
<div class="pre"><a id="l1778" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1778" class="linenr">1778</a>         // Get the name length and address.</div>
<div class="pre"><a id="l1779" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1779" class="linenr">1779</a>         pop %ecx                // %ecx = length</div>
<div class="pre"><a id="l1780" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1780" class="linenr">1780</a>         pop %ebx                // %ebx = address of name</div>
<div class="pre"><a id="l1781" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1781" class="linenr">1781</a> </div>
<div class="pre"><a id="l1782" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1782" class="linenr">1782</a>         // Link pointer.</div>
<div class="pre"><a id="l1783" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1783" class="linenr">1783</a>         movl var_HERE,%edi      // %edi is the address of the header</div>
<div class="pre"><a id="l1784" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1784" class="linenr">1784</a>         movl var_LATEST,%eax    // Get link pointer</div>
<div class="pre"><a id="l1785" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1785" class="linenr">1785</a>         stosl                   // and store it in the header.</div>
<div class="pre"><a id="l1786" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1786" class="linenr">1786</a> </div>
<div class="pre"><a id="l1787" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1787" class="linenr">1787</a>         // Length byte and the word itself.</div>
<div class="pre"><a id="l1788" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1788" class="linenr">1788</a>         mov %cl,%al             // Get the length.</div>
<div class="pre"><a id="l1789" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1789" class="linenr">1789</a>         stosb                   // Store the length/flags byte.</div>
<div class="pre"><a id="l1790" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1790" class="linenr">1790</a>         push %esi</div>
<div class="pre"><a id="l1791" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1791" class="linenr">1791</a>         mov %ebx,%esi           // %esi = word</div>
<div class="pre"><a id="l1792" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1792" class="linenr">1792</a>         rep movsb               // Copy the word</div>
<div class="pre"><a id="l1793" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1793" class="linenr">1793</a>         pop %esi</div>
<div class="pre"><a id="l1794" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1794" class="linenr">1794</a>         addl $3,%edi            // Align to next 4 byte boundary.</div>
<div class="pre"><a id="l1795" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1795" class="linenr">1795</a>         andl $~3,%edi</div>
<div class="pre"><a id="l1796" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1796" class="linenr">1796</a> </div>
<div class="pre"><a id="l1797" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1797" class="linenr">1797</a>         // Update LATEST and HERE.</div>
<div class="pre"><a id="l1798" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1798" class="linenr">1798</a>         movl var_HERE,%eax</div>
<div class="pre"><a id="l1799" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1799" class="linenr">1799</a>         movl %eax,var_LATEST</div>
<div class="pre"><a id="l1800" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1800" class="linenr">1800</a>         movl %edi,var_HERE</div>
<div class="pre"><a id="l1801" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1801" class="linenr">1801</a>         NEXT</div>
<div class="pre"><a id="l1802" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1802" class="linenr">1802</a> </div>
<div class="pre"><a id="l1803" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1803" class="linenr">1803</a> /*</div>
<div class="pre"><a id="l1804" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1804" class="linenr">1804</a>         Because I want to define : (COLON) in FORTH, not assembler, we need a few more FORTH words</div>
<div class="pre"><a id="l1805" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1805" class="linenr">1805</a>         to use.</div>
<div class="pre"><a id="l1806" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1806" class="linenr">1806</a> </div>
<div class="pre"><a id="l1807" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1807" class="linenr">1807</a>         The first is , (COMMA) which is a standard FORTH word which appends a 32 bit integer to the user</div>
<div class="pre"><a id="l1808" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1808" class="linenr">1808</a>         memory pointed to by HERE, and adds 4 to HERE.  So the action of , (COMMA) is:</div>
<div class="pre"><a id="l1809" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1809" class="linenr">1809</a> </div>
<div class="pre"><a id="l1810" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1810" class="linenr">1810</a>                                                         previous value of HERE</div>
<div class="pre"><a id="l1811" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1811" class="linenr">1811</a>                                                                  |</div>
<div class="pre"><a id="l1812" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1812" class="linenr">1812</a>                                                                  V</div>
<div class="pre"><a id="l1813" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1813" class="linenr">1813</a>         +---------+---+---+---+---+---+---+---+---+-- - - - - --+------------+</div>
<div class="pre"><a id="l1814" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1814" class="linenr">1814</a>         | LINK    | 6 | D | O | U | B | L | E | 0 |             |  &lt;data&gt;    |</div>
<div class="pre"><a id="l1815" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1815" class="linenr">1815</a>         +---------+---+---+---+---+---+---+---+---+-- - - - - --+------------+</div>
<div class="pre"><a id="l1816" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1816" class="linenr">1816</a>                    len                         pad                            ^</div>
<div class="pre"><a id="l1817" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1817" class="linenr">1817</a>                                                                               |</div>
<div class="pre"><a id="l1818" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1818" class="linenr">1818</a>                                                                         new value of HERE</div>
<div class="pre"><a id="l1819" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1819" class="linenr">1819</a> </div>
<div class="pre"><a id="l1820" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1820" class="linenr">1820</a>         and &lt;data&gt; is whatever 32 bit integer was at the top of the stack.</div>
<div class="pre"><a id="l1821" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1821" class="linenr">1821</a> </div>
<div class="pre"><a id="l1822" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1822" class="linenr">1822</a>         , (COMMA) is quite a fundamental operation when compiling.  It is used to append codewords</div>
<div class="pre"><a id="l1823" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1823" class="linenr">1823</a>         to the current word that is being compiled.</div>
<div class="pre"><a id="l1824" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1824" class="linenr">1824</a> */</div>
<div class="pre"><a id="l1825" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1825" class="linenr">1825</a> </div>
<div class="pre"><a id="l1826" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1826" class="linenr">1826</a>         defcode ",",1,,COMMA</div>
<div class="pre"><a id="l1827" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1827" class="linenr">1827</a>         pop %eax                // Code pointer to store.</div>
<div class="pre"><a id="l1828" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1828" class="linenr">1828</a>         call _COMMA</div>
<div class="pre"><a id="l1829" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1829" class="linenr">1829</a>         NEXT</div>
<div class="pre"><a id="l1830" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1830" class="linenr">1830</a> _COMMA:</div>
<div class="pre"><a id="l1831" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1831" class="linenr">1831</a>         movl var_HERE,%edi      // HERE</div>
<div class="pre"><a id="l1832" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1832" class="linenr">1832</a>         stosl                   // Store it.</div>
<div class="pre"><a id="l1833" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1833" class="linenr">1833</a>         movl %edi,var_HERE      // Update HERE (incremented)</div>
<div class="pre"><a id="l1834" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1834" class="linenr">1834</a>         ret</div>
<div class="pre"><a id="l1835" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1835" class="linenr">1835</a> </div>
<div class="pre"><a id="l1836" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1836" class="linenr">1836</a> /*</div>
<div class="pre"><a id="l1837" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1837" class="linenr">1837</a>         Our definitions of : (COLON) and ; (SEMICOLON) will need to switch to and from compile mode.</div>
<div class="pre"><a id="l1838" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1838" class="linenr">1838</a> </div>
<div class="pre"><a id="l1839" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1839" class="linenr">1839</a>         Immediate mode vs. compile mode is stored in the global variable STATE, and by updating this</div>
<div class="pre"><a id="l1840" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1840" class="linenr">1840</a>         variable we can switch between the two modes.</div>
<div class="pre"><a id="l1841" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1841" class="linenr">1841</a> </div>
<div class="pre"><a id="l1842" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1842" class="linenr">1842</a>         For various reasons which may become apparent later, FORTH defines two standard words called</div>
<div class="pre"><a id="l1843" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1843" class="linenr">1843</a>         [ and ] (LBRAC and RBRAC) which switch between modes:</div>
<div class="pre"><a id="l1844" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1844" class="linenr">1844</a> </div>
<div class="pre"><a id="l1845" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1845" class="linenr">1845</a>         Word    Assembler       Action          Effect</div>
<div class="pre"><a id="l1846" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1846" class="linenr">1846</a>         [       LBRAC           STATE := 0      Switch to immediate mode.</div>
<div class="pre"><a id="l1847" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1847" class="linenr">1847</a>         ]       RBRAC           STATE := 1      Switch to compile mode.</div>
<div class="pre"><a id="l1848" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1848" class="linenr">1848</a> </div>
<div class="pre"><a id="l1849" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1849" class="linenr">1849</a>         [ (LBRAC) is an IMMEDIATE word.  The reason is as follows: If we are in compile mode and the</div>
<div class="pre"><a id="l1850" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1850" class="linenr">1850</a>         interpreter saw [ then it would compile it rather than running it.  We would never be able to</div>
<div class="pre"><a id="l1851" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1851" class="linenr">1851</a>         switch back to immediate mode!  So we flag the word as IMMEDIATE so that even in compile mode</div>
<div class="pre"><a id="l1852" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1852" class="linenr">1852</a>         the word runs immediately, switching us back to immediate mode.</div>
<div class="pre"><a id="l1853" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1853" class="linenr">1853</a> */</div>
<div class="pre"><a id="l1854" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1854" class="linenr">1854</a> </div>
<div class="pre"><a id="l1855" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1855" class="linenr">1855</a>         defcode "[",1,F_IMMED,LBRAC</div>
<div class="pre"><a id="l1856" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1856" class="linenr">1856</a>         xor %eax,%eax</div>
<div class="pre"><a id="l1857" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1857" class="linenr">1857</a>         movl %eax,var_STATE     // Set STATE to 0.</div>
<div class="pre"><a id="l1858" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1858" class="linenr">1858</a>         NEXT</div>
<div class="pre"><a id="l1859" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1859" class="linenr">1859</a> </div>
<div class="pre"><a id="l1860" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1860" class="linenr">1860</a>         defcode "]",1,,RBRAC</div>
<div class="pre"><a id="l1861" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1861" class="linenr">1861</a>         movl $1,var_STATE       // Set STATE to 1.</div>
<div class="pre"><a id="l1862" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1862" class="linenr">1862</a>         NEXT</div>
<div class="pre"><a id="l1863" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1863" class="linenr">1863</a> </div>
<div class="pre"><a id="l1864" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1864" class="linenr">1864</a> /*</div>
<div class="pre"><a id="l1865" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1865" class="linenr">1865</a>         Now we can define : (COLON) using CREATE.  It just calls CREATE, appends DOCOL (the codeword), sets</div>
<div class="pre"><a id="l1866" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1866" class="linenr">1866</a>         the word HIDDEN and goes into compile mode.</div>
<div class="pre"><a id="l1867" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1867" class="linenr">1867</a> */</div>
<div class="pre"><a id="l1868" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1868" class="linenr">1868</a> </div>
<div class="pre"><a id="l1869" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1869" class="linenr">1869</a>         defword ":",1,,COLON</div>
<div class="pre"><a id="l1870" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1870" class="linenr">1870</a>         .int WORD               // Get the name of the new word</div>
<div class="pre"><a id="l1871" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1871" class="linenr">1871</a>         .int CREATE             // CREATE the dictionary entry / header</div>
<div class="pre"><a id="l1872" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1872" class="linenr">1872</a>         .int LIT, DOCOL, COMMA  // Append DOCOL  (the codeword).</div>
<div class="pre"><a id="l1873" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1873" class="linenr">1873</a>         .int LATEST, FETCH, HIDDEN // Make the word hidden (see below for definition).</div>
<div class="pre"><a id="l1874" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1874" class="linenr">1874</a>         .int RBRAC              // Go into compile mode.</div>
<div class="pre"><a id="l1875" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1875" class="linenr">1875</a>         .int EXIT               // Return from the function.</div>
<div class="pre"><a id="l1876" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1876" class="linenr">1876</a> </div>
<div class="pre"><a id="l1877" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1877" class="linenr">1877</a> /*</div>
<div class="pre"><a id="l1878" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1878" class="linenr">1878</a>         ; (SEMICOLON) is also elegantly simple.  Notice the F_IMMED flag.</div>
<div class="pre"><a id="l1879" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1879" class="linenr">1879</a> */</div>
<div class="pre"><a id="l1880" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1880" class="linenr">1880</a> </div>
<div class="pre"><a id="l1881" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1881" class="linenr">1881</a>         defword ";",1,F_IMMED,SEMICOLON</div>
<div class="pre"><a id="l1882" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1882" class="linenr">1882</a>         .int LIT, EXIT, COMMA   // Append EXIT (so the word will return).</div>
<div class="pre"><a id="l1883" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1883" class="linenr">1883</a>         .int LATEST, FETCH, HIDDEN // Toggle hidden flag -- unhide the word (see below for definition).</div>
<div class="pre"><a id="l1884" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1884" class="linenr">1884</a>         .int LBRAC              // Go back to IMMEDIATE mode.</div>
<div class="pre"><a id="l1885" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1885" class="linenr">1885</a>         .int EXIT               // Return from the function.</div>
<div class="pre"><a id="l1886" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1886" class="linenr">1886</a> </div>
<div class="pre"><a id="l1887" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1887" class="linenr">1887</a> /*</div>
<div class="pre"><a id="l1888" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1888" class="linenr">1888</a>         EXTENDING THE COMPILER ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1889" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1889" class="linenr">1889</a> </div>
<div class="pre"><a id="l1890" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1890" class="linenr">1890</a>         Words flagged with IMMEDIATE (F_IMMED) aren't just for the FORTH compiler to use.  You can define</div>
<div class="pre"><a id="l1891" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1891" class="linenr">1891</a>         your own IMMEDIATE words too, and this is a crucial aspect when extending basic FORTH, because</div>
<div class="pre"><a id="l1892" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1892" class="linenr">1892</a>         it allows you in effect to extend the compiler itself.  Does gcc let you do that?</div>
<div class="pre"><a id="l1893" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1893" class="linenr">1893</a> </div>
<div class="pre"><a id="l1894" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1894" class="linenr">1894</a>         Standard FORTH words like IF, WHILE, ." and so on are all written as extensions to the basic</div>
<div class="pre"><a id="l1895" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1895" class="linenr">1895</a>         compiler, and are all IMMEDIATE words.</div>
<div class="pre"><a id="l1896" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1896" class="linenr">1896</a> </div>
<div class="pre"><a id="l1897" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1897" class="linenr">1897</a>         The IMMEDIATE word toggles the F_IMMED (IMMEDIATE flag) on the most recently defined word,</div>
<div class="pre"><a id="l1898" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1898" class="linenr">1898</a>         or on the current word if you call it in the middle of a definition.</div>
<div class="pre"><a id="l1899" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1899" class="linenr">1899</a> </div>
<div class="pre"><a id="l1900" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1900" class="linenr">1900</a>         Typical usage is:</div>
<div class="pre"><a id="l1901" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1901" class="linenr">1901</a> </div>
<div class="pre"><a id="l1902" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1902" class="linenr">1902</a>         : MYIMMEDWORD IMMEDIATE</div>
<div class="pre"><a id="l1903" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1903" class="linenr">1903</a>                 ...definition...</div>
<div class="pre"><a id="l1904" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1904" class="linenr">1904</a>         ;</div>
<div class="pre"><a id="l1905" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1905" class="linenr">1905</a> </div>
<div class="pre"><a id="l1906" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1906" class="linenr">1906</a>         but some FORTH programmers write this instead:</div>
<div class="pre"><a id="l1907" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1907" class="linenr">1907</a> </div>
<div class="pre"><a id="l1908" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1908" class="linenr">1908</a>         : MYIMMEDWORD</div>
<div class="pre"><a id="l1909" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1909" class="linenr">1909</a>                 ...definition...</div>
<div class="pre"><a id="l1910" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1910" class="linenr">1910</a>         ; IMMEDIATE</div>
<div class="pre"><a id="l1911" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1911" class="linenr">1911</a> </div>
<div class="pre"><a id="l1912" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1912" class="linenr">1912</a>         The two usages are equivalent, to a first approximation.</div>
<div class="pre"><a id="l1913" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1913" class="linenr">1913</a> */</div>
<div class="pre"><a id="l1914" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1914" class="linenr">1914</a> </div>
<div class="pre"><a id="l1915" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1915" class="linenr">1915</a>         defcode "IMMEDIATE",9,F_IMMED,IMMEDIATE</div>
<div class="pre"><a id="l1916" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1916" class="linenr">1916</a>         movl var_LATEST,%edi    // LATEST word.</div>
<div class="pre"><a id="l1917" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1917" class="linenr">1917</a>         addl $4,%edi            // Point to name/flags byte.</div>
<div class="pre"><a id="l1918" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1918" class="linenr">1918</a>         xorb $F_IMMED,(%edi)    // Toggle the IMMED bit.</div>
<div class="pre"><a id="l1919" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1919" class="linenr">1919</a>         NEXT</div>
<div class="pre"><a id="l1920" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1920" class="linenr">1920</a> </div>
<div class="pre"><a id="l1921" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1921" class="linenr">1921</a> /*</div>
<div class="pre"><a id="l1922" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1922" class="linenr">1922</a>         'addr HIDDEN' toggles the hidden flag (F_HIDDEN) of the word defined at addr.  To hide the</div>
<div class="pre"><a id="l1923" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1923" class="linenr">1923</a>         most recently defined word (used above in : and ; definitions) you would do:</div>
<div class="pre"><a id="l1924" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1924" class="linenr">1924</a> </div>
<div class="pre"><a id="l1925" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1925" class="linenr">1925</a>                 LATEST @ HIDDEN</div>
<div class="pre"><a id="l1926" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1926" class="linenr">1926</a> </div>
<div class="pre"><a id="l1927" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1927" class="linenr">1927</a>         'HIDE word' toggles the flag on a named 'word'.</div>
<div class="pre"><a id="l1928" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1928" class="linenr">1928</a> </div>
<div class="pre"><a id="l1929" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1929" class="linenr">1929</a>         Setting this flag stops the word from being found by FIND, and so can be used to make 'private'</div>
<div class="pre"><a id="l1930" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1930" class="linenr">1930</a>         words.  For example, to break up a large word into smaller parts you might do:</div>
<div class="pre"><a id="l1931" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1931" class="linenr">1931</a> </div>
<div class="pre"><a id="l1932" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1932" class="linenr">1932</a>                 : SUB1 ... subword ... ;</div>
<div class="pre"><a id="l1933" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1933" class="linenr">1933</a>                 : SUB2 ... subword ... ;</div>
<div class="pre"><a id="l1934" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1934" class="linenr">1934</a>                 : SUB3 ... subword ... ;</div>
<div class="pre"><a id="l1935" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1935" class="linenr">1935</a>                 : MAIN ... defined in terms of SUB1, SUB2, SUB3 ... ;</div>
<div class="pre"><a id="l1936" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1936" class="linenr">1936</a>                 HIDE SUB1</div>
<div class="pre"><a id="l1937" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1937" class="linenr">1937</a>                 HIDE SUB2</div>
<div class="pre"><a id="l1938" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1938" class="linenr">1938</a>                 HIDE SUB3</div>
<div class="pre"><a id="l1939" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1939" class="linenr">1939</a> </div>
<div class="pre"><a id="l1940" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1940" class="linenr">1940</a>         After this, only MAIN is 'exported' or seen by the rest of the program.</div>
<div class="pre"><a id="l1941" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1941" class="linenr">1941</a> */</div>
<div class="pre"><a id="l1942" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1942" class="linenr">1942</a> </div>
<div class="pre"><a id="l1943" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1943" class="linenr">1943</a>         defcode "HIDDEN",6,,HIDDEN</div>
<div class="pre"><a id="l1944" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1944" class="linenr">1944</a>         pop %edi                // Dictionary entry.</div>
<div class="pre"><a id="l1945" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1945" class="linenr">1945</a>         addl $4,%edi            // Point to name/flags byte.</div>
<div class="pre"><a id="l1946" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1946" class="linenr">1946</a>         xorb $F_HIDDEN,(%edi)   // Toggle the HIDDEN bit.</div>
<div class="pre"><a id="l1947" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1947" class="linenr">1947</a>         NEXT</div>
<div class="pre"><a id="l1948" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1948" class="linenr">1948</a> </div>
<div class="pre"><a id="l1949" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1949" class="linenr">1949</a>         defword "HIDE",4,,HIDE</div>
<div class="pre"><a id="l1950" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1950" class="linenr">1950</a>         .int WORD               // Get the word (after HIDE).</div>
<div class="pre"><a id="l1951" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1951" class="linenr">1951</a>         .int FIND               // Look up in the dictionary.</div>
<div class="pre"><a id="l1952" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1952" class="linenr">1952</a>         .int HIDDEN             // Set F_HIDDEN flag.</div>
<div class="pre"><a id="l1953" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1953" class="linenr">1953</a>         .int EXIT               // Return.</div>
<div class="pre"><a id="l1954" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1954" class="linenr">1954</a> </div>
<div class="pre"><a id="l1955" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1955" class="linenr">1955</a> /*</div>
<div class="pre"><a id="l1956" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1956" class="linenr">1956</a>         ' (TICK) is a standard FORTH word which returns the codeword pointer of the next word.</div>
<div class="pre"><a id="l1957" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1957" class="linenr">1957</a> </div>
<div class="pre"><a id="l1958" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1958" class="linenr">1958</a>         The common usage is:</div>
<div class="pre"><a id="l1959" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1959" class="linenr">1959</a> </div>
<div class="pre"><a id="l1960" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1960" class="linenr">1960</a>         ' FOO ,</div>
<div class="pre"><a id="l1961" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1961" class="linenr">1961</a> </div>
<div class="pre"><a id="l1962" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1962" class="linenr">1962</a>         which appends the codeword of FOO to the current word we are defining (this only works in compiled code).</div>
<div class="pre"><a id="l1963" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1963" class="linenr">1963</a> </div>
<div class="pre"><a id="l1964" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1964" class="linenr">1964</a>         You tend to use ' in IMMEDIATE words.  For example an alternate (and rather useless) way to define</div>
<div class="pre"><a id="l1965" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1965" class="linenr">1965</a>         a literal 2 might be:</div>
<div class="pre"><a id="l1966" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1966" class="linenr">1966</a> </div>
<div class="pre"><a id="l1967" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1967" class="linenr">1967</a>         : LIT2 IMMEDIATE</div>
<div class="pre"><a id="l1968" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1968" class="linenr">1968</a>                 ' LIT ,         \ Appends LIT to the currently-being-defined word</div>
<div class="pre"><a id="l1969" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1969" class="linenr">1969</a>                 2 ,             \ Appends the number 2 to the currently-being-defined word</div>
<div class="pre"><a id="l1970" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1970" class="linenr">1970</a>         ;</div>
<div class="pre"><a id="l1971" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1971" class="linenr">1971</a> </div>
<div class="pre"><a id="l1972" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1972" class="linenr">1972</a>         So you could do:</div>
<div class="pre"><a id="l1973" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1973" class="linenr">1973</a> </div>
<div class="pre"><a id="l1974" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1974" class="linenr">1974</a>         : DOUBLE LIT2 * ;</div>
<div class="pre"><a id="l1975" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1975" class="linenr">1975</a> </div>
<div class="pre"><a id="l1976" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1976" class="linenr">1976</a>         (If you don't understand how LIT2 works, then you should review the material about compiling words</div>
<div class="pre"><a id="l1977" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1977" class="linenr">1977</a>         and immediate mode).</div>
<div class="pre"><a id="l1978" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1978" class="linenr">1978</a> </div>
<div class="pre"><a id="l1979" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1979" class="linenr">1979</a>         This definition of ' uses a cheat which I copied from buzzard92.  As a result it only works in</div>
<div class="pre"><a id="l1980" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1980" class="linenr">1980</a>         compiled code.  It is possible to write a version of ' based on WORD, FIND, &gt;CFA which works in</div>
<div class="pre"><a id="l1981" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1981" class="linenr">1981</a>         immediate mode too.</div>
<div class="pre"><a id="l1982" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1982" class="linenr">1982</a> */</div>
<div class="pre"><a id="l1983" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1983" class="linenr">1983</a>         defcode "'",1,,TICK</div>
<div class="pre"><a id="l1984" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1984" class="linenr">1984</a>         lodsl                   // Get the address of the next word and skip it.</div>
<div class="pre"><a id="l1985" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1985" class="linenr">1985</a>         pushl %eax              // Push it on the stack.</div>
<div class="pre"><a id="l1986" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1986" class="linenr">1986</a>         NEXT</div>
<div class="pre"><a id="l1987" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1987" class="linenr">1987</a> </div>
<div class="pre"><a id="l1988" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1988" class="linenr">1988</a> /*</div>
<div class="pre"><a id="l1989" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1989" class="linenr">1989</a>         BRANCHING ----------------------------------------------------------------------</div>
<div class="pre"><a id="l1990" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1990" class="linenr">1990</a> </div>
<div class="pre"><a id="l1991" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1991" class="linenr">1991</a>         It turns out that all you need in order to define looping constructs, IF-statements, etc.</div>
<div class="pre"><a id="l1992" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1992" class="linenr">1992</a>         are two primitives.</div>
<div class="pre"><a id="l1993" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1993" class="linenr">1993</a> </div>
<div class="pre"><a id="l1994" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1994" class="linenr">1994</a>         BRANCH is an unconditional branch. 0BRANCH is a conditional branch (it only branches if the</div>
<div class="pre"><a id="l1995" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1995" class="linenr">1995</a>         top of stack is zero).</div>
<div class="pre"><a id="l1996" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1996" class="linenr">1996</a> </div>
<div class="pre"><a id="l1997" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1997" class="linenr">1997</a>         The diagram below shows how BRANCH works in some imaginary compiled word.  When BRANCH executes,</div>
<div class="pre"><a id="l1998" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1998" class="linenr">1998</a>         %esi starts by pointing to the offset field (compare to LIT above):</div>
<div class="pre"><a id="l1999" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l1999" class="linenr">1999</a> </div>
<div class="pre"><a id="l2000" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2000" class="linenr">2000</a>         +---------------------+-------+---- - - ---+------------+------------+---- - - - ----+------------+</div>
<div class="pre"><a id="l2001" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2001" class="linenr">2001</a>         | (Dictionary header) | DOCOL |            | BRANCH     | offset     | (skipped)     | word       |</div>
<div class="pre"><a id="l2002" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2002" class="linenr">2002</a>         +---------------------+-------+---- - - ---+------------+-----|------+---- - - - ----+------------+</div>
<div class="pre"><a id="l2003" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2003" class="linenr">2003</a>                                                                    ^  |                       ^</div>
<div class="pre"><a id="l2004" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2004" class="linenr">2004</a>                                                                    |  |                       |</div>
<div class="pre"><a id="l2005" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2005" class="linenr">2005</a>                                                                    |  +-----------------------+</div>
<div class="pre"><a id="l2006" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2006" class="linenr">2006</a>                                                                   %esi added to offset</div>
<div class="pre"><a id="l2007" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2007" class="linenr">2007</a> </div>
<div class="pre"><a id="l2008" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2008" class="linenr">2008</a>         The offset is added to %esi to make the new %esi, and the result is that when NEXT runs, execution</div>
<div class="pre"><a id="l2009" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2009" class="linenr">2009</a>         continues at the branch target.  Negative offsets work as expected.</div>
<div class="pre"><a id="l2010" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2010" class="linenr">2010</a> </div>
<div class="pre"><a id="l2011" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2011" class="linenr">2011</a>         0BRANCH is the same except the branch happens conditionally.</div>
<div class="pre"><a id="l2012" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2012" class="linenr">2012</a> </div>
<div class="pre"><a id="l2013" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2013" class="linenr">2013</a>         Now standard FORTH words such as IF, THEN, ELSE, WHILE, REPEAT, etc. can be implemented entirely</div>
<div class="pre"><a id="l2014" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2014" class="linenr">2014</a>         in FORTH.  They are IMMEDIATE words which append various combinations of BRANCH or 0BRANCH</div>
<div class="pre"><a id="l2015" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2015" class="linenr">2015</a>         into the word currently being compiled.</div>
<div class="pre"><a id="l2016" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2016" class="linenr">2016</a> </div>
<div class="pre"><a id="l2017" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2017" class="linenr">2017</a>         As an example, code written like this:</div>
<div class="pre"><a id="l2018" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2018" class="linenr">2018</a> </div>
<div class="pre"><a id="l2019" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2019" class="linenr">2019</a>                 condition-code IF true-part THEN rest-code</div>
<div class="pre"><a id="l2020" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2020" class="linenr">2020</a> </div>
<div class="pre"><a id="l2021" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2021" class="linenr">2021</a>         compiles to:</div>
<div class="pre"><a id="l2022" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2022" class="linenr">2022</a> </div>
<div class="pre"><a id="l2023" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2023" class="linenr">2023</a>                 condition-code 0BRANCH OFFSET true-part rest-code</div>
<div class="pre"><a id="l2024" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2024" class="linenr">2024</a>                                           |             ^</div>
<div class="pre"><a id="l2025" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2025" class="linenr">2025</a>                                           |             |</div>
<div class="pre"><a id="l2026" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2026" class="linenr">2026</a>                                           +-------------+</div>
<div class="pre"><a id="l2027" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2027" class="linenr">2027</a> */</div>
<div class="pre"><a id="l2028" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2028" class="linenr">2028</a> </div>
<div class="pre"><a id="l2029" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2029" class="linenr">2029</a>         defcode "BRANCH",6,,BRANCH</div>
<div class="pre"><a id="l2030" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2030" class="linenr">2030</a>         add (%esi),%esi         // add the offset to the instruction pointer</div>
<div class="pre"><a id="l2031" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2031" class="linenr">2031</a>         NEXT</div>
<div class="pre"><a id="l2032" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2032" class="linenr">2032</a> </div>
<div class="pre"><a id="l2033" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2033" class="linenr">2033</a>         defcode "0BRANCH",7,,ZBRANCH</div>
<div class="pre"><a id="l2034" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2034" class="linenr">2034</a>         pop %eax</div>
<div class="pre"><a id="l2035" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2035" class="linenr">2035</a>         test %eax,%eax          // top of stack is zero?</div>
<div class="pre"><a id="l2036" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2036" class="linenr">2036</a>         jz code_BRANCH          // if so, jump back to the branch function above</div>
<div class="pre"><a id="l2037" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2037" class="linenr">2037</a>         lodsl                   // otherwise we need to skip the offset</div>
<div class="pre"><a id="l2038" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2038" class="linenr">2038</a>         NEXT</div>
<div class="pre"><a id="l2039" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2039" class="linenr">2039</a> </div>
<div class="pre"><a id="l2040" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2040" class="linenr">2040</a> /*</div>
<div class="pre"><a id="l2041" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2041" class="linenr">2041</a>         LITERAL STRINGS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l2042" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2042" class="linenr">2042</a> </div>
<div class="pre"><a id="l2043" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2043" class="linenr">2043</a>         LITSTRING is a primitive used to implement the ." and S" operators (which are written in</div>
<div class="pre"><a id="l2044" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2044" class="linenr">2044</a>         FORTH).  See the definition of those operators later.</div>
<div class="pre"><a id="l2045" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2045" class="linenr">2045</a> </div>
<div class="pre"><a id="l2046" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2046" class="linenr">2046</a>         TELL just prints a string.  It's more efficient to define this in assembly because we</div>
<div class="pre"><a id="l2047" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2047" class="linenr">2047</a>         can make it a single Linux syscall.</div>
<div class="pre"><a id="l2048" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2048" class="linenr">2048</a> */</div>
<div class="pre"><a id="l2049" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2049" class="linenr">2049</a> </div>
<div class="pre"><a id="l2050" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2050" class="linenr">2050</a>         defcode "LITSTRING",9,,LITSTRING</div>
<div class="pre"><a id="l2051" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2051" class="linenr">2051</a>         lodsl                   // get the length of the string</div>
<div class="pre"><a id="l2052" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2052" class="linenr">2052</a>         push %esi               // push the address of the start of the string</div>
<div class="pre"><a id="l2053" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2053" class="linenr">2053</a>         push %eax               // push it on the stack</div>
<div class="pre"><a id="l2054" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2054" class="linenr">2054</a>         addl %eax,%esi          // skip past the string</div>
<div class="pre"><a id="l2055" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2055" class="linenr">2055</a>         addl $3,%esi            // but round up to next 4 byte boundary</div>
<div class="pre"><a id="l2056" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2056" class="linenr">2056</a>         andl $~3,%esi</div>
<div class="pre"><a id="l2057" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2057" class="linenr">2057</a>         NEXT</div>
<div class="pre"><a id="l2058" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2058" class="linenr">2058</a> </div>
<div class="pre"><a id="l2059" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2059" class="linenr">2059</a>         defcode "TELL",4,,TELL</div>
<div class="pre"><a id="l2060" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2060" class="linenr">2060</a>         mov $1,%ebx             // 1st param: stdout</div>
<div class="pre"><a id="l2061" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2061" class="linenr">2061</a>         pop %edx                // 3rd param: length of string</div>
<div class="pre"><a id="l2062" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2062" class="linenr">2062</a>         pop %ecx                // 2nd param: address of string</div>
<div class="pre"><a id="l2063" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2063" class="linenr">2063</a>         mov $__NR_write,%eax    // write syscall</div>
<div class="pre"><a id="l2064" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2064" class="linenr">2064</a>         int $0x80</div>
<div class="pre"><a id="l2065" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2065" class="linenr">2065</a>         NEXT</div>
<div class="pre"><a id="l2066" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2066" class="linenr">2066</a> </div>
<div class="pre"><a id="l2067" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2067" class="linenr">2067</a> /*</div>
<div class="pre"><a id="l2068" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2068" class="linenr">2068</a>         QUIT AND INTERPRET ----------------------------------------------------------------------</div>
<div class="pre"><a id="l2069" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2069" class="linenr">2069</a> </div>
<div class="pre"><a id="l2070" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2070" class="linenr">2070</a>         QUIT is the first FORTH function called, almost immediately after the FORTH system "boots".</div>
<div class="pre"><a id="l2071" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2071" class="linenr">2071</a>         As explained before, QUIT doesn't "quit" anything.  It does some initialisation (in particular</div>
<div class="pre"><a id="l2072" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2072" class="linenr">2072</a>         it clears the return stack) and it calls INTERPRET in a loop to interpret commands.  The</div>
<div class="pre"><a id="l2073" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2073" class="linenr">2073</a>         reason it is called QUIT is because you can call it from your own FORTH words in order to</div>
<div class="pre"><a id="l2074" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2074" class="linenr">2074</a>         "quit" your program and start again at the user prompt.</div>
<div class="pre"><a id="l2075" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2075" class="linenr">2075</a> </div>
<div class="pre"><a id="l2076" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2076" class="linenr">2076</a>         INTERPRET is the FORTH interpreter ("toploop", "toplevel" or "REPL" might be a more accurate</div>
<div class="pre"><a id="l2077" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2077" class="linenr">2077</a>         description -- see: http://en.wikipedia.org/wiki/REPL).</div>
<div class="pre"><a id="l2078" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2078" class="linenr">2078</a> */</div>
<div class="pre"><a id="l2079" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2079" class="linenr">2079</a> </div>
<div class="pre"><a id="l2080" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2080" class="linenr">2080</a>         // QUIT must not return (ie. must not call EXIT).</div>
<div class="pre"><a id="l2081" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2081" class="linenr">2081</a>         defword "QUIT",4,,QUIT</div>
<div class="pre"><a id="l2082" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2082" class="linenr">2082</a>         .int RZ,RSPSTORE        // R0 RSP!, clear the return stack</div>
<div class="pre"><a id="l2083" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2083" class="linenr">2083</a>         .int INTERPRET          // interpret the next word</div>
<div class="pre"><a id="l2084" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2084" class="linenr">2084</a>         .int BRANCH,-8          // and loop (indefinitely)</div>
<div class="pre"><a id="l2085" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2085" class="linenr">2085</a> </div>
<div class="pre"><a id="l2086" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2086" class="linenr">2086</a> /*</div>
<div class="pre"><a id="l2087" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2087" class="linenr">2087</a>         This interpreter is pretty simple, but remember that in FORTH you can always override</div>
<div class="pre"><a id="l2088" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2088" class="linenr">2088</a>         it later with a more powerful one!</div>
<div class="pre"><a id="l2089" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2089" class="linenr">2089</a>  */</div>
<div class="pre"><a id="l2090" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2090" class="linenr">2090</a>         defcode "INTERPRET",9,,INTERPRET</div>
<div class="pre"><a id="l2091" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2091" class="linenr">2091</a>         call _WORD              // Returns %ecx = length, %edi = pointer to word.</div>
<div class="pre"><a id="l2092" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2092" class="linenr">2092</a> </div>
<div class="pre"><a id="l2093" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2093" class="linenr">2093</a>         // Is it in the dictionary?</div>
<div class="pre"><a id="l2094" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2094" class="linenr">2094</a>         xor %eax,%eax</div>
<div class="pre"><a id="l2095" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2095" class="linenr">2095</a>         movl %eax,interpret_is_lit // Not a literal number (not yet anyway ...)</div>
<div class="pre"><a id="l2096" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2096" class="linenr">2096</a>         call _FIND              // Returns %eax = pointer to header or 0 if not found.</div>
<div class="pre"><a id="l2097" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2097" class="linenr">2097</a>         test %eax,%eax          // Found?</div>
<div class="pre"><a id="l2098" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2098" class="linenr">2098</a>         jz 1f</div>
<div class="pre"><a id="l2099" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2099" class="linenr">2099</a> </div>
<div class="pre"><a id="l2100" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2100" class="linenr">2100</a>         // In the dictionary.  Is it an IMMEDIATE codeword?</div>
<div class="pre"><a id="l2101" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2101" class="linenr">2101</a>         mov %eax,%edi           // %edi = dictionary entry</div>
<div class="pre"><a id="l2102" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2102" class="linenr">2102</a>         movb 4(%edi),%al        // Get name+flags.</div>
<div class="pre"><a id="l2103" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2103" class="linenr">2103</a>         push %ax                // Just save it for now.</div>
<div class="pre"><a id="l2104" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2104" class="linenr">2104</a>         call _TCFA              // Convert dictionary entry (in %edi) to codeword pointer.</div>
<div class="pre"><a id="l2105" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2105" class="linenr">2105</a>         pop %ax</div>
<div class="pre"><a id="l2106" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2106" class="linenr">2106</a>         andb $F_IMMED,%al       // Is IMMED flag set?</div>
<div class="pre"><a id="l2107" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2107" class="linenr">2107</a>         mov %edi,%eax</div>
<div class="pre"><a id="l2108" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2108" class="linenr">2108</a>         jnz 4f                  // If IMMED, jump straight to executing.</div>
<div class="pre"><a id="l2109" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2109" class="linenr">2109</a> </div>
<div class="pre"><a id="l2110" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2110" class="linenr">2110</a>         jmp 2f</div>
<div class="pre"><a id="l2111" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2111" class="linenr">2111</a> </div>
<div class="pre"><a id="l2112" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2112" class="linenr">2112</a> 1:      // Not in the dictionary (not a word) so assume it's a literal number.</div>
<div class="pre"><a id="l2113" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2113" class="linenr">2113</a>         incl interpret_is_lit</div>
<div class="pre"><a id="l2114" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2114" class="linenr">2114</a>         call _NUMBER            // Returns the parsed number in %eax, %ecx &gt; 0 if error</div>
<div class="pre"><a id="l2115" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2115" class="linenr">2115</a>         test %ecx,%ecx</div>
<div class="pre"><a id="l2116" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2116" class="linenr">2116</a>         jnz 6f</div>
<div class="pre"><a id="l2117" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2117" class="linenr">2117</a>         mov %eax,%ebx</div>
<div class="pre"><a id="l2118" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2118" class="linenr">2118</a>         mov $LIT,%eax           // The word is LIT</div>
<div class="pre"><a id="l2119" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2119" class="linenr">2119</a> </div>
<div class="pre"><a id="l2120" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2120" class="linenr">2120</a> 2:      // Are we compiling or executing?</div>
<div class="pre"><a id="l2121" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2121" class="linenr">2121</a>         movl var_STATE,%edx</div>
<div class="pre"><a id="l2122" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2122" class="linenr">2122</a>         test %edx,%edx</div>
<div class="pre"><a id="l2123" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2123" class="linenr">2123</a>         jz 4f                   // Jump if executing.</div>
<div class="pre"><a id="l2124" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2124" class="linenr">2124</a> </div>
<div class="pre"><a id="l2125" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2125" class="linenr">2125</a>         // Compiling - just append the word to the current dictionary definition.</div>
<div class="pre"><a id="l2126" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2126" class="linenr">2126</a>         call _COMMA</div>
<div class="pre"><a id="l2127" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2127" class="linenr">2127</a>         mov interpret_is_lit,%ecx // Was it a literal?</div>
<div class="pre"><a id="l2128" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2128" class="linenr">2128</a>         test %ecx,%ecx</div>
<div class="pre"><a id="l2129" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2129" class="linenr">2129</a>         jz 3f</div>
<div class="pre"><a id="l2130" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2130" class="linenr">2130</a>         mov %ebx,%eax           // Yes, so LIT is followed by a number.</div>
<div class="pre"><a id="l2131" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2131" class="linenr">2131</a>         call _COMMA</div>
<div class="pre"><a id="l2132" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2132" class="linenr">2132</a> 3:      NEXT</div>
<div class="pre"><a id="l2133" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2133" class="linenr">2133</a> </div>
<div class="pre"><a id="l2134" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2134" class="linenr">2134</a> 4:      // Executing - run it!</div>
<div class="pre"><a id="l2135" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2135" class="linenr">2135</a>         mov interpret_is_lit,%ecx // Literal?</div>
<div class="pre"><a id="l2136" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2136" class="linenr">2136</a>         test %ecx,%ecx          // Literal?</div>
<div class="pre"><a id="l2137" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2137" class="linenr">2137</a>         jnz 5f</div>
<div class="pre"><a id="l2138" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2138" class="linenr">2138</a> </div>
<div class="pre"><a id="l2139" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2139" class="linenr">2139</a>         // Not a literal, execute it now.  This never returns, but the codeword will</div>
<div class="pre"><a id="l2140" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2140" class="linenr">2140</a>         // eventually call NEXT which will reenter the loop in QUIT.</div>
<div class="pre"><a id="l2141" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2141" class="linenr">2141</a>         jmp *(%eax)</div>
<div class="pre"><a id="l2142" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2142" class="linenr">2142</a> </div>
<div class="pre"><a id="l2143" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2143" class="linenr">2143</a> 5:      // Executing a literal, which means push it on the stack.</div>
<div class="pre"><a id="l2144" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2144" class="linenr">2144</a>         push %ebx</div>
<div class="pre"><a id="l2145" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2145" class="linenr">2145</a>         NEXT</div>
<div class="pre"><a id="l2146" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2146" class="linenr">2146</a> </div>
<div class="pre"><a id="l2147" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2147" class="linenr">2147</a> 6:      // Parse error (not a known word or a number in the current BASE).</div>
<div class="pre"><a id="l2148" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2148" class="linenr">2148</a>         // Print an error message followed by up to 40 characters of context.</div>
<div class="pre"><a id="l2149" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2149" class="linenr">2149</a>         mov $2,%ebx             // 1st param: stderr</div>
<div class="pre"><a id="l2150" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2150" class="linenr">2150</a>         mov $errmsg,%ecx        // 2nd param: error message</div>
<div class="pre"><a id="l2151" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2151" class="linenr">2151</a>         mov $errmsgend-errmsg,%edx // 3rd param: length of string</div>
<div class="pre"><a id="l2152" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2152" class="linenr">2152</a>         mov $__NR_write,%eax    // write syscall</div>
<div class="pre"><a id="l2153" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2153" class="linenr">2153</a>         int $0x80</div>
<div class="pre"><a id="l2154" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2154" class="linenr">2154</a> </div>
<div class="pre"><a id="l2155" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2155" class="linenr">2155</a>         mov (currkey),%ecx      // the error occurred just before currkey position</div>
<div class="pre"><a id="l2156" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2156" class="linenr">2156</a>         mov %ecx,%edx</div>
<div class="pre"><a id="l2157" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2157" class="linenr">2157</a>         sub $buffer,%edx        // %edx = currkey - buffer (length in buffer before currkey)</div>
<div class="pre"><a id="l2158" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2158" class="linenr">2158</a>         cmp $40,%edx            // if &gt; 40, then print only 40 characters</div>
<div class="pre"><a id="l2159" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2159" class="linenr">2159</a>         jle 7f</div>
<div class="pre"><a id="l2160" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2160" class="linenr">2160</a>         mov $40,%edx</div>
<div class="pre"><a id="l2161" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2161" class="linenr">2161</a> 7:      sub %edx,%ecx           // %ecx = start of area to print, %edx = length</div>
<div class="pre"><a id="l2162" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2162" class="linenr">2162</a>         mov $__NR_write,%eax    // write syscall</div>
<div class="pre"><a id="l2163" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2163" class="linenr">2163</a>         int $0x80</div>
<div class="pre"><a id="l2164" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2164" class="linenr">2164</a> </div>
<div class="pre"><a id="l2165" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2165" class="linenr">2165</a>         mov $errmsgnl,%ecx      // newline</div>
<div class="pre"><a id="l2166" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2166" class="linenr">2166</a>         mov $1,%edx</div>
<div class="pre"><a id="l2167" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2167" class="linenr">2167</a>         mov $__NR_write,%eax    // write syscall</div>
<div class="pre"><a id="l2168" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2168" class="linenr">2168</a>         int $0x80</div>
<div class="pre"><a id="l2169" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2169" class="linenr">2169</a> </div>
<div class="pre"><a id="l2170" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2170" class="linenr">2170</a>         NEXT</div>
<div class="pre"><a id="l2171" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2171" class="linenr">2171</a> </div>
<div class="pre"><a id="l2172" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2172" class="linenr">2172</a>         .section .rodata</div>
<div class="pre"><a id="l2173" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2173" class="linenr">2173</a> errmsg: .ascii "PARSE ERROR: "</div>
<div class="pre"><a id="l2174" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2174" class="linenr">2174</a> errmsgend:</div>
<div class="pre"><a id="l2175" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2175" class="linenr">2175</a> errmsgnl: .ascii "\n"</div>
<div class="pre"><a id="l2176" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2176" class="linenr">2176</a> </div>
<div class="pre"><a id="l2177" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2177" class="linenr">2177</a>         .data                   // NB: easier to fit in the .data section</div>
<div class="pre"><a id="l2178" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2178" class="linenr">2178</a>         .align 4</div>
<div class="pre"><a id="l2179" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2179" class="linenr">2179</a> interpret_is_lit:</div>
<div class="pre"><a id="l2180" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2180" class="linenr">2180</a>         .int 0                  // Flag used to record if reading a literal</div>
<div class="pre"><a id="l2181" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2181" class="linenr">2181</a> </div>
<div class="pre"><a id="l2182" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2182" class="linenr">2182</a> /*</div>
<div class="pre"><a id="l2183" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2183" class="linenr">2183</a>         ODDS AND ENDS ----------------------------------------------------------------------</div>
<div class="pre"><a id="l2184" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2184" class="linenr">2184</a> </div>
<div class="pre"><a id="l2185" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2185" class="linenr">2185</a>         CHAR puts the ASCII code of the first character of the following word on the stack.  For example</div>
<div class="pre"><a id="l2186" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2186" class="linenr">2186</a>         CHAR A puts 65 on the stack.</div>
<div class="pre"><a id="l2187" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2187" class="linenr">2187</a> </div>
<div class="pre"><a id="l2188" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2188" class="linenr">2188</a>         EXECUTE is used to run execution tokens.  See the discussion of execution tokens in the</div>
<div class="pre"><a id="l2189" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2189" class="linenr">2189</a>         FORTH code for more details.</div>
<div class="pre"><a id="l2190" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2190" class="linenr">2190</a> </div>
<div class="pre"><a id="l2191" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2191" class="linenr">2191</a>         SYSCALL0, SYSCALL1, SYSCALL2, SYSCALL3 make a standard Linux system call.  (See &lt;asm/unistd.h&gt;</div>
<div class="pre"><a id="l2192" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2192" class="linenr">2192</a>         for a list of system call numbers).  As their name suggests these forms take between 0 and 3</div>
<div class="pre"><a id="l2193" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2193" class="linenr">2193</a>         syscall parameters, plus the system call number.</div>
<div class="pre"><a id="l2194" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2194" class="linenr">2194</a> </div>
<div class="pre"><a id="l2195" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2195" class="linenr">2195</a>         In this FORTH, SYSCALL0 must be the last word in the built-in (assembler) dictionary because we</div>
<div class="pre"><a id="l2196" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2196" class="linenr">2196</a>         initialise the LATEST variable to point to it.  This means that if you want to extend the assembler</div>
<div class="pre"><a id="l2197" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2197" class="linenr">2197</a>         part, you must put new words before SYSCALL0, or else change how LATEST is initialised.</div>
<div class="pre"><a id="l2198" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2198" class="linenr">2198</a> */</div>
<div class="pre"><a id="l2199" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2199" class="linenr">2199</a> </div>
<div class="pre"><a id="l2200" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2200" class="linenr">2200</a>         defcode "CHAR",4,,CHAR</div>
<div class="pre"><a id="l2201" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2201" class="linenr">2201</a>         call _WORD              // Returns %ecx = length, %edi = pointer to word.</div>
<div class="pre"><a id="l2202" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2202" class="linenr">2202</a>         xor %eax,%eax</div>
<div class="pre"><a id="l2203" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2203" class="linenr">2203</a>         movb (%edi),%al         // Get the first character of the word.</div>
<div class="pre"><a id="l2204" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2204" class="linenr">2204</a>         push %eax               // Push it onto the stack.</div>
<div class="pre"><a id="l2205" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2205" class="linenr">2205</a>         NEXT</div>
<div class="pre"><a id="l2206" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2206" class="linenr">2206</a> </div>
<div class="pre"><a id="l2207" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2207" class="linenr">2207</a>         defcode "EXECUTE",7,,EXECUTE</div>
<div class="pre"><a id="l2208" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2208" class="linenr">2208</a>         pop %eax                // Get xt into %eax</div>
<div class="pre"><a id="l2209" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2209" class="linenr">2209</a>         jmp *(%eax)             // and jump to it.</div>
<div class="pre"><a id="l2210" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2210" class="linenr">2210</a>                                 // After xt runs its NEXT will continue executing the current word.</div>
<div class="pre"><a id="l2211" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2211" class="linenr">2211</a> </div>
<div class="pre"><a id="l2212" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2212" class="linenr">2212</a>         defcode "SYSCALL3",8,,SYSCALL3</div>
<div class="pre"><a id="l2213" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2213" class="linenr">2213</a>         pop %eax                // System call number (see &lt;asm/unistd.h&gt;)</div>
<div class="pre"><a id="l2214" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2214" class="linenr">2214</a>         pop %ebx                // First parameter.</div>
<div class="pre"><a id="l2215" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2215" class="linenr">2215</a>         pop %ecx                // Second parameter</div>
<div class="pre"><a id="l2216" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2216" class="linenr">2216</a>         pop %edx                // Third parameter</div>
<div class="pre"><a id="l2217" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2217" class="linenr">2217</a>         int $0x80</div>
<div class="pre"><a id="l2218" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2218" class="linenr">2218</a>         push %eax               // Result (negative for -errno)</div>
<div class="pre"><a id="l2219" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2219" class="linenr">2219</a>         NEXT</div>
<div class="pre"><a id="l2220" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2220" class="linenr">2220</a> </div>
<div class="pre"><a id="l2221" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2221" class="linenr">2221</a>         defcode "SYSCALL2",8,,SYSCALL2</div>
<div class="pre"><a id="l2222" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2222" class="linenr">2222</a>         pop %eax                // System call number (see &lt;asm/unistd.h&gt;)</div>
<div class="pre"><a id="l2223" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2223" class="linenr">2223</a>         pop %ebx                // First parameter.</div>
<div class="pre"><a id="l2224" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2224" class="linenr">2224</a>         pop %ecx                // Second parameter</div>
<div class="pre"><a id="l2225" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2225" class="linenr">2225</a>         int $0x80</div>
<div class="pre"><a id="l2226" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2226" class="linenr">2226</a>         push %eax               // Result (negative for -errno)</div>
<div class="pre"><a id="l2227" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2227" class="linenr">2227</a>         NEXT</div>
<div class="pre"><a id="l2228" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2228" class="linenr">2228</a> </div>
<div class="pre"><a id="l2229" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2229" class="linenr">2229</a>         defcode "SYSCALL1",8,,SYSCALL1</div>
<div class="pre"><a id="l2230" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2230" class="linenr">2230</a>         pop %eax                // System call number (see &lt;asm/unistd.h&gt;)</div>
<div class="pre"><a id="l2231" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2231" class="linenr">2231</a>         pop %ebx                // First parameter.</div>
<div class="pre"><a id="l2232" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2232" class="linenr">2232</a>         int $0x80</div>
<div class="pre"><a id="l2233" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2233" class="linenr">2233</a>         push %eax               // Result (negative for -errno)</div>
<div class="pre"><a id="l2234" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2234" class="linenr">2234</a>         NEXT</div>
<div class="pre"><a id="l2235" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2235" class="linenr">2235</a> </div>
<div class="pre"><a id="l2236" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2236" class="linenr">2236</a>         defcode "SYSCALL0",8,,SYSCALL0</div>
<div class="pre"><a id="l2237" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2237" class="linenr">2237</a>         pop %eax                // System call number (see &lt;asm/unistd.h&gt;)</div>
<div class="pre"><a id="l2238" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2238" class="linenr">2238</a>         int $0x80</div>
<div class="pre"><a id="l2239" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2239" class="linenr">2239</a>         push %eax               // Result (negative for -errno)</div>
<div class="pre"><a id="l2240" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2240" class="linenr">2240</a>         NEXT</div>
<div class="pre"><a id="l2241" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2241" class="linenr">2241</a> </div>
<div class="pre"><a id="l2242" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2242" class="linenr">2242</a> /*</div>
<div class="pre"><a id="l2243" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2243" class="linenr">2243</a>         DATA SEGMENT ----------------------------------------------------------------------</div>
<div class="pre"><a id="l2244" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2244" class="linenr">2244</a> </div>
<div class="pre"><a id="l2245" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2245" class="linenr">2245</a>         Here we set up the Linux data segment, used for user definitions and variously known as just</div>
<div class="pre"><a id="l2246" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2246" class="linenr">2246</a>         the 'data segment', 'user memory' or 'user definitions area'.  It is an area of memory which</div>
<div class="pre"><a id="l2247" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2247" class="linenr">2247</a>         grows upwards and stores both newly-defined FORTH words and global variables of various</div>
<div class="pre"><a id="l2248" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2248" class="linenr">2248</a>         sorts.</div>
<div class="pre"><a id="l2249" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2249" class="linenr">2249</a> </div>
<div class="pre"><a id="l2250" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2250" class="linenr">2250</a>         It is completely analogous to the C heap, except there is no generalised 'malloc' and 'free'</div>
<div class="pre"><a id="l2251" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2251" class="linenr">2251</a>         (but as with everything in FORTH, writing such functions would just be a Simple Matter</div>
<div class="pre"><a id="l2252" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2252" class="linenr">2252</a>         Of Programming).  Instead in normal use the data segment just grows upwards as new FORTH</div>
<div class="pre"><a id="l2253" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2253" class="linenr">2253</a>         words are defined/appended to it.</div>
<div class="pre"><a id="l2254" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2254" class="linenr">2254</a> </div>
<div class="pre"><a id="l2255" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2255" class="linenr">2255</a>         There are various "features" of the GNU toolchain which make setting up the data segment</div>
<div class="pre"><a id="l2256" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2256" class="linenr">2256</a>         more complicated than it really needs to be.  One is the GNU linker which inserts a random</div>
<div class="pre"><a id="l2257" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2257" class="linenr">2257</a>         "build ID" segment.  Another is Address Space Randomization which means we can't tell</div>
<div class="pre"><a id="l2258" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2258" class="linenr">2258</a>         where the kernel will choose to place the data segment (or the stack for that matter).</div>
<div class="pre"><a id="l2259" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2259" class="linenr">2259</a> </div>
<div class="pre"><a id="l2260" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2260" class="linenr">2260</a>         Therefore writing this set_up_data_segment assembler routine is a little more complicated</div>
<div class="pre"><a id="l2261" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2261" class="linenr">2261</a>         than it really needs to be.  We ask the Linux kernel where it thinks the data segment starts</div>
<div class="pre"><a id="l2262" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2262" class="linenr">2262</a>         using the brk(2) system call, then ask it to reserve some initial space (also using brk(2)).</div>
<div class="pre"><a id="l2263" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2263" class="linenr">2263</a> </div>
<div class="pre"><a id="l2264" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2264" class="linenr">2264</a>         You don't need to worry about this code.</div>
<div class="pre"><a id="l2265" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2265" class="linenr">2265</a> */</div>
<div class="pre"><a id="l2266" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2266" class="linenr">2266</a>         .text</div>
<div class="pre"><a id="l2267" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2267" class="linenr">2267</a>         .set INITIAL_DATA_SEGMENT_SIZE,65536</div>
<div class="pre"><a id="l2268" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2268" class="linenr">2268</a> set_up_data_segment:</div>
<div class="pre"><a id="l2269" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2269" class="linenr">2269</a>         xor %ebx,%ebx           // Call brk(0)</div>
<div class="pre"><a id="l2270" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2270" class="linenr">2270</a>         movl $__NR_brk,%eax</div>
<div class="pre"><a id="l2271" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2271" class="linenr">2271</a>         int $0x80</div>
<div class="pre"><a id="l2272" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2272" class="linenr">2272</a>         movl %eax,var_HERE      // Initialise HERE to point at beginning of data segment.</div>
<div class="pre"><a id="l2273" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2273" class="linenr">2273</a>         addl $INITIAL_DATA_SEGMENT_SIZE,%eax    // Reserve nn bytes of memory for initial data segment.</div>
<div class="pre"><a id="l2274" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2274" class="linenr">2274</a>         movl %eax,%ebx          // Call brk(HERE+INITIAL_DATA_SEGMENT_SIZE)</div>
<div class="pre"><a id="l2275" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2275" class="linenr">2275</a>         movl $__NR_brk,%eax</div>
<div class="pre"><a id="l2276" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2276" class="linenr">2276</a>         int $0x80</div>
<div class="pre"><a id="l2277" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2277" class="linenr">2277</a>         ret</div>
<div class="pre"><a id="l2278" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2278" class="linenr">2278</a> </div>
<div class="pre"><a id="l2279" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2279" class="linenr">2279</a> /*</div>
<div class="pre"><a id="l2280" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2280" class="linenr">2280</a>         We allocate static buffers for the return static and input buffer (used when</div>
<div class="pre"><a id="l2281" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2281" class="linenr">2281</a>         reading in files and text that the user types in).</div>
<div class="pre"><a id="l2282" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2282" class="linenr">2282</a> */</div>
<div class="pre"><a id="l2283" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2283" class="linenr">2283</a>         .set RETURN_STACK_SIZE,8192</div>
<div class="pre"><a id="l2284" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2284" class="linenr">2284</a>         .set BUFFER_SIZE,4096</div>
<div class="pre"><a id="l2285" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2285" class="linenr">2285</a> </div>
<div class="pre"><a id="l2286" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2286" class="linenr">2286</a>         .bss</div>
<div class="pre"><a id="l2287" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2287" class="linenr">2287</a> /* FORTH return stack. */</div>
<div class="pre"><a id="l2288" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2288" class="linenr">2288</a>         .align 4096</div>
<div class="pre"><a id="l2289" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2289" class="linenr">2289</a> return_stack:</div>
<div class="pre"><a id="l2290" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2290" class="linenr">2290</a>         .space RETURN_STACK_SIZE</div>
<div class="pre"><a id="l2291" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2291" class="linenr">2291</a> return_stack_top:               // Initial top of return stack.</div>
<div class="pre"><a id="l2292" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2292" class="linenr">2292</a> </div>
<div class="pre"><a id="l2293" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2293" class="linenr">2293</a> /* This is used as a temporary input buffer when reading from files or the terminal. */</div>
<div class="pre"><a id="l2294" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2294" class="linenr">2294</a>         .align 4096</div>
<div class="pre"><a id="l2295" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2295" class="linenr">2295</a> buffer:</div>
<div class="pre"><a id="l2296" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2296" class="linenr">2296</a>         .space BUFFER_SIZE</div>
<div class="pre"><a id="l2297" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2297" class="linenr">2297</a> </div>
<div class="pre"><a id="l2298" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2298" class="linenr">2298</a> /*</div>
<div class="pre"><a id="l2299" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2299" class="linenr">2299</a>         START OF FORTH CODE ----------------------------------------------------------------------</div>
<div class="pre"><a id="l2300" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2300" class="linenr">2300</a> </div>
<div class="pre"><a id="l2301" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2301" class="linenr">2301</a>         We've now reached the stage where the FORTH system is running and self-hosting.  All further</div>
<div class="pre"><a id="l2302" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2302" class="linenr">2302</a>         words can be written as FORTH itself, including words like IF, THEN, .", etc which in most</div>
<div class="pre"><a id="l2303" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2303" class="linenr">2303</a>         languages would be considered rather fundamental.</div>
<div class="pre"><a id="l2304" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2304" class="linenr">2304</a> </div>
<div class="pre"><a id="l2305" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2305" class="linenr">2305</a>         I used to append this here in the assembly file, but I got sick of fighting against gas's</div>
<div class="pre"><a id="l2306" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2306" class="linenr">2306</a>         crack-smoking (lack of) multiline string syntax.  So now that is in a separate file called</div>
<div class="pre"><a id="l2307" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2307" class="linenr">2307</a>         jonesforth.f</div>
<div class="pre"><a id="l2308" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2308" class="linenr">2308</a> </div>
<div class="pre"><a id="l2309" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2309" class="linenr">2309</a>         If you don't already have that file, download it from http://annexia.org/forth in order</div>
<div class="pre"><a id="l2310" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2310" class="linenr">2310</a>         to continue the tutorial.</div>
<div class="pre"><a id="l2311" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2311" class="linenr">2311</a> */</div>
<div class="pre"><a id="l2312" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2312" class="linenr">2312</a> </div>
<div class="pre"><a id="l2313" href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD#l2313" class="linenr">2313</a> /* END OF jonesforth.S */</div>
</div><div class="page_footer">
<div class="page_footer_text">JONESFORTH - A sometimes minimal FORTH compiler and tutorial</div>
<a class="rss_logo" title="history of jonesforth.S RSS feed" href="http://git.annexia.org/?p=jonesforth.git;a=rss;f=jonesforth.S">RSS</a>
<a class="rss_logo" title="history of jonesforth.S Atom feed" href="http://git.annexia.org/?p=jonesforth.git;a=atom;f=jonesforth.S">Atom</a>
</div>
<script type="text/javascript" src="jonesforth.S_files/gitweb.js"></script>
<script type="text/javascript">
window.onload = function () {
	var tz_cookie = { name: 'gitweb_tz', expires: 14, path: '/' };
	onloadTZSetup('local', tz_cookie, 'datetime');
};
</script>
</body>
</html>